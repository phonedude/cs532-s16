http://www.ticketmaster.ca/FIFA-Womens-World-Cup-Canada-2015-tickets/artist/875503?SREF=TWArtist





FIFA Women’s World Cup Canada 2015 Tickets | Single Game Tickets & Schedule | Ticketmaster CA





























    var isSuperNav = 0;


    window.js_cookie_domain = "ticketmaster.ca";
    var disableResaleBaAutoExpand = 0;
    var disableVFS = 0;
    var rebranding_mvp = false;
    var rebranding = true;

            var googletag = googletag || {};
            googletag.cmd = googletag.cmd || [];
            (function() {
                var gptFlag = false;
                var gads = document.createElement('script');
                gads.async = true;
                gads.type = 'text/javascript';
                var useSSL = 'https:' == document.location.protocol;
                gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
                var node = document.getElementsByTagName('script')[0];
                node.parentNode.insertBefore(gads, node);            })();    












//<![CDATA[
	jQuery.noConflict();
		
	
	
	jQuery(document).ready(function($) {
	
    		
	
		
        
	});
//]]>



var tm_omn_account="tm-CAprod,tm-combinedUSprod";
var isReviews = "";
var omn_domain_owner = "TM_CA:";
var tm_omni_temp = $H();
var modules_avail_per_page = $A();
var market_id = GetCookie('MARKET_ID') ? GetCookie('MARKET_ID') : '101';
tm_omni_temp.set('is_s_doPlugins_fired', false);
tm_omni_temp.set('omnVID','');
tm_omni_temp.set('omnAID','875503');
tm_omni_temp.set('omnEID','');
tm_omni_temp.set('omnMID','TM_CA: ' + market_id);


var omniCustomClick = Class.create({
  initialize: function(initialData) {
    this.data = Object.extend({}, initialData);
  },

  handleClick: function(event) {
    $H(this.data).each(function(d){
        tm_omn[d.key] = d.value;
      });
       switch(newPage){
         case true:
                 tm_omn.t();
                 tm_omn.getPreviousValue(tm_omn.pageName,'gpv','');
         break;
         case false:
           tm_omn.tl(true,'o',clickLink);
         break;
      }
        if(tm_omni_temp.get('location_path')){
           if(newWindow == true){
               window.open(tm_omni_temp.get('location_path'),'_blank');
           }else{
               self.location.replace(tm_omni_temp.get('location_path'));
           }
            tm_omni_temp.unset('location_path');
            return false;
        }
        return true;
  },
  module_link: function(clickmod,inclusiveLink,tracking_vars){
         this.data = Object.extend({},{
                    linkTrackVars: 'events,eVar13,prop14,eVar14',
                  linkTrackEvents: 'event13',
                           events: 'event13',
                           prop14: 'TM_CA: ' + clickmod,
                           eVar14: 'TM_CA: ' + clickmod,
                           eVar13: 'TM_CA: ' + clickmod
                  },
                 clickLink = clickmod,
                   newPage = false
                  );
      if(inclusiveLink){
         this.data.prop14 = "";
         this.data.linkTrackVars = this.data.linkTrackVars.gsub(/,prop14,eVar14/,"");
       }

      tracking_vars = tracking_vars || {};
      for ( var tv in tracking_vars ) {
          this.data[tv] = tracking_vars[tv];
          this.data.linkTrackVars += ',' + tv;
      }

      this.handleClick();
     },
    navigation_link2: function( clicklink, options ){
        options = Object.extend( {
            np: false,
            newWin: false,
            tracking_vars: {}
        }, options );

        this.data = Object.extend({},{
            linkTrackVars: 'prop14,eVar14',
            linkTrackEvents: 'event27',
            prop14: 'TM_CA: ' + clicklink,
            eVar14: 'TM_CA: ' + clicklink
        },
            clickLink = clicklink,
            newPage = options.np,
            newWindow  = options.newWin
        );

        for ( var tv in options.tracking_vars ) {
            this.data[tv] = options.tracking_vars[tv];
            this.data.linkTrackVars += ',' + tv;
        }

        tm_omni_temp.set('location_path',options.nav_url);
        this.handleClick();
    },
  navigation_link: function(clicklink,np,nav_url,newWin){
         if(!np){np= false;}
         if(newWin != false){newWin = true;}
         this.data = Object.extend({},{
                   linkTrackVars: 'prop14,eVar14',
                   linkTrackEvents: 'event27',
                          prop14: 'TM_CA: ' + clicklink,
                          eVar14: 'TM_CA: ' + clicklink
                  },
                 clickLink = clicklink,
                   newPage = np,
                newWindow  = newWin
                  );
      tm_omni_temp.set('location_path',nav_url);
      this.handleClick();
     },
 trackomni_favoriteshare: function(lTV,lTE,clicklink){
         count = 0;
         $A(lTV).each(function(d){
            tm_omn[d] = (d=='products' ? ';' : '' ) + lTE[count];
            count++
         });
         this.data = Object.extend({},{
                   linkTrackVars: 'prop14,eVar14,' + lTV.join(','),
                 linkTrackEvents: lTE.join(','),
                          prop14: 'TM_CA: ' + clicklink,
                          eVar14: 'TM_CA: ' + clicklink
                  },
                 clickLink = clicklink,
                   newPage = false
                  );

        if(!tm_omni_temp.get('shareclickSet')){
           this.handleClick();
           tm_omni_temp.set('shareclickSet','1');
           setTimeout("tm_omni_temp.unset('shareclickSet')",1500);
         }

 }
});
var omniTracking = new omniCustomClick();


TMDebug = {
    gen_tlog: function() {
        return function(){};
    }
};











    createNamespace('TM.MetricsCollection');
    TM.MetricsCollection.timings = {
                  facade: function(){},
       initializeMetrics: function(){}
    }


    document.cookie = "TMSID=" + GetCookie("SID") + ";path=/;domain=.ticketmaster.ca;";


var promise_memberData_dataLoaded = undefined;

var _MEMBER_DATA = undefined;

var promise_wallpaperAdvertisement_checked = undefined;
var resolve_wallpaperAdvertisementSettled = undefined;
var get_wallpaperAdvertisementSettled = undefined;

(function () {
    var deferred_wallpaperAdvertisement_checked = jQuery.Deferred();
    promise_wallpaperAdvertisement_checked = deferred_wallpaperAdvertisement_checked.promise();

    var _wallpaperAdvertisementSettled = undefined;

    get_wallpaperAdvertisementSettled = function () {
        return _wallpaperAdvertisementSettled;
    };

    resolve_wallpaperAdvertisementSettled = function (value) {
        if (typeof value !== 'undefined' && typeof _wallpaperAdvertisementSettled === 'undefined') {
            _wallpaperAdvertisementSettled = value;
            deferred_wallpaperAdvertisement_checked.resolve(_wallpaperAdvertisementSettled);
            return value;
        } else {
            return undefined;
        }
    };
})();

jQuery( function () {
    var checkWallpaperAdvertisement = function () {
        var contentWrap = jQuery('#contentWrap');
        return Boolean(contentWrap[0] && ( !(/defaultImage\.gif|mosaic-body\.png/i).test( contentWrap.css('background-image') ) && contentWrap.css('background-image') !== 'none' ));
    };

    if (checkWallpaperAdvertisement()) {
        resolve_wallpaperAdvertisementSettled(true);
    } else {
        setTimeout( 
            function () {
                resolve_wallpaperAdvertisementSettled( checkWallpaperAdvertisement() );
            },
            typeof __RECOMMENDATIONS === 'undefined' ? 1000 : __RECOMMENDATIONS.SETTINGS.WALLPAPER_ADVERTISEMENT_TIMEOUT
        );
    }
} );



;(function( $, window, document, undefined ) {
createNamespace('TM.Tracking.satellite');

TM.Tracking.satellite = function(){
  var taggingData = {"pageLevelData":{"pageType":"Artist: On Sale: List","language":"en-ca","searchStatus":"","channel":"Artist","suggestTerm":"","domain":"ca","searchTerm":"","pageDetail":"TM_CA: Artist: 875503: FIFA Women’s World Cup Canada 2015"},"venueData":{"country":"","zip":"","city":"","vid":"","stateRegion":"","name":0},"mergedData":{"changeset":"0","loaded":{},"dataset":{}},"purchaseData":{"ticketQuantity":"","insurance":"","taxTotal":"","upsellTotal":"","deliveryTotal":"","orderTotal":"","ticketTotal":"","feesTotal":"","orderID":"","products":""},"eventData":{"time":"","date":"","name":"FIFA Women’s World Cup Canada 2015","type":"","eid":""},"callbacks":{},"artistData":{"aid":"875503","majorCategory":{"name":"","id":""},"primaryName":"FIFA Women’s World Cup Canada 2015","minorCateogry":{"name":"","id":"11"},"organization":"TM"},"sessionData":{"marketID":({'object':1}[typeof tm_omni_temp]) ? tm_omni_temp.get('omnMID') : '',"sid":GetCookie('SID') ? GetCookie('SID') : '',"mid":GetCookie('MID') ? GetCookie('MID') : '',"bid":GetCookie('BID') ? GetCookie('BID') : '',"promotionID":"","brand":"none","promoterID":""}};
  return {
    data : taggingData
  }
}();
window.digitalData = {"page":{"pageInfo":{"onsiteSearchTerm":"","referringURL":document.referrer,"hostSystem":"","pageType":"Artist: On Sale: List","onsiteSearchSuggestTerm":"","language":"en-ca","promotionID":"","geoRegion":"ca","promoterID":"","onsiteSearchStatus":"","pageID":"TM_CA: Artist: 875503: FIFA Women’s World Cup Canada 2015","pageName":"TM_CA: Artist: On Sale: List","destinationURL":document.location.href,"sysEnv":"desktop","pageChannel":"Artist"},"category":{"primaryCategory":"","primaryCategoryID":"","subCategory1":"","subCategory1ID":"11","organization":"TM"},"attributes":{"secondaryArtistName":"","venueID":"","artistName":"FIFA Women’s World Cup Canada 2015","eventTime":"","brand":"none","eventResaleEligible":0,"modulesAvailable":"","state":"","artistID":"875503","city":"","secondaryArtistID":"","eventOnsaleTime":"0","country":"","eventID":"","eventName":0,"zip":"","venueName":0,"eventDate":""}},"version":".1","user":[],"pageInstanceID":"TM_CA: Artist: 875503: FIFA Women’s World Cup Canada 2015","event":[],"cart":{"attributes":{"ticketQuantity":0}}};

})(jQuery, window, document );
 











var avs_globals;
    avs_globals = {
        avs_enabled : 1,
             avsXhr : 0,
           partners : {12 : {id : 11,partner : true},1 : {id : 12,partner : true},2 : {id : 12,partner : true},3 : {id : 12,partner : true},4 : {id : 12,partner : true},5 : {id : 12,partner : true},6 : {id : 12,partner : true},7 : {id : 12,partner : true},8 : {id : 12,partner : true},9 : {id : 12,partner : true},10 : {id : 12,partner : true},11 : {id : 12,partner : true}},
      status_onsale: 1,
               url : 'http://www.ticketmaster.ca/json/avs',
             image : 'http://s1.ticketm.net/tm/en-ca/img/sys/common_new/icon_availability.png',
          moreInfo : "More Info",
        messaging : {
                      1 : { message: "NOT MANY LEFT", showIcon: false },
                      2 : { message: "NO TICKETS RIGHT NOW", showIcon: true }
                    }
    };



//<![CDATA[

    new CookieTree( '_E' ).remove( 'flags' );



    TMCookie.remove( 'CART', { domain: js_cookie_domain } );
    TMCookie.remove( 'CART_SAVE_FAIL', { domain: js_cookie_domain } );
    TMCookie.remove( 'NTF', { domain: js_cookie_domain } );
//]]>



    if (typeof $BV !== "undefined") {
      var mid_cookie = GetCookie('MID');
      $BV.configure("global", {
        submissionContainerUrl: "http://www.ticketmaster.ca/review",
        submissionReturnUrl: "",
        submissionContainerUrlParameters: ""
      });
    }

    var totalReviews;
    var extraWT = new Array();

    /* Track Read link on photo popup. Called from Bazaarvoice code. */
    function omni_track_read_links() {
        omniTracking.navigation_link('Artist_Click_Reviews_FanPhotosReadReview');
    }

    /* Track prev and next arrows on photo popup. Called from Bazaarvoice code. */
    function omni_track_scroll_photos() {
        omniTracking.navigation_link('Artist_Click_Reviews_FanPhotosScroll');
    }
            /*  track the click on the read this review  */
   function reviewRoundup(){
            var read_this_review = $$('a[name="BV_TrackingTag_Review_Display_MediaGallery_PopIn_GoToContent"]');
            var next_prev_arrow = $$('a[name^="BV_TrackingTag_Review_Display_MediaGallery_PopInNav"]');
            read_this_review.each( function(t){
                if( $(t) ){
                    $(t).observe('click',function(){
                        omniTracking.navigation_link('Artist_Click_Reviews_FanPhotosReadReview');
                        setTimeout("reviewRoundup()",500);
                    });
                }
            });
            next_prev_arrow.each( function(t){
                if( $(t) ){
                    $(t).observe('click',function(){
                        omniTracking.navigation_link('Artist_Click_Reviews_FanPhotosScroll');
                        setTimeout("reviewRoundup()",500);
                    });
                }
            });
    }
    function ratingsDisplayed(totalReviewsCount, avgRating, ratingsOnlyReviewCount, recommendPercentage, productID) {
        totalReviews = totalReviewsCount;
        if (totalReviewsCount == 0) {
            var bvRevCntr = document.getElementById("BVRRContainer");
            
            if (bvRevCntr) { bvRevCntr.style.display = "none"; }

            // extraWT.push('Artist_Reviews_No');
            isReviews = 'Rn';
            var link = $$('a[name="BV_TrackingTag_Rating_Summary_1_WriteReview_875503"]');
            if( $(link.first()) ) {
                $(link.first()).href = $(link.first()).href.replace(/%26tm_link%3D\w+/,'');
                $(link.first()).observe('click', function(){
                    omniTracking.module_link('Artist_Click_Reviews_HeaderWriteFirst');
                });
            }
       
         }
        else {
             var bvRevCntr = document.getElementById("BVRRContainer");
             if (bvRevCntr) {
                bvRevCntr.style.display = "block";
                // Add an anchor tag for the Reviews container when there are reviews, i.e. the container will not be collapsed.
                $('ArtistPageReviews').innerHTML = '<a name="reviews"></a>';
             }
            //totalReviewsCount;
            extraWT.push('Artist_Reviews_Yes');
            isReviews = 'Ry';

            var link = $$('a[name="BV_TrackingTag_Rating_Summary_1_ReadReviews_875503"]');
            if( $(link.first()) ) {
                $(link.first()).observe('click', function(){
                    omniTracking.module_link('Artist_Click_Reviews_HeaderReadRev');
                });
            }
            var write_link = $$('a[name="BV_TrackingTag_Review_Display_WriteReview"]');
            if( $(write_link.first()) ) {
                $(write_link.first()).href = $(write_link.first()).href.replace(/%26tm_link%3D\w+/,'');
                $(write_link.first()).observe('click', function(){
                    omniTracking.module_link('Artist_Click_Reviews_WriteRev');
                });
            }
            var all = $$('a[name^="BV_TrackingTag_Review_Display_PageNumber"]');
            var next = $$('a[name^="BV_TrackingTag_Review_Display_Next"]');
            var prev = $$('a[name^="BV_TrackingTag_Review_Display_Prev"]');
            all = all.concat(next,prev);
            all.each( function(t){
                if( $(t) ) {
                    $(t).observe('click', function(){
                        omniTracking.module_link('Artist_Click_Reviews_Pagination');
                    });
                }
            });
            var all_rev = $$('a[name^="BV_TrackingTag_Review_Display_ReadAllReviews_"]');
            all_rev.each( function(t){
                if( $(t) ) {
                    $(t).observe('click', function(){
                        omniTracking.module_link('Artist_Click_Reviews_SeeAll_SpecificReviewer');
                    });
                }
            });

            /* Add tracking for media gallery.  Track click on a photo. */

            var photo_popup_link = $$('a[name="BV_TrackingTag_Review_Display_MediaGallery_ShowPopIn"]');
            photo_popup_link.each( function(t){
                if( $(t) ){
                    $(t).observe('click', function(){
                        omniTracking.navigation_link('Artist_Click_Reviews_FanPhotosOpen');
                        setTimeout("reviewRoundup()",500);
                     });
                }
            });
            /* Track click on bookmark and share icons. */
            var share_bookmarks = $$('a[name^="BV_TrackingTag_Review_Display_SocialBookmark"]');
            share_bookmarks.each( function(t){
                if( $(t) ){
                    $(t).observe('click',function(){
                        omniTracking.navigation_link('Artist_Click_Reviews_FanPhotosShare');
                    });
                }
            });
        }

        // Other custom items leveraging these values.
        // TODO: insert Web Analytics tracking here
    }


//<![CDATA[

// <!--
// This code below extracts the contents of the
// location.search and conveniently seperates
// the name and value into a usable form.
// Don't alter this code.
//  -->
function replace(str, from, to) {
    var i = str.indexOf(from);
    if (!from || !str || i == -1) return str;
    var newstr = str.substring(0, i) + to;
    if (i+from.length < str.length)
        newstr += replace(str.substring(
        i+from.length,str.length),from,to);
    return newstr;
}
function getQry(nm)
{
    if (!location.search) return '';
    var i, j, qry;
    qry = location.search.substring(1);
    i = qry.indexOf(nm)+nm.length+1;
    if (i == nm.length) return '';
    j = qry.indexOf('&',i);
    if (j+1) qry = qry.substring(i,j);
    else     qry = qry.substring(i);
    return unescape(replace(qry, '+', ' '));
}

function substitute(str, from, to) {
    var i = str.indexOf(from);
    if (!from || !str || i == -1) return str;
    var newstr = str.substring(0, i);
    if (i+from.length < str.length)
        newstr += replace(str.substring(
        i+from.length,str.length),from);
    return newstr;

}
function convert(nm)
{
    if (!location.search) return '';
    var i, j, qry;
    qry = location.search.substring(1);
    i = qry.indexOf(nm)+nm.length+1;
    if (i == nm.length) return '';
    j = qry.indexOf('&',i);
    if (j+1) qry = qry.substring(i,j);
    else     qry = qry.substring(i);
    return unescape(substitute(qry, '+'));
}


function gener_seatven(x,y){
var newx;
var cssval=aolcsscheck();
  if (getQry('style') || cssval) {
    newVal=(cssval) ? cssval : getQry('style');
    newx = x + "?style=" +  newVal;
  }
  else {
    newx = x;
  }
     windowabandon = window.open(newx,y,'width=800,height=600,toolbar=0,location=0,directories=0,status=0,scrollbars=1,menubar=0,resizable=1');
}
function aolcsscheck(){
  var aolcss = new Array ('aolboxoffice','aolsvcboxoffice','aolsvcsportsbox','aolsvcmusicbox','africanaboxoffice','nsboxoffice');
  for(y=0;y < aolcss.length;y++){
      if(document.URL.indexOf('brand='+aolcss[y])!=-1){return aolcss[y];}
      }
  return false;
}

function grabUrl() {
   var ticketPath = "http://s1.ticketm.net/tm/en-ca/img/sys/exchange/"
   TMObject(mName).SetVariable("serverUrl", ticketPath);

   var tmPath = "http://www.ticketmaster.ca/"
   TMObject(mName).SetVariable("tmUrl", tmPath);

}

function starRatingDisplay(rating) {
    var star_rating = (rating - parseInt(rating)).toFixed(1);    var offset;
    switch (star_rating) {
        case "0.1":       
             if(parseInt(rating) == 0 || parseInt(rating) == 1){
                 offset = 0;
             }  
             else{
                 offset = 1 - parseInt(rating); 
             }      
             break
        case "0.2": case "0.3":
             offset = 7;           
             break
        case "0.4": case "0.5": case "0.6":
             offset = 8;       
             break
        case "0.7": case "0.8":
             offset = 9;
             break
        case "0.9":
             if(parseInt(rating) == 0 ){
                 offset = 15;
             }
             else if(parseInt(rating) == 4 ){
                 offset = 14;
             }    
             else{
                 offset = 15 - parseInt(rating);
             }                  
             break
        default: 
             if(parseInt(rating) == 1 ){
                 offset = 0;
             }
             else if(parseInt(rating) == 5 ){
                 offset = -1;
             }         
             else{
                 offset = 1 - parseInt(rating);
             }
             break
     }
    var final_display_percent = ( parseInt(rating) * 15 +  offset ) + "px";
    return final_display_percent;
 }

//////////////////////////////////////////////////////////////////////////
// Change Location JS for Top Nav and Browse Box
//////////////////////////////////////////////////////////////////////////
    var reg_ex = new RegExp("&eacute;","g");
    var replaceItem = '\u00E9';

var location_text = 'City or Postal Code';
location_text = location_text.replace(reg_ex,replaceItem);

var page_context_uri = "G0aHvnTsaK1hnMNbv3aM1EVwtGpM_EO1cXvdXu4aYa5GwwVMX8x1iXG32i8Pe9dYoNA";


            ISCLanding.setup({type: "artist_id", id:"875503"});
//]]>


//////////////////////////////////////////////////////////////////////////
// Search Suggest JS for Search Box
//////////////////////////////////////////////////////////////////////////
var global = new Hash();
var search_suggest = null;global.set('cancel_hide', 0);
global.set('opens_in_a_new_window', 'opens in a new window'); // for shoppinglist and all of the situation that need to use the string 'opens in a new window'. 
var KEY = {
            UP: 38,
            DOWN: 40,
            ESC: 27,
            ENTER: 13
    };

Ajax.Request.prototype.abort = function() {
    this.transport.onreadystatechange = Prototype.emptyFunction;
    this.transport.abort();
    Ajax.activeRequestCount--;
};

String.prototype.decodeSuggestItem=function() {
    return this.replace(/\&amp\;/g, '\&').replace(/\&gt\;/g, '\>').replace(/\&lt\;/g, '\<').replace(/\&quot\;/g, '\'').replace(/\&\#39\;/g, '\'');
};

String.prototype.encodeSearchTerm=function(){
    return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&#34;").replace(/\'/g,"&#39;");
};

var SearchSuggest = Class.create({
    initialize: function(mode) {
        this.mode = mode !== undefined && mode === SearchSuggest.MODES.DIRECT ? SearchSuggest.MODES.DIRECT : SearchSuggest.MODES.STANDARD;
        this.index = 0;
        this.keyword = '';
        this.event = null;
        this.length = 0;
        this.elements = null;
        this.reset();
    },
    reset: function() {
        this.index = -1;
        var suggest = $("search-suggest") || $("searchSuggest");
        suggest.hide();
        $("searchSuggest-result").update('');
        this.elements = null;
        $('search_id').name = "";
        $('search_id').value = "";
    },
    buildTable: function(data) {
        this.reset();
        var suggest_ul = $("searchSuggest-result");
        var _parent = this;
        var link_href;
        var parsed_uri,
            parsed_query;
        var dataItem;
        for( var i=0; i < 10 && i < data.length; i++ ) {
            dataItem = data[i];
            var search_type = dataItem.VenueId ? "vid" : "aid";
            var search_id = dataItem.AttractionId ? dataItem.AttractionId[0] : dataItem.VenueId;
            var item_name = dataItem.Autocomplete;
            var li = new Element('li', {"li_index":i, "searchType":search_type, "searchId":search_id, "itemName":item_name});
            Event.observe(li, 'mouseover', function() {
                global.set('cancel_hide', 1);
                _parent.updateTable(this);
            });
            Event.observe(li, 'mouseout', function(e) {
                global.set('cancel_hide', 0);
                this.className = "";
            });
            Event.observe(li, 'click', function(e) {
                _parent.updateHiddenId(this);
                if ( _parent.mode === SearchSuggest.MODES.STANDARD ) {
                  e.stop();
                  $('search_form').submit();
                }
            });
            var event_count = dataItem.UpcomingEvents + " events";
            var follow_span = new Element('span', {"class":"suggest-cat"});
            if ( dataItem.VenueId ) {
                var venue_follow_str = dataItem.CityState;
                    venue_follow_str = venue_follow_str + " - " + event_count;                follow_span.innerHTML = "(" + venue_follow_str + ")";
            }
            else {
                var major_cate = dataItem.MainMajorGenre;
                var minor_cate = dataItem.MainMinorGenre;
                var major_id = dataItem.MajorGenreId[0];
                var arr_str = new Array();
                var tmp_str;
                //control Search Suggest display by combination of Domian & Major Cat
                switch (major_id) {
                    //music
                    case 10001 : 
                        arr_str.push(major_cate);
                        arr_str.push(minor_cate);
                        arr_str.push(event_count);                        break;
                    //art&theater
                    case 10002 :
                        arr_str.push(major_cate);
                        arr_str.push(minor_cate);
                        arr_str.push(event_count);                        break;
                    //family
                    case 10003 :
                        arr_str.push(major_cate);
                        arr_str.push(minor_cate);
                        arr_str.push(event_count);                        break;
                    //sports
                    case 10004 :             
                        arr_str.push(major_cate);
                        arr_str.push(minor_cate);
                        arr_str.push(event_count);                        break;
                    default :
                        break; 
                }

                if ( arr_str.length > 0) {
                    tmp_str = arr_str.join(" - ");
                    follow_span.innerHTML = "(" + tmp_str + ")";
                }
            }
            var a = new Element('a');
            a.innerHTML = dataItem.AutocompleteHighlight;
            if (this.mode === SearchSuggest.MODES.DIRECT) {
                link_href = undefined;
                if (dataItem.VenueId) {
                    link_href = "http://www.ticketmaster.ca" + '/venue/' + dataItem.VenueId;
                } else if (dataItem.AttractionId && dataItem.AttractionId[0]) {
                    link_href = "http://www.ticketmaster.ca" + '/artist/' + dataItem.AttractionId[0];
                }
                if (link_href) {
                    parsed_uri = __GLOBALS.util.parseURI(link_href);
                    if (parsed_uri) {
                        parsed_query = __GLOBALS.util.parseAndDecodeURIQuery(parsed_uri.query);
                        if (!parsed_query) {
                            parsed_query = {};
                        }
                        parsed_query.tm_link = "tm_header_search";
                        parsed_uri.query = __GLOBALS.util.encodeAndBuildURIQuery(parsed_query);
                        link_href = __GLOBALS.util.buildURI(parsed_uri);
                    }
                    li.setAttribute('data-directURL', link_href);
                    a.href = link_href;
                }
            }
            a.appendChild(follow_span);
            li.appendChild(a);
            suggest_ul.insert(li);
        }
        var suggest = $("search-suggest") || $("searchSuggest");
        suggest.show();
        Event.observe(suggest, 'mouseout', function(e) {
            this.index = -1;
        });
        this.elements = $$("#searchSuggest-result li");
        this.length = this.elements.length;
    },
    getData: function() {
        var _parent = this;
        var opt = {
            method: "get",
            onSuccess: function(t) {
                var data = t.responseText.evalJSON(true);
                var suggest = $("search-suggest") || $("searchSuggest");
                suggest.hide();
                if(data.response.docs.length > 0) {
                    _parent.buildTable(data.response.docs);
                }
            },
            onFailure: function() {
                alert("An error occurred, please try again later.");
            }
        };
        var prev_ajax = global.get('myajax');
        if ( prev_ajax ) {
            prev_ajax.abort();
        }
        var requestURL = 'http://www.ticketmaster.ca/json/search/suggest?q=' + encodeURIComponent(this.keyword) ;
        var curr_ajax = new Ajax.Request(requestURL, opt);
        global.set('myajax', curr_ajax);
    },
    updateTable: function(li) {
        if ( this.index >= 0 ) {
            this.elements[this.index].className = "";
        }
        li.className = "selected";
        this.index = li.getAttribute('li_index');
    },
    updateHiddenId: function(li) {
        var search_type = li.getAttribute('searchType');
        var search_id = li.getAttribute('searchId');
        var item_name = li.getAttribute('itemName');
        $("search_input").value = item_name.decodeSuggestItem();
        $('search_id').name = search_type;
        $('search_id').value = search_id;
    },
    autoComplete: function(keyword) {
        this.keyword = keyword;
        this.getData();
    },
    prev: function() {
        if ( this.elements ) {
            if ( this.index > 0 ) {
                this.elements[this.index].className = "";
                this.index--;
                this.elements[this.index].className = "selected";
                this.updateHiddenId(this.elements[this.index]);
            }
            else {
                this.index = -1;
                initHiddenParam();
                this.elements[0].className = "";
                $("search_input").value = $("org_input").value;
            }
        }
    },
    next: function() {
        if ( this.elements ) {
            if ( this.index >= 0 ) {
                this.elements[this.index].className = "";
            }
            this.index = (++this.index) % this.length;
            this.elements[this.index].className = "selected";
            this.updateHiddenId(this.elements[this.index]);
        }
    },
    currentElement: function () {
        return this.elements && this.elements[this.index] ? this.elements[this.index] : null;
    }
});

SearchSuggest.MODES = {
    STANDARD: "standardMode",
    DIRECT: "directMode"
};

function showSuggestions() {
    var event = arguments[0] || event;
    var keyword = $("search_input").value;
    if ( keyword.length < 3 ) {
            $("org_input").value = keyword;
            var suggestion = $("searchSuggest") || $("search-suggest") || $("search-suggest");
            suggestion.hide();
            var exist_ajax = global.get('myajax');
            if ( exist_ajax ) {
                exist_ajax.abort();
            }
    }
    else {
        switch (event.keyCode) {
                case KEY.UP:
                    search_suggest.prev();
                    break;
                case KEY.DOWN:
                    search_suggest.next();
                    break;
                case KEY.ESC:
                    search_suggest.reset();
                    $("search_input").value = $("org_input").value;
                    break;
                case KEY.ENTER:
                    break;
                default:
                    $("org_input").value = keyword;
                    sendRequest.delay("0.1", keyword);
                    break;
        }
    }
}



createNamespace('TM.Ads');
TM.Ads.iframeAssets = TM.Ads.iframeAssets || [];


if (typeof TM != "undefined" && TM.config) {
    TM.config.media_server = "http://s1.ticketm.net/tm/en-ca";
    TM.config.page_type = "artist";
    TM.config.current_domain = "ca";
}


    var tmp_ttid = get_url_param('ttid');
    var tmp_ot = get_url_param('ot');
    if (tmp_ttid) {
        new CookieTree('_E').set('ttid',tmp_ttid);
    }
    if (tmp_ot) {
        new CookieTree('_E').set('ot',tmp_ot);
    }
    


  var optical_test_preferences = null;
  var is_optical_test_preferences_active = true;










        deleteCookie("MAJOR_CATEGORY");
    




var _satellite = {
  "override": {
    "host": {
      "http": "assets.adobedtm.com",
      "https": "assets.adobedtm.com"
    }
  }
};


                googletag.cmd.push(function() {

                //enable async
                    googletag.pubads().enableSingleRequest();
                    googletag.pubads().enableAsyncRendering();
                    googletag.pubads().collapseEmptyDivs();

                //Set targeting for all ad slots

                    googletag.pubads().setTargeting("dmaid","0")
                            .setTargeting("lang","en-ca")
                            .setTargeting("page","artist")
                            .setTargeting("brand","0")                            .setTargeting("majorcatid","10004")                            .setTargeting("minorcatid","11")                            .setTargeting("artistid","875503")                        ;

                    googletag.defineSlot('/6025/ca/sports/soccer/artist',                             [[1,1],[728, 90]], 'div-gpt-ad-slot-501')
                        .addService(googletag.pubads())
                        .setTargeting("pagepos", "501");

                    googletag.defineSlot('/6025/ca/sports/soccer/artist',  [[300, 250], [300, 600]]  , 'div-gpt-ad-slot-502')
                        .addService(googletag.pubads())
                        .setTargeting("pagepos", "502");


                    googletag.defineSlot('/6025/ca/sports/soccer/artist', [300, 250], 'div-gpt-ad-slot-522')
                        .addService(googletag.pubads())
                        .setTargeting("pagepos", "522");
                    


                    googletag.defineSlot('/6025/ca/sports/soccer/artist', [300, 35],'div-gpt-ad-slot-595')
                        .addService(googletag.pubads())
                        .setTargeting("pagepos", "595");

                    googletag.defineSlot('/6025/ca/sports/soccer/artist', [300, 60],'div-gpt-ad-slot-596')
                        .addService(googletag.pubads())
                        .setTargeting("pagepos", "596");
                                        
                    googletag.pubads().addEventListener('slotRenderEnded', function(event) {
                        jQuery("div.gpt-ad-container iframe").attr("title","Advertisement content");
                        if(event.slot && event.slot.d && event.slot.d.pagepos[0] == 501){
                            var leaderboard = jQuery("#div-gpt-ad-slot-501");
                            if(leaderboard.height() <= 1){
                                leaderboard.hide();
                            }else{
                                leaderboard.addClass('leaderboard-padd');
                            }
                        }
                    });
                    googletag.enableServices();
                });        


You must set your browser to accept cookies and to enable Javascript in order to access certain functions of this site, including the purchase of tickets.    


Skip to main content

var states = new Object();
    states.maps = {"BC":{"abbrev":"BC","country_id":"36","state_id":"67","name":{"fr-ca":"Colombie-Britannique","en-gb":"British Columbia","es-us":"British Columbia","en-us":"British Columbia","en-ca":"British Columbia"}},"NY":{"abbrev":"NY","country_id":"222","state_id":"43","name":{"fr-ca":"New York","en-gb":"New York","es-us":"New York","en-us":"New York","en-ca":"New York"}},"YT":{"abbrev":"YT","country_id":"36","state_id":"78","name":{"fr-ca":"Yukon","en-gb":"Yukon","es-us":"Yukon","en-us":"Yukon","en-ca":"Yukon"}},"PA":{"abbrev":"PA","country_id":"222","state_id":"51","name":{"fr-ca":"Pennsylvania","en-gb":"Pennsylvania","es-us":"Pennsylvania","en-us":"Pennsylvania","en-ca":"Pennsylvania"}},"PR":{"abbrev":"PR","country_id":"222","state_id":"52","name":{"fr-ca":"Puerto Rico","en-gb":"Puerto Rico","es-us":"Puerto Rico","en-us":"Puerto Rico","en-ca":"Puerto Rico"}},"DC":{"abbrev":"DC","country_id":"222","state_id":"16","name":{"fr-ca":"District Of Columbia","en-gb":"District Of Columbia","es-us":"District Of Columbia","en-us":"District Of Columbia","en-ca":"District Of Columbia"}},"WV":{"abbrev":"WV","country_id":"222","state_id":"63","name":{"fr-ca":"West Virginia","en-gb":"West Virginia","es-us":"West Virginia","en-us":"West Virginia","en-ca":"West Virginia"}},"NM":{"abbrev":"NM","country_id":"222","state_id":"42","name":{"fr-ca":"New Mexico","en-gb":"New Mexico","es-us":"New Mexico","en-us":"New Mexico","en-ca":"New Mexico"}},"MO":{"abbrev":"MO","country_id":"222","state_id":"36","name":{"fr-ca":"Missouri","en-gb":"Missouri","es-us":"Missouri","en-us":"Missouri","en-ca":"Missouri"}},"NH":{"abbrev":"NH","country_id":"222","state_id":"40","name":{"fr-ca":"New Hampshire","en-gb":"New Hampshire","es-us":"New Hampshire","en-us":"New Hampshire","en-ca":"New Hampshire"}},"MA":{"abbrev":"MA","country_id":"222","state_id":"32","name":{"fr-ca":"Massachusetts","en-gb":"Massachusetts","es-us":"Massachusetts","en-us":"Massachusetts","en-ca":"Massachusetts"}},"MT":{"abbrev":"MT","country_id":"222","state_id":"37","name":{"fr-ca":"Montana","en-gb":"Montana","es-us":"Montana","en-us":"Montana","en-ca":"Montana"}},"MN":{"abbrev":"MN","country_id":"222","state_id":"34","name":{"fr-ca":"Minnesota","en-gb":"Minnesota","es-us":"Minnesota","en-us":"Minnesota","en-ca":"Minnesota"}},"MP":{"abbrev":"MP","country_id":"222","state_id":"46","name":{"fr-ca":"Northern Mariana Islands","en-gb":"Northern Mariana Islands","es-us":"Northern Mariana Islands","en-us":"Northern Mariana Islands","en-ca":"Northern Mariana Islands"}},"TX":{"abbrev":"TX","country_id":"222","state_id":"57","name":{"fr-ca":"Texas","en-gb":"Texas","es-us":"Texas","en-us":"Texas","en-ca":"Texas"}},"NJ":{"abbrev":"NJ","country_id":"222","state_id":"41","name":{"fr-ca":"New Jersey","en-gb":"New Jersey","es-us":"New Jersey","en-us":"New Jersey","en-ca":"New Jersey"}},"NV":{"abbrev":"NV","country_id":"222","state_id":"39","name":{"fr-ca":"Nevada","en-gb":"Nevada","es-us":"Nevada","en-us":"Nevada","en-ca":"Nevada"}},"AB":{"abbrev":"AB","country_id":"36","state_id":"66","name":{"fr-ca":"Alberta","en-gb":"Alberta","es-us":"Alberta","en-us":"Alberta","en-ca":"Alberta"}},"WA":{"abbrev":"WA","country_id":"222","state_id":"62","name":{"fr-ca":"Washington","en-gb":"Washington","es-us":"Washington","en-us":"Washington","en-ca":"Washington"}},"PW":{"abbrev":"PW","country_id":"222","state_id":"50","name":{"fr-ca":"Palau","en-gb":"Palau","es-us":"Palau","en-us":"Palau","en-ca":"Palau"}},"AL":{"abbrev":"AL","country_id":"222","state_id":"1","name":{"fr-ca":"Alabama","en-gb":"Alabama","es-us":"Alabama","en-us":"Alabama","en-ca":"Alabama"}},"TN":{"abbrev":"TN","country_id":"222","state_id":"56","name":{"fr-ca":"Tennessee","en-gb":"Tennessee","es-us":"Tennessee","en-us":"Tennessee","en-ca":"Tennessee"}},"NS":{"abbrev":"NS","country_id":"36","state_id":"72","name":{"fr-ca":"Nouvelle-Écosse","en-gb":"Nova Scotia","es-us":"Nova Scotia","en-us":"Nova Scotia","en-ca":"Nova Scotia"}},"KS":{"abbrev":"KS","country_id":"222","state_id":"26","name":{"fr-ca":"Kansas","en-gb":"Kansas","es-us":"Kansas","en-us":"Kansas","en-ca":"Kansas"}},"UT":{"abbrev":"UT","country_id":"222","state_id":"58","name":{"fr-ca":"Utah","en-gb":"Utah","es-us":"Utah","en-us":"Utah","en-ca":"Utah"}},"AA":{"abbrev":"AA","country_id":"222","state_id":"7","name":{"fr-ca":"Armed Forces Americas","en-gb":"Armed Forces Americas","es-us":"Armed Forces Americas","en-us":"Armed Forces Americas","en-ca":"Armed Forces Americas"}},"CT":{"abbrev":"CT","country_id":"222","state_id":"14","name":{"fr-ca":"Connecticut","en-gb":"Connecticut","es-us":"Connecticut","en-us":"Connecticut","en-ca":"Connecticut"}},"MD":{"abbrev":"MD","country_id":"222","state_id":"31","name":{"fr-ca":"Maryland","en-gb":"Maryland","es-us":"Maryland","en-us":"Maryland","en-ca":"Maryland"}},"NB":{"abbrev":"NB","country_id":"36","state_id":"69","name":{"fr-ca":"Nouveau-Brunswick","en-gb":"New Brunswick","es-us":"New Brunswick","en-us":"New Brunswick","en-ca":"New Brunswick"}},"CA":{"abbrev":"CA","country_id":"222","state_id":"12","name":{"fr-ca":"California","en-gb":"California","es-us":"California","en-us":"California","en-ca":"California"}},"NT":{"abbrev":"NT","country_id":"36","state_id":"71","name":{"fr-ca":"Territoires du Nord-Ouest","en-gb":"Northwest Territories","es-us":"Northwest Territories","en-us":"Northwest Territories","en-ca":"Northwest Territories"}},"CO":{"abbrev":"CO","country_id":"222","state_id":"13","name":{"fr-ca":"Colorado","en-gb":"Colorado","es-us":"Colorado","en-us":"Colorado","en-ca":"Colorado"}},"AP":{"abbrev":"AP","country_id":"222","state_id":"11","name":{"fr-ca":"Armed Forces Pacific","en-gb":"Armed Forces Pacific","es-us":"Armed Forces Pacific","en-us":"Armed Forces Pacific","en-ca":"Armed Forces Pacific"}},"ON":{"abbrev":"ON","country_id":"36","state_id":"74","name":{"fr-ca":"Ontario","en-gb":"Ontario","es-us":"Ontario","en-us":"Ontario","en-ca":"Ontario"}},"VT":{"abbrev":"VT","country_id":"222","state_id":"59","name":{"fr-ca":"Vermont","en-gb":"Vermont","es-us":"Vermont","en-us":"Vermont","en-ca":"Vermont"}},"GA":{"abbrev":"GA","country_id":"222","state_id":"19","name":{"fr-ca":"Georgia","en-gb":"Georgia","es-us":"Georgia","en-us":"Georgia","en-ca":"Georgia"}},"AE":{"abbrev":"AE","country_id":"222","state_id":"6","name":{"fr-ca":"Armed Forces Other","en-gb":"Armed Forces Other","es-us":"Armed Forces Other","en-us":"Armed Forces Other","en-ca":"Armed Forces Other"}},"KY":{"abbrev":"KY","country_id":"222","state_id":"27","name":{"fr-ca":"Kentucky","en-gb":"Kentucky","es-us":"Kentucky","en-us":"Kentucky","en-ca":"Kentucky"}},"AK":{"abbrev":"AK","country_id":"222","state_id":"2","name":{"fr-ca":"Alaska","en-gb":"Alaska","es-us":"Alaska","en-us":"Alaska","en-ca":"Alaska"}},"SC":{"abbrev":"SC","country_id":"222","state_id":"54","name":{"fr-ca":"South Carolina","en-gb":"South Carolina","es-us":"South Carolina","en-us":"South Carolina","en-ca":"South Carolina"}},"LA":{"abbrev":"LA","country_id":"222","state_id":"28","name":{"fr-ca":"Louisiana","en-gb":"Louisiana","es-us":"Louisiana","en-us":"Louisiana","en-ca":"Louisiana"}},"NC":{"abbrev":"NC","country_id":"222","state_id":"44","name":{"fr-ca":"North Carolina","en-gb":"North Carolina","es-us":"North Carolina","en-us":"North Carolina","en-ca":"North Carolina"}},"GU":{"abbrev":"GU","country_id":"222","state_id":"20","name":{"fr-ca":"Guam","en-gb":"Guam","es-us":"Guam","en-us":"Guam","en-ca":"Guam"}},"MS":{"abbrev":"MS","country_id":"222","state_id":"35","name":{"fr-ca":"Mississippi","en-gb":"Mississippi","es-us":"Mississippi","en-us":"Mississippi","en-ca":"Mississippi"}},"NL":{"abbrev":"NL","country_id":"36","state_id":"70","name":{"fr-ca":"Terre-Neuve-et-Labrador","en-gb":"Newfoundland","es-us":"Newfoundland","en-us":"Newfoundland","en-ca":"Newfoundland and Labrador"}},"OK":{"abbrev":"OK","country_id":"222","state_id":"48","name":{"fr-ca":"Oklahoma","en-gb":"Oklahoma","es-us":"Oklahoma","en-us":"Oklahoma","en-ca":"Oklahoma"}},"VA":{"abbrev":"VA","country_id":"222","state_id":"61","name":{"fr-ca":"Virginia","en-gb":"Virginia","es-us":"Virginia","en-us":"Virginia","en-ca":"Virginia"}},"HI":{"abbrev":"HI","country_id":"222","state_id":"21","name":{"fr-ca":"Hawaii","en-gb":"Hawaii","es-us":"Hawaii","en-us":"Hawaii","en-ca":"Hawaii"}},"NE":{"abbrev":"NE","country_id":"222","state_id":"38","name":{"fr-ca":"Nebraska","en-gb":"Nebraska","es-us":"Nebraska","en-us":"Nebraska","en-ca":"Nebraska"}},"SD":{"abbrev":"SD","country_id":"222","state_id":"55","name":{"fr-ca":"South Dakota","en-gb":"South Dakota","es-us":"South Dakota","en-us":"South Dakota","en-ca":"South Dakota"}},"OH":{"abbrev":"OH","country_id":"222","state_id":"47","name":{"fr-ca":"Ohio","en-gb":"Ohio","es-us":"Ohio","en-us":"Ohio","en-ca":"Ohio"}},"WI":{"abbrev":"WI","country_id":"222","state_id":"64","name":{"fr-ca":"Wisconsin","en-gb":"Wisconsin","es-us":"Wisconsin","en-us":"Wisconsin","en-ca":"Wisconsin"}},"MH":{"abbrev":"MH","country_id":"222","state_id":"30","name":{"fr-ca":"Marshall Islands","en-gb":"Marshall Islands","es-us":"Marshall Islands","en-us":"Marshall Islands","en-ca":"Marshall Islands"}},"AZ":{"abbrev":"AZ","country_id":"222","state_id":"4","name":{"fr-ca":"Arizona","en-gb":"Arizona","es-us":"Arizona","en-us":"Arizona","en-ca":"Arizona"}},"MB":{"abbrev":"MB","country_id":"36","state_id":"68","name":{"fr-ca":"Manitoba","en-gb":"Manitoba","es-us":"Manitoba","en-us":"Manitoba","en-ca":"Manitoba"}},"ME":{"abbrev":"ME","country_id":"222","state_id":"29","name":{"fr-ca":"Maine","en-gb":"Maine","es-us":"Maine","en-us":"Maine","en-ca":"Maine"}},"WY":{"abbrev":"WY","country_id":"222","state_id":"65","name":{"fr-ca":"Wyoming","en-gb":"Wyoming","es-us":"Wyoming","en-us":"Wyoming","en-ca":"Wyoming"}},"NU":{"abbrev":"NU","country_id":"36","state_id":"73","name":{"fr-ca":"Nunavut","en-gb":"Nunavut","es-us":"Nunavut","en-us":"Nunavut","en-ca":"Nunavut"}},"PE":{"abbrev":"PE","country_id":"36","state_id":"75","name":{"fr-ca":"Île-du-Prince-Édouard","en-gb":"Prince Edward Island","es-us":"Prince Edward Island","en-us":"Prince Edward Island","en-ca":"Prince Edward Island"}},"OR":{"abbrev":"OR","country_id":"222","state_id":"49","name":{"fr-ca":"Oregon","en-gb":"Oregon","es-us":"Oregon","en-us":"Oregon","en-ca":"Oregon"}},"ID":{"abbrev":"ID","country_id":"222","state_id":"22","name":{"fr-ca":"Idaho","en-gb":"Idaho","es-us":"Idaho","en-us":"Idaho","en-ca":"Idaho"}},"FM":{"abbrev":"FM","country_id":"222","state_id":"17","name":{"fr-ca":"Federated States Of Micronesia","en-gb":"Federated States Of Micronesia","es-us":"Federated States Of Micronesia","en-us":"Federated States Of Micronesia","en-ca":"Federated States Of Micronesia"}},"RI":{"abbrev":"RI","country_id":"222","state_id":"53","name":{"fr-ca":"Rhode Island","en-gb":"Rhode Island","es-us":"Rhode Island","en-us":"Rhode Island","en-ca":"Rhode Island"}},"QC":{"abbrev":"QC","country_id":"36","state_id":"76","name":{"fr-ca":"Québec","en-gb":"Quebec","es-us":"Quebec","en-us":"Quebec","en-ca":"Quebec"}},"ND":{"abbrev":"ND","country_id":"222","state_id":"45","name":{"fr-ca":"North Dakota","en-gb":"North Dakota","es-us":"North Dakota","en-us":"North Dakota","en-ca":"North Dakota"}},"FL":{"abbrev":"FL","country_id":"222","state_id":"18","name":{"fr-ca":"Florida","en-gb":"Florida","es-us":"Florida","en-us":"Florida","en-ca":"Florida"}},"AS":{"abbrev":"AS","country_id":"222","state_id":"3","name":{"fr-ca":"American Samoa","en-gb":"American Samoa","es-us":"American Samoa","en-us":"American Samoa","en-ca":"American Samoa"}},"DE":{"abbrev":"DE","country_id":"222","state_id":"15","name":{"fr-ca":"Delaware","en-gb":"Delaware","es-us":"Delaware","en-us":"Delaware","en-ca":"Delaware"}},"IA":{"abbrev":"IA","country_id":"222","state_id":"25","name":{"fr-ca":"Iowa","en-gb":"Iowa","es-us":"Iowa","en-us":"Iowa","en-ca":"Iowa"}},"MI":{"abbrev":"MI","country_id":"222","state_id":"33","name":{"fr-ca":"Michigan","en-gb":"Michigan","es-us":"Michigan","en-us":"Michigan","en-ca":"Michigan"}},"IN":{"abbrev":"IN","country_id":"222","state_id":"24","name":{"fr-ca":"Indiana","en-gb":"Indiana","es-us":"Indiana","en-us":"Indiana","en-ca":"Indiana"}},"VI":{"abbrev":"VI","country_id":"222","state_id":"60","name":{"fr-ca":"Virgin Islands","en-gb":"Virgin Islands","es-us":"Virgin Islands","en-us":"Virgin Islands","en-ca":"Virgin Islands"}},"AR":{"abbrev":"AR","country_id":"222","state_id":"5","name":{"fr-ca":"Arkansas","en-gb":"Arkansas","es-us":"Arkansas","en-us":"Arkansas","en-ca":"Arkansas"}},"IL":{"abbrev":"IL","country_id":"222","state_id":"23","name":{"fr-ca":"Illinois","en-gb":"Illinois","es-us":"Illinois","en-us":"Illinois","en-ca":"Illinois"}},"SK":{"abbrev":"SK","country_id":"36","state_id":"77","name":{"fr-ca":"Saskatchewan","en-gb":"Saskatchewan","es-us":"Saskatchewan","en-us":"Saskatchewan","en-ca":"Saskatchewan"}}};
    states.trim = function( s ){ return s.replace( /^\s+|\s+$/, '' ); };
    states.mapToAbbrTag = function( info, lang ){
       if( lang == 'en-us' || lang == 'en-ca' || lang == 'fr-ca' ){
           return info.replace(/[^,.]+/g, function( s ){
               var s_trim = states.trim( s );
               if( states.maps.hasOwnProperty( s_trim ) )
                   return "<abbr title='" + states.maps[s_trim]["name"][lang] + "'>" + s + "</abbr>";
               return "<abbr title='" + s_trim + "'>" + s + "</abbr>";
           });
       }
       return info;
    }


<!--

function openWindow(theURL,winName,features) {
  window.open(theURL,winName,features);
}

//-->

var member_name = GetCookie("MNAME");
var check1 = GetCookie("MID");
var member_text = "";
var action_text;
if( member_name ) {
    member_name = member_name.stripScripts().stripTags().escapeHTML();
}

if ( check1 == null || check1.length == 0 ) {
     member_text = "";
     action_text = "Log In";
     member_name = null;
}
else {
     if( member_name != 'null' ) {
         member_text = ", " + member_name;
     }
     action_text = "Log Out";
}

function buildLink( myFlag ) {
     if( myFlag == "log" ) {
         if ( check1 == null || check1.length == 0 ) {
             var theLink = "https://www.ticketmaster.ca/member?";
         }
         else {
             var theLink = "https://www.ticketmaster.ca/member/logout";
         }
         document.write( "<a href=\"" + theLink + "\" class=\"passive\">");
     }
     else {
          if( check1 != null || check1.length != 0 ) {
               var theLink = "https://www.ticketmaster.ca/member/edit_subscriptions?tm_link=tm_alert_header";
          }
          else {
               var theLink = "http://www.ticketmaster.ca/ticketalerts/?tm_link=tm_alert_header";
          }
          document.write( "<a href=\"" + theLink + "\" class=\"active\" title=\"Sign Up \/ Log In for TicketAlerts\">");
     }
}


             googletag.cmd.push(function() {                    googletag.display('div-gpt-ad-slot-501');            });     
 
    var reg_ex = new RegExp("&eacute;","g");
    var replaceItem = '\u00E9';

var search_text = "Search Artist, Team, or Venue";
search_text = search_text.replace(reg_ex,replaceItem);

function checkSearchFormAction(form) {
    var current_suggest = typeof search_suggest !== 'undefined' && search_suggest ? search_suggest.currentElement() : null;
    if (typeof search_suggest !== 'undefined' && search_suggest && search_suggest.mode === SearchSuggest.MODES.DIRECT && current_suggest && current_suggest.getAttribute('data-directURL')) {
        window.location = current_suggest.getAttribute('data-directURL');
        return false;
    } else {
        return verifySearchString(form);
    }
}

function verifySearchString(form) {
    if(form.q.value.replace(/^\s*|\s*$/g,'') == "" || form.q.value == search_text ){
        alert(checkUni("Please enter search text."));
        form.q.focus();
        form.q.value = "";
        return false;
    }
    if (typeof(edp) != "undefined" && edp.active_mode == 'isc' && edp.isc.cart.items.length) {
        return edp.isc.cart.leaving_isc_dialog.on_form_submit_attempt(form);
    }
}

function createSearchSuggestion(isSuperNavMiniSearch) {

    search_suggest = search_suggest || new SearchSuggest( typeof searchSuggest_direct !== 'undefined' && searchSuggest_direct ? SearchSuggest.MODES.DIRECT : SearchSuggest.MODES.STANDARD );
        Event.observe($('search_input'), 'keyup', function(event){
            showSuggestions(event);
        });        if(isSuperNavMiniSearch || 1){
            Event.observe($('search_input'), 'focus', function(event) {
                change_placeholder_color(this.id, search_text);
            });
        }    Event.observe($('search_input'), 'blur', function(event) {
        if ( this.value == '' ) {
            this.value = search_text;
            this.style.color ='#898989';
        }            if(isSuperNavMiniSearch || 1){
                change_placeholder_color(this.id, search_text);
            }        if ( global.get('cancel_hide') == 0 ) {
            var suggest = $("search-suggest") || $("searchSuggest") || $("search-suggest");
            if(suggest){
                suggest.hide();
            }
            $("searchSuggest-result").update('');
            if (search_suggest.mode === SearchSuggest.MODES.DIRECT) {
                search_suggest.reset();
            }
            updateInputText(this);
        }
    });
};


Auto-suggest. Use up and down arrow keys to select suggestions.





  

Top Suggestions






    (function($){
        createNamespace('TM.global_header');
        $.extend(TM.global_header, {
            TM_SEARCH_TOGGLE : "{\"omn_domain_owner\":\"TM_CA:\",\"anchored_tab_enabled\":1}",
            TU : {
                searchPlaceholder: "Search Artist, Team, or Venue"
            }
        });
    }(jQuery));
                createSearchSuggestion();   
Music


Sports


Arts & Theatre


Family
 
VIP
 Deals   


 Error: please enter city or postal code or click "See All Cities" below.
Error: we could not find this location.  Please check your entry or click the "See All Cities" link below.
Change Location
We found multiple results matching "keyword".
                        Please choose from the list below                    









See All Cities
International





            <!--
                var location_items = {
                    "Chicagoland & Northern IL": "Chicagoland, Northern IL & Northern Indiana",
                    "Cleveland, Youngstown & More": "Cleveland, Youngstown, Akron & More",
                    "Minneapolis/St. Paul & More": "Greater Minneapolis - Saint Paul Area",
                    "": "",
                    "Memphis, Little Rock & More": "Memphis, Little Rock, Southhaven, Tupelo, Tunica & More",
                    "": "",
                    "All of Canada": "Canada"
                };

                var my_market = "Canada";

                var enter_to_change_location = "<span class='hideContent'> Enter to change location if needed.</span>";

                var location_box_market_name = GetCookie("MARKET_NAME");
                if( location_box_market_name ) {
                    location_box_market_name = location_box_market_name.base64decode().stripScripts().stripTags();
                }

                var targetElm = jQuery('#locName');
                var market_text = '';
                if( my_market.strip().empty() ) {
                    if( location_box_market_name ) {
                        my_market = location_box_market_name;
                    }
                }
                else if( my_market != location_box_market_name ) {
                    var npdma_c = GetCookie("NPDMA");
                    var ndma_c = GetCookie("NDMA");
                    if( ! ( npdma_c == ndma_c && '' == ndma_c ) && location_box_market_name ) {
                        my_market = location_box_market_name;
                    }
                }

                    market_text = my_market.escapeHTML() + enter_to_change_location;

                targetElm.html(market_text);

                var hover_text = my_market;

                if (location_items[my_market]) {
                    hover_text = location_items[my_market];
                }

                jQuery("#location-button").attr("title", hover_text);
           //-->
        

 Open My Account menu


Your Account
Edit Profile
Email & Mobile Preferences Payment Options Orders
Print My Tickets Transfer Tickets 




var is_home = '';
if( member_name ) {
    var user_greeting;

    

    if (member_name.length > 16) {
      user_greeting = limit_with_dots( member_name, 18, {truncated: '...', full: '...'} ) + ' Account';
    } else {
      user_greeting = member_name + '&rsquo;s Account';
    }

    
      jQuery('#account-button span.dd').prepend('<span class="account-name">'+user_greeting+'</span>');
    jQuery('#account-button').mousedown(function(event){
        if(event.which === 1){
            window.location = 'https://www.ticketmaster.ca/member?tm_link=tm_' + is_home + 'header_name';
        }
    });

} else {
      jQuery('#account-button span.dd').prepend('<span class="account-name">My Account</span>');
    jQuery('#account-button').mousedown(function(event){
        if(event.which === 1){
            window.location = 'https://www.ticketmaster.ca/member?tm_link=tm_' + is_home + 'header_my_account';
        }
    });

}
jQuery(document).ready(function($){
    //Checking status to determine button location
    if (check1 == null || check1.length == 0){
        $('#account-list-options').before('<div class="padded-action bg-gradient"><a href="https://www.ticketmaster.ca/member?tm_link=tm_header_signin" class="button">Sign In</a></div>');
    } else if (check1){
        $('#account-list-options').after('<div class="padded-action bg-gradient"><a href="https://www.ticketmaster.ca/member/logout/?tm_link=tm_header_signout" class="button-secondary">Sign Out</a></div>');
    }
});
 Français
Help 


//<![CDATA[
{
    var count = GetCookie("MYCART_COUNT") || 0;
    if ( count >= 0 ) {                $('cart-button').innerHTML = [ 
                    '<span class="ada-hide">', count, ' items in your cart</span>', 
                ].join('');
                if ( count > 0 ) { $('cart-button').addClassName('carted'); }
                else { $('cart-button').removeClassName('carted'); }    }
    else {        $$('.cart-basket-total')[0].innerHTML = '';
    }
    if ($('shopCart')){
        $('shopCart').show();
    }
}
//]]>


Learn more


 
 

 
<!--
function return_to_third_party( user_action, third_party_index ) {
    var return_form = document.getElementById( 'third_party_return_form_' + third_party_index );
    
    var elAction = document.getElementById( 'third_party_user_action_' + third_party_index );
    elAction.setAttribute( 'value', user_action );
    
    return_form.submit();
};
// -->


    function checkSWFVersion() {
        var version = "9.0.115".split('.');
        if( arguments[0] < version[0] ) {
            return false;
        }
        if( arguments[0] > version[0] ) {
            return true;
        }
        if( arguments[1] < version[1] ) {
            return false;
        }
        if( arguments[1] > version[1] ) {
            return true;
        }
        if( arguments[2] < version[2] ) {
            return false;
        }
        return true;
    }

<!--
var tmfb = new TMFB( {
    enable: true,
    app_id: '114137798640867',
    backend: undefined,
    api_version: 'v2.2' || 'v2.2',
    xfbml_container_ids: ["artistContainer","rsvp-fb-like-module"],
    lang_code: 'en_US',
	prop_tu: 'On [_date] at [_venue] in [_location]'
} );
//-->





We're sorry, we're unable to process your request. Please try again.
  



        #modal {
            background-color:#000000;
            filter:alpha(opacity=50);
            -moz-opacity: 0.5;
            opacity: 0.5;
            overflow:hidden;
            position:absolute;
            z-index:1001;
            top: 0px;
            left: 0px;
        }
    


Unfortunately, we did not detect the Flash plug-in on your browser. Installing Flash will let you play content on the site. To download the latest version, click here.
        




 





Updating Results...


 




To edit your Favourites or customize your e-mail preferences, go to My Ticketmaster.
By signing up, you may receive e-mails directly from the artist's representatives as well as from Ticketmaster.
Privacy Policy.


Customize your e-mail preferences and more on My Ticketmaster.





Close 
Placeholder






This list is subject to change. Also, it does not necessarily reflect performance order at the event.








 



Soccer
FIFA Women’s World Cup Canada 2015 Tickets  

  

Beginning of Favourite Added simulated dialogue content.


 
Favourite Added



You're in the loop for FIFA Women’s World Cup Canada 2015! We'll email you before tickets go on sale in your area.
Have more than just one favourite artist? Let My Ticketmaster keep track of all of them for you.                

Close Window



End of Favourite Added simulated dialogue content.
Close 




Beginning of Favourite Removed simulated dialogue content.


 
Favourite Removed

 

Has your taste changed? Use My Ticketmaster to find some new favourites!

Close Window

 

End of Favourite Removed simulated dialogue content.
Close 







Press Down Arrow for More Information.
Add to Favourites





Get email alerts and never miss an onsale for FIFA Women’s World Cup Canada 2015!                

Error: please enter your e-mail address. 
                    
Error: that is not a valid e-mail address format.  Please try again. 
                    
Error: please enter your postal code. 
                    
Error: this postal code entered is invalid. Please try again. 
                    
Error: you are currently registered for a different area. To change your area, please visit My Account and update your Profile.                    




E-mail: 
Your Postal Code:  



Your personal info is protected by our Privacy Policy.                

Close Window




Close
End of Add to Favourites simulated dialogue content.



 

<!--
var tmtw = new TMTW( {
    load_timeout: 5,
    type: 'artist',
    lang_code: 'en',
    follow: 'TicketmasterCA,',
	followData:[{"order":1,"type":"domain","screen_name":"TicketmasterCA"},{"order":2,"type":"artist","screen_name":""}],
	keywords: 0,
    backend: 'http://www.ticketmaster.ca',
    eid: '',
    aid: '875503',
    vid: '',
    pid: '1',
    src: 'TicketmasterCanada'
} );

tmtw.build_tweet("http://www.ticketmaster.ca/FIFA-Womens-World-Cup-Canada-2015-tickets/artist/875503", "FIFA Women’s World Cup Canada 2015 tickets, and team schedule #TicketmasterCA");
//-->



    var RSVPModule;
    tmfb.after_load( function() {
        FB.Event.subscribe('edge.create', function(response) {
            if( response == 'http://www.ticketmaster.ca/FIFA-Womens-World-Cup-Canada-2015-tickets/artist/875503' ) {
                omniTracking.navigation_link( 'Artist_Click_fb_Like', false );
            }
        });
        new PeriodicalExecuter(
            function(pe) {
                if( Ajax.activeRequestCount == 0 ) {
                    pe.stop();
                    RSVPModule = new RSVPModule({'style':'artist','backend':'/json/rsvp','subject':875503,'page_type':1});
                }
            }, 0.25
        );
    });
    tmfb.after_load_failed( function() {
        FB.Event.subscribe('edge.create', function(response) {
            if( response == 'http://www.ticketmaster.ca/FIFA-Womens-World-Cup-Canada-2015-tickets/artist/875503' ) {
                omniTracking.navigation_link( 'Artist_Click_fb_Like', false );
            }
        });
        new PeriodicalExecuter(
            function(pe) {
                if( Ajax.activeRequestCount == 0 ) {
                    pe.stop();
                    if( typeof( RSVPModule ) === 'object' ) {
                        RSVPModule.errors.facebook = true;
                        RSVPModule.show_fb_error();
                    }
                    else {
                        RSVPModule = new RSVPModule({'fb_err':true,'style':'artist','backend':'/json/rsvp','subject':875503,'page_type':1});
                    }
                }
            }, 0.25
        );
    });



 

FIFA Women’s World Cup Canada 2015 Tickets and Event Dates
 
 
 

Show events near me: 
Search for events by City or Postal code


 


 






 Loading...
 



View: 
 




Canada 




Date
Location
Event Details
Find Tickets








There are no matching events in Canada.




 
Canada                





Date
Location
Event Details
Find Tickets






Dates Scheduled in Other Countries                




Date
Location
Event Details
Find Tickets










We currently do not have any tickets on-sale for FIFA Women’s World Cup Canada 2015. Click "Add to Favourites" to be emailed before tickets go on sale.



 
















    <!--
      function bvLoadRR() {
        if (typeof $BV !== "undefined") {
          $BV.ui("rr", "show_reviews", {
            productId: "875503",
            onEvent: function (json) {
              if (json.eventSource == "Display") {
                var totalReviewsCount = json.attributes.numReviews;
                var avgRating = json.attributes.avgRating;
                var ratingsOnlyReviewCount = json.attributes.numRatingsOnlyReviews;
                var recommendPercentage = json.attributes.percentRecommend;
                var productID = json.productId;
                ratingsDisplayed(totalReviewsCount, avgRating, ratingsOnlyReviewCount, recommendPercentage, productID);
              }
            }
          });
        }
        new PeriodicalExecuter(
          function(pe) {
              if( $$('.BVRRRatingSummaryHeader').length > 0 || $$('.BVRRRatingSummaryNoReviews').length > 0 ) {
                  pe.stop();
              }
          },
          0.25
        );
      }
      bvLoadRR();
    //-->
    


              googletag.cmd.push(function() {                    googletag.display('div-gpt-ad-slot-502');            });                 googletag.cmd.push(function() {                    googletag.display('div-gpt-ad-slot-595');            });    

Beginning of Facebook RSVP Event List lightbox dialog window content



Select Event





Which FIFA Women’s World Cup Canada 2015 event are you going to?







End of Facebook RSVP Event List lightbox dialog window content


Beginning of Facebook More Attending Friends lightbox dialog window content



More Friends Attending






Friend Images
Friend Status









End of Facebook More Attending Friends lightbox dialog window content


Beginning of Facebook More Attending People lightbox dialog window content



More People Attending







Friend Images
Friend Status









End of Facebook More Attending People lightbox dialog window content


Friends on Ticketmaster Canada 






Attending
Maybe





 
Everyone
Friends
 
Sorry, we're having trouble connecting to Facebook at the moment. Please check back in a couple of minutes, we should have this resolved shortly.
Find out who loves live entertainment as much as you! Ask your Facebook friends to connect to Ticketmaster Canada.



Friend Images
Friend Status







Sorry, we're having trouble connecting to Facebook at the moment. Please check back in a couple of minutes, we should have this resolved shortly.
Find out who loves live entertainment as much as you! Ask your Facebook friends to connect to Ticketmaster Canada.



Friend Images
Friend Status










             googletag.cmd.push(function() {                    googletag.display('div-gpt-ad-slot-596');            });    
             googletag.cmd.push(function() {                    googletag.display('div-gpt-ad-slot-522');            });    

var LDPopup = {
  open: function(options)
  {
    this.options = {
      url: '#',
      width: 600,
      height: 500,
      name:"_blank",
      location:"yes",
      menubar:"yes",
      toolbar:"yes",
      status:"yes",
      scrollbars:"yes",
      resizable:"yes",
      left:"",
      top:"",
      normal:false
    }
    Object.extend(this.options, options || {});

    if (this.options.normal){
        this.options.menubar = "yes";
        this.options.status = "yes";
        this.options.toolbar = "yes";
        this.options.location = "yes";
    }

    this.options.width = this.options.width < screen.availWidth?this.options.width:screen.availWidth;
    this.options.height=this.options.height < screen.availHeight?this.options.height:screen.availHeight;
    var openoptions = 'width='+this.options.width+',height='+this.options.height+',location='+this.options.location+',menubar='+this.options.menubar+',toolbar='+this.options.toolbar+',scrollbars='+this.options.scrollbars+',resizable='+this.options.resizable+',status='+this.options.status
if (this.options.top!="")openoptions+=",top="+this.options.top;
    else openoptions+=",top="+parseInt((parseInt(screen.height)/2) - (parseInt(this.options.height)/2));
if (this.options.left!="")openoptions+=",left="+this.options.left;
    else openoptions+=",left="+parseInt((parseInt(screen.width)/2) - (parseInt(this.options.width)/2));
        window.open(this.options.url, this.options.name,openoptions );
        return false;
  }
}


    var search_data = new Hash();
    if (!window.member_data || !window.member_data.get("member")) {
        var member_data = new Hash();
    }
    var addtoFavtrack = new Hash();
    var wt_temp = "";
    var video_click = false;
    var module_dependencies = 0;
    var modules_avail_per_page = new Array();
    var global = new Hash();
        global.set('page_max', 10);
        global.set('calendar_view', false);
        global.set('aid', 875503);
        global.set('set', 1);

    function fireSearch( args ) {
        TM.MetricsCollection.timings.facade('startTimer', { 
                'name': 'searchResultsLoad_total',
               'mtype': 'web.page.cs_function_execution.timer.millis'
        });
        var searchRequests = [];
        getSearch('/json/search/event/national?aid=875503', search_data, 'national', args);
        getSearch('/json/search/event/domain?aid=875503', search_data, 'domain', args);
        searchRequests.push('national', 'domain');

        jQuery(document.body).unbind("searchresultsload").bind("searchresultsload", function(event, t) {
            searchRequests = jQuery.grep(searchRequests, function(value) {
                return value != t.searchType;
            });
            if(!searchRequests.length) {
                TM.MetricsCollection.timings.facade('endTimer', { 
                       'name': 'searchResultsLoad_total',
                   'function': (search_data.get('response_errors') && search_data.get('response_errors') == 1)? 'searchResultsLoad_total_err': 'searchResultsLoad_total',
                      'force': true
                });
            }
        });
    }

    function fireUpdate( args ) {
        getSearch('/json/search/event/national', search_data, 'national_extra', args);
        getSearch('/json/search/event/domain', search_data, 'domain_extra', args);
    }

    function getData( args ) {
        search_data.set('response_errors', 0);
        fireUpdate( args );
        var start_time = new Date().getTime();
        var requestCheck = new PeriodicalExecuter(
            function(pe) {
                var end_time = new Date().getTime();
                if( ( (end_time - start_time) / 1000 ) >= 30 || ( search_data.get('response_errors') && search_data.get('response_errors') == 1 ) ) {
                    pe.stop();
                    var tmp = $('page_error').innerHTML;
                    $('mainContent').innerHTML = tmp;
                    $w('pageName prop1').each( function(cs){
                        tm_omn[cs] = tm_omn[cs].gsub(/On Sale/,'Error Page');
                    });
                    return;
                }
                if( Ajax.activeRequestCount == 0 ) {
                    pe.stop();

                    search_data.get('national').docs = search_data.get('national').docs.concat( search_data.get('national_extra').docs );
                    search_data.get('domain').docs = search_data.get('domain').docs.concat( search_data.get('domain_extra').docs );
                    new EventList( global.get('pages') ).drawEvents();
                    new LightBox('modal','loading_lb').hideContent();
                
                    $w('national_extra domain_extra').each( function(d){
                    
                        if( search_data.get( d ) ) {
                            search_data.get( d ).docs.each( function(d,idx) {
                                buildEventList(d);
                            });
                        }
                    });
                }
            }, 0.25
        );
    }

    function initSearch( args ) {
        search_data.set('total', 0);
        search_data.set('total_docs', 0);
        search_data.set('response_errors', 0);
        $('loading').show();
        TM.MetricsCollection.timings.facade('startTimer', {
                    'name': 'searchResultsDisplay',
                   'mtype': 'web.page.cs_function_execution.timer.millis'
        });
        fireSearch( args );
        var start_time = new Date().getTime();
        var jsonLdArr = [];
        var requestCheck = new PeriodicalExecuter(
            function(pe) {
                var temp_prop14;
                var end_time = new Date().getTime();
                if( ( (end_time - start_time) / 1000 ) >= 30 || ( search_data.get('response_errors') && search_data.get('response_errors') == 1 ) ) {
                    pe.stop();
                    var tmp = $('page_error').innerHTML;
                    $('mainContent').innerHTML = tmp;
                    
                    var errMes = ((end_time - start_time) / 1000 ) >= 30 ? "err_timeout": "err_xhr";
                    jQuery(document.body).trigger("searchresultsdisplay", [{"status": errMes}]);
                    
                    $w('pageName prop1').each( function(cs){
                        tm_omn[cs] = tm_omn[cs].gsub(/On Sale/,'Error Page');
                    });
                    tm_omni_temp.set('eventsListing_numberReturned_local', 0);
                    tm_omni_temp.set('eventsListing_numberReturned_national', 0);
                    tm_omn.prop47 = "Artist:0";
                    tm_omn.prop48 = "Artist:0";
                    if ( tm_omni_temp.get('pageLoadCall_done') ) {
                        tm_omn.eVar17 = tm_omn.prop21 = tm_omni_temp.get('omnAID');
                        tm_omn.linkTrackVars = "prop21,prop47,prop48,eVar17";
                        tm_omn.linkTrackEvents = "";
                        /* prop14 workaround to get rid of event27 in search tracking click calls */
                        temp_prop14 = tm_omn.prop14;
                        tm_omn.prop14 = undefined;
                        tm_omn.tl(true, 'o', 'artist_events_list_data');
                        tm_omn.prop14 = temp_prop14;
                    }                    return;
                }
                if( search_data.get('national') && search_data.get('domain') ) {
                    pe.stop();

                    global.set('pages', new SearchPages() );

                    new EventList( global.get('pages') ).drawEvents();
                    noLocal();
                    (function () {
                        var data_local = search_data.get('local');
                        var data_national = search_data.get('national');
                        var data_domain = search_data.get('domain');
                        var localCount = data_local ? data_local.numFound : 0;
                        var nationalCount = (data_national ? data_national.numFound : 0) + (data_domain ? data_domain.numFound : 0);
                        tm_omni_temp.set('eventsListing_numberReturned_local', localCount);
                        tm_omni_temp.set('eventsListing_numberReturned_national', nationalCount);
                        var prefix = "Artist:";
                        tm_omn.prop47 = prefix + localCount;
                        tm_omn.prop48 = prefix + nationalCount;
                        if ( tm_omni_temp.get('pageLoadCall_done') ) {
                            tm_omn.eVar17 = tm_omn.prop21 = tm_omni_temp.get('omnAID');
                            tm_omn.linkTrackVars = "prop21,prop47,prop48,eVar17";
                            tm_omn.linkTrackEvents = "";
                            /* prop14 workaround to get rid of event27 in search tracking click calls */
                            temp_prop14 = tm_omn.prop14;
                            tm_omn.prop14 = undefined;
                            tm_omn.tl(true, 'o', 'artist_events_list_data');
                            tm_omn.prop14 = temp_prop14;
                        }
                    })();
                    $w('national domain').each( function(d){
                        if( search_data.get( d ) ) {
                            search_data.get( d ).docs.each( function(d,idx) {
                                buildEventList(d);
                                jsonLdArr.push( d );
                            });
                        }
                    });
                
                }
            }, 0.25
        );
        
        jQuery(document.body).trigger("SEOpopulateJsonLD", [{"jsonLdArr": jsonLdArr}]); // event is used for SEO, tpl/js/json_ld.js, ECOMSTL-1748
        jQuery(document.body).unbind("searchresultsdisplay").bind("searchresultsdisplay", function(event, d) {
                var st =  (d && d.status)? "_" + d.status : "";
                TM.MetricsCollection.timings.facade('endTimer', {
                                'name': 'searchResultsDisplay',
                            'function': 'searchResultsDisplay' + st,
                               'force': true
                });
        });
    }
        function fv_return() {
        if( addtoFavtrack.get('savedArtist') ) {
             modules_avail_per_page.push('Fy');
        }
        else {
            modules_avail_per_page.push('Fv')
        }
    }    function initWebtrends(){
     // This section creates a new meta tag to store the uri and tm_link
        var peReiterations = 0;
    new PeriodicalExecuter(function(pe) {
        if(++peReiterations == 6 || search_data.get('total') > 0) {
            if( search_data.get('total') == 0) {
              $w('pageName prop1').each( function(cs){
                tm_omn[cs] = tm_omn[cs].gsub(/On Sale[: (List|Calendar)]*/,'Off Sale');

               });
            }
            
            fv_return();
            
            if( extraWT ) {
                wt_extra = extraWT.join(';');
            }
            else {
                wt_extra = '';
            }
               if(search_data.get('total') > 0){
                   modules_avail_per_page.push( 'Y' );
                }
                if(!isReviews.empty()){
                  modules_avail_per_page.push( isReviews );
                }
                wt_temp = modules_avail_per_page.sort();
                omni_modules_present = "Artist_";
                wt_temp.each(function(e){
                  omni_modules_present += e;
                });
                tm_omni_temp.set('prop12',omni_modules_present);
                tm_omn.prop12 = omni_modules_present;
                if(jQuery('[class*="BVRRNumber BVRRRatingNumber"]') && jQuery('[class*="BVRRNumber BVRRRatingNumber"]').length > 0){
                  tm_omn.eVar32 = jQuery('[class*="BVRRNumber BVRRRatingNumber"]')[0].innerHTML;
                }
                tm_omn.events = "event5";
                if (tm_omni_temp.get('eventsListing_numberReturned_local') !== undefined) {
                    tm_omn.prop47 = "Artist:" + tm_omni_temp.get('eventsListing_numberReturned_local');
                    tm_omn.prop48 = "Artist:" + tm_omni_temp.get('eventsListing_numberReturned_national');
                }
                tm_omn.t();
                tm_omni_temp.set('pageLoadCall_done', true);
                pe.stop();
        }

    }, 1);
                            }
    function myFave( myCaller ) {
        if ($('hdr_atf').retrieve('clicked', 0) == 1) {
            return;
        }
        $('hdr_atf').store('clicked', 1);
        
        switch( myCaller.id ) {
            case 'hdr_atf':
                addtoFavtrack.set("wtVar","Favorites Subscribe");
                addtoFavtrack.set("wtVarR","Favorites Unsubscribe");
            break;
            default:
                addtoFavtrack.set("wtVar","Favorites Subscribe");/* NoTix"); */
                addtoFavtrack.set("wtVarR","Favorites Unsubscribe");/* NoTix"); */
        }
        if( has_mid ) {
            addFavorite( '875503' );
        }
        else {
            $('hdr_atf').store('clicked', 0);
            $('alert_error_block').hide();
            new LightBox('modal','add_to_fave').showContent();
            var fave_track = addtoFavtrack.get(($$('.addFav').invoke('hasClassName','addFavMyFav').include(false) ? "wtVar": "wtVarR" ));
            var fave_tracK_var = fave_track.include('Un') ? 'event11' : 'event10';
                addtoFavtrack.set('fave_track',fave_track);
                addtoFavtrack.set('fave_tracK_var',fave_tracK_var);
                //ddcc
            $('add_to_fave_focus').focus();
            $('email_address').focus();
        }
    }
    function addFavorite( theID ) {
        var opt = {
            method: 'post',
            parameters: { id: theID, type: 'team', 'delete': 1, 'page': 'artist', 'vtoken_mid': GetCookie('MID'), 'csrf_token': GetCookie('csrf_token') },
            onSuccess: function(t) {
                var data = t.responseText.evalJSON(true);
                var faveButtons;
                faveButtons = jQuery("button[data-id=artist_" + theID + "]");
                if (!faveButtons.length) {
                    faveButtons = jQuery("button[data-id=team_" + theID + "]");
                }
                if (data.alert_preference.id == theID && data.alert_preference.removed) {
                        $('my_fav_sprite').removeClassName('myfav-button');
                        $('my_fav_sprite').addClassName('addfav-large-button');
                    if (faveButtons.length) {                        faveButtons.removeClass("added");
                        faveButtons.find('span').html("Add this to your Favourites");                    }

                     if($('list_atf')){
                         $('list_atf_fav_sprite').removeClassName('myfav-button');
                         $('list_atf_fav_sprite').addClassName('addfav-large-button');
                         $('list_atf').setStyle({visibility:'visible'});
                     }
                     if($('ld_bdy_fav')) { $('ld_bdy_fav').show();}
                    new LightBox('modal','fave_removed').showContent();
                    var fave_track = addtoFavtrack.get('wtVarR');
                    omniTracking.trackomni_favoriteshare(['events','eVar17'],['event11','875503'],fave_track);
                    $('fave_removed_focus').focus();                        jQuery('#my_fav_sprite').prop('alt', 'Add to Favourites');                }
                else if( data.alert_preference.id == theID ) {
                    $$('.addFav').invoke('toggleClassName','addFavMyFav');                        $('my_fav_sprite').removeClassName('addfav-large-button');
                        $('my_fav_sprite').addClassName('myfav-button');
                    if (faveButtons.length) {                        faveButtons.addClass("added");
                        faveButtons.find('span').html("Remove this from your Favorites");                    }

                    if ($('list_atf')) {
                        $('list_atf_fav_sprite').removeClassName('addfav-large-button');
                        $('list_atf_fav_sprite').addClassName('myfav-button');
                    }
                    
                    if ($('ld_bdy_fav')) { 
                      $('ld_bdy_fav').hide(); 
                    }
                    
                    new LightBox('modal','fave_added').showContent();
                    var fave_track = addtoFavtrack.get('wtVar');
                    omniTracking.trackomni_favoriteshare(['events','eVar17'],['event10','875503'],fave_track);
                    $('fave_added_focus').focus();                        jQuery('#my_fav_sprite').prop('alt', 'My Favourite');                }
                else if( data.type == 'no_data' ) {
                    alert("There was a problem processing your request");
                }
            },
            onFailure: function() {
                alert("There was a problem processing your request");
            },
            onComplete: function(resp) {
                $('hdr_atf').store('clicked', 0);
            }
        }
        new Ajax.Request('http://www.ticketmaster.ca/json/alert_preferences', opt);
    }

    function initFav() {
        has_mid = false;
        getMember('http://www.ticketmaster.ca/json/member', member_data, 'member');
        var requestCheck = new PeriodicalExecuter(
            function(pe) {
                if( member_data.get('member') ) {
                    pe.stop();
                    has_mid = true;
                    var member_alerts = new Array();
                    var content;
                        member_alerts = member_data.get('member').artists.concat(member_data.get('member').teams);
                    if( member_alerts.pluck('id').include('875503') ) {
                          addtoFavtrack.set("savedArtist", 1);
                        $$('.addFav').invoke('toggleClassName','addFavMyFav');                            $('my_fav_sprite').removeClassName('addfav-large-button');
                            $('my_fav_sprite').addClassName('myfav-button');
                            jQuery('#my_fav_sprite').prop('alt', 'My Favourite');                         if($('list_atf')){
                             $('list_atf_fav_sprite').removeClassName('addfav-large-button');
                             $('list_atf_fav_sprite').addClassName('myfav-button');
                         }
                         $('hdr_atf').setStyle({visibility:'visible'});
                         if($('ld_bdy_fav')) {$('ld_bdy_fav').hide(); }
                         content = $('mid_alert_txt').innerHTML;
                    }
                    else {
                        $('hdr_atf').setStyle({visibility:'visible'});
                        if($('list_atf')){$('list_atf').setStyle({visibility:'visible'});}
                        if($('ld_bdy_fav')) {$('ld_bdy_fav').show(); }
                    }
                }
            }, 0.25
        );
        if( has_mid == false ) {
            var content;
            if($('ld_bdy_fav')) {$('ld_bdy_fav').show(); }
            $('hdr_atf').setStyle({visibility:'visible'});
            if( $('myFavSpan') ) { $('myFavSpan').style.visibility = 'visible'; }
            if( $('list_atf') ) { $('list_atf').style.visibility = 'visible'; }
            content = $('no_mid_alert_txt').innerHTML;
        }
    }
    document.observe("dom:loaded",initFav);

    function reqAlert( theForm ){
        $('alert_error_block').hide();
        var args = $('artist_alert').serialize(true);
            args['w_artist.C4UxlR3iA9o2cTAq7FuvPmoZxEib6yFe77Ach9vu5_9LL77TEKa2orJZ'] = 'on';
        var opt = {
            method: 'post',
            parameters: args,
            onSuccess: function(t) {
                var data = t.responseText;
                if( data.match(/add_alert_success/i) ) {
                    $('alert_error_block').hide();
                    omniTracking.trackomni_favoriteshare(['events','eVar17'],[addtoFavtrack.get('fave_tracK_var'),'875503'],addtoFavtrack.get('fave_track'));
                    if( $$('.addFav').invoke('hasClassName','addFavMyFav').include(false) ) {
                        $$('.addFav').invoke('toggleClassName','addFavMyFav');                            $('my_fav_sprite').removeClassName('addfav-large-button');
                            $('my_fav_sprite').addClassName('myfav-button');                        if($('ld_bdy_fav')) {$('ld_bdy_fav').hide(); }
                         //$('list_atf').update("<img src='http://s1.ticketm.net/tm/en-ca/img/sys/1000/attraction/myFav.gif'  style='padding-top:7px'>");
                    }
                    new LightBox('modal','add_to_fave').hideContent();
                    new LightBox('modal','fave_added').showContent();
                    $('fave_added_focus').focus();                        jQuery('#my_fav_sprite').prop('alt', 'My Favourite');                }
                else if( data.match(/add_alert_error/i) ) {
                    $('add_alerts_errors_email_address_missing',
                    'add_alerts_errors_email_address_invalid',
                    'add_alerts_errors_postal_code_missing',
                    'add_alerts_errors_postal_code_invalid',
                    'add_alerts_errors_changed_area').invoke('hide');

                    if( data.match(/add_alerts_errors_email_address_missing/i) ) {
                        $('add_alerts_errors_email_address_missing').show();
                    } else if( data.match(/add_alerts_errors_email_address_invalid/i) ) {
                        $('add_alerts_errors_email_address_invalid').show();
                    }
                    if( data.match(/add_alerts_errors_postal_code_missing/i) ) {
                        $('add_alerts_errors_postal_code_missing').show();
                    } else if( data.match(/add_alerts_errors_postal_code_invalid/i) ) {
                        $('add_alerts_errors_postal_code_invalid').show();
                    }
                    if( data.match(/add_alerts_errors_changed_area/i) ) {
                        $('add_alerts_errors_changed_area').show();
                    }
                    $('alert_error_block').show();
                }
            },
            onFailure: function() {
                alert("There was a problem processing your request");
            }
        };
        new Ajax.Request('http://www.ticketmaster.ca/event/add_alert', opt);
    }    var minor_sup = {"643":1,"685":1,"660":1,"620":1,"723":1,"737":1,"598":1,"244":1,"637":1,"500":1,"599":1,"647":1,"609":1,"667":1,"740":1,"601":1,"243":1,"109":1,"103":1,"722":1,"611":1,"671":1,"612":1,"665":1,"670":1,"672":1,"610":1,"742":1,"663":1,"615":1,"210":1,"684":1,"668":1,"649":1,"606":1,"657":1,"666":1,"648":1,"642":1,"658":1,"656":1,"673":1,"659":1,"638":1,"645":1,"641":1,"654":1,"616":1,"640":1,"650":1,"661":1,"662":1,"760":1,"589":1,"618":1,"614":1,"664":1,"613":1,"646":1,"239":1,"669":1,"607":1,"703":1,"617":1,"639":1,"653":1,"651":1,"652":1,"619":1,"608":1};
    var rsvp_events = [];
    var rsvp_artist = { 'artist_name' : "FIFA Women’s World Cup Canada 2015", 'artist_url' : 'http://www.ticketmaster.ca/FIFA-Womens-World-Cup-Canada-2015-tickets/artist/875503' };
    function buildEventList( d ) {
        if( !d.TBA && !minor_sup[d.MinorGenreId[0]] && !d.Canceled ) {
            var temp_event = {};
            temp_event.artist_url = 'http://www.ticketmaster.ca' + d.AttractionSEOLink[0];
            temp_event.artist_name = d.AttractionName[0];
            temp_event.id = d.EventId;
            var event_url;      
            if( d.PostProcessedData.system_url ) {
                var event_name = new Element('span').update(d.EventName);
                event_url = 'http://www.ticketmaster.ca/partner_redirect?v=' + encodeURIComponent( d.PostProcessedData.system_url );
                event_url += "&eventid=" + d.EventId + "&artistid=" + d.AttractionId[0] + "&artistname=" + encodeURIComponent( event_name.innerHTML );
                event_url += "&crosssite=TM_CA:" + d.AttractionId[0] + ":" + d.VenueId;
                temp_event.redirect = true;
            }
            else {
                event_url = 'http://www.ticketmaster.ca/' + d.EventSEOName + '/event/' + d.EventId;
                temp_event.redirect = false;
            }
            temp_event.url = event_url;
            temp_event.image = 'http://s1.ticketm.net'  + d.AttractionImage[0];
            temp_event.major = d.MajorGenreId[0];
            temp_event.name = d.EventName;
            temp_event.venue = {name:d.VenueName,id:d.VenueId};
            if( d.VenueCity ) {
                temp_event.venue.city = d.VenueCity;
            }
            if( d.VenueState ) {
                temp_event.venue.state = d.VenueState;
            }
            if( d.VenueCityState ) {
                temp_event.venue.citystate = d.VenueCityState;
            }
            if( d.PostProcessedData.Onsales.event_date.date_range && ( d.EventRangeStart != d.EventRangeEnd ) ) {
                var re = /(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})Z/;
                var s_match = re.exec(d.EventRangeStart);
                var s = new Date();
                    s.setUTCFullYear( s_match[1] );
                    s.setUTCMonth( parseFloat(s_match[2])-1 );
                    s.setUTCDate( s_match[3] );
                    s.setUTCHours( s_match[4] );
                    s.setUTCMinutes( s_match[5] );
                    s.setUTCSeconds( s_match[6] );
                temp_event.date = {month:s.getAbbrMonthName(),day:s.getUTCDate(),year:s.getUTCFullYear(),day_name:s.getDayName()};
                var re_e = /(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})Z/;
                var e_match = re_e.exec(d.EventRangeEnd);
                var e = new Date();
                    e.setUTCFullYear( e_match[1] );
                    e.setUTCMonth( parseFloat(e_match[2])-1 );
                    e.setUTCDate( e_match[3] );
                    e.setUTCHours( e_match[4] );
                    e.setUTCMinutes( e_match[5] );
                    e.setUTCSeconds( e_match[6] );
                    temp_event.date_end = {month:e.getAbbrMonthName(),day:e.getUTCDate(),year:e.getUTCFullYear(),day_name:e.getDayName()};
            }
            else {
                temp_event.date = {month:d.LocalEventShortMonth,day:d.LocalEventDay,year:d.LocalEventYear,day_name:d.LocalEventWeekdayString};
            }
            temp_event.time = d.LocalEventDateDisplay.split('<br>')[1];
            temp_event.date_comp = temp_event.date.month + temp_event.date.day + temp_event.date.year;
            temp_event.sort_date = d.PostProcessedData.Onsales.event_date.date_range && ( d.EventRangeStart != d.EventRangeEnd ) ? d.EventRangeStart : d.EventDate;
            rsvp_events.push( temp_event );
        }
    }

    var multiActDetailLightBox = null;
    document.observe("dom:loaded",function() {
        initSearch();
        initWebtrends();
        multiActDetailLightBox = new MultiActLightBox();
    });
    Event.observe(window,'unload',function(){
        search_data = null;
    });
    Event.observe(window,'scroll',function(){
        if( $('modal').visible() && $('loading_lb').visible() ) {
            new LightBox('modal','loading_lb').showContent();
        }
    });

    //Using Event.observe to bind onclick and onkeypress event instead of inline code, added $('hdr_atf').blur() to fix bug 68670.
    if( $('hdr_atf') ){
        Event.observe($('hdr_atf'), 'click', function(event) {
            Event.stop(event);
            $('hdr_atf').blur();
            myFave(this);
        });
    }


RSVPModule = Class.create({
    initialize: function( config ) {
        this.display_style = config['style'];
        this.backend = config['backend'];
        this.invite_only = config['invite_only'];
        this.to_get = {'val': config['subject']};
        this.page_type = config['page_type'];
        this.rsvps = {};
        this.temp = {};
        this.errors = {};
        this.rsvps['me'] = [];
        this.rsvps['friends'] = [];
        this.rsvps['everyone'] = [];
        this.my_friends = [];
        this._after_wall_list = [];
        this._before_wall_list = [];
        this._before_done = false;
        this._omn_done = false;
        this._perm_attempt = false;
        this.rsvp_status = 0;
        this.generic_images = {"10001":"TM_GenCatImgs_Music_BW.jpg","10003":"TM_GenCatImgs_Family_BW.jpg","10004":"TM_GenCatImgs_Sports_BW.jpg","10012":"TM_GenCatImgs_Generic_BW.jpg","10005":"TM_GenCatImgs_Generic_BW.jpg","10002":"TM_GenCatImgs_ArtsTheatre_BW.jpg"};
        this.ajax_defaults = {
            timeout: 10 * 1000
        };

        jQuery.ajaxSetup({
            url: this.backend,
            timeout: 10 * 1000
        });

        switch( this.display_style ) {
            case "artist":
                this.to_get['param'] = 'aid';
                this.omn_pre = 'Artist';
                this.omn_post = 'Artist';
                this.omn_module = 'ArtistPageModule';
                break;
            case "confirmation":
                this.to_get['param'] = 'eid';
                this.omn_pre = 'Purch';
                this.omn_post = 'Confirmation';
                this.omn_module = 'PurchasePageModule';
                break;
            case "event":
                this.to_get['param'] = 'eid';
                this.omn_pre = 'Event';
                this.omn_post = 'Event';
                this.omn_module = 'EventPageModule';
                break;
            case "section":
                this.to_get['param'] = 'cat';
                this.omn_pre = 'HomeSection';
                this.omn_post = '';
                this.omn_module = 'PageModule';
                break;
        }

        if( config['fb_err'] ) {
            this.errors['facebook'] = true;
            this.show_fb_error();
        }

        if( !this.invite_only && !this.errors.facebook ) {
            if( tmfb.is_connected() ) {
                tmfb.start_get_friends( this.get_friends.bind(this) );
            }
            else {
                this.get_rsvps();
            }
        }

        this._omnitrack();
        this.start = new Date().getTime();
        this.first = true;
    },

    get_rsvps: function() {
        var to_get = {};
            to_get[this.to_get.param] = this.to_get.val;
            to_get['session'] = tmfb.session() ? tmfb.session() : 'null';
        tmfb.call_backend_with_retry({
            uri: this.backend,
            args: to_get,
            callback: jQuery.proxy( function (data, textStatus, jqXHR) {
                if ( data.error || textStatus !== "success" ) {
                    return;
                }
                this.errors.facebook = false;
                this.users = data.users;                
                this.total_rsvps = data.rsvp_total;
                if( data.friends ) {
                    var fb_uid = tmfb.uid();
                    data.rsvps = data.rsvps.reject( function(d){ return d.fb_uid == fb_uid } );
                    data.rsvps = data.rsvps.concat( data.friends );
                }
                this._partition_rsvps( data.rsvps );
            }, this),
            settings: jQuery.extend({ dataType:"json",error:this._handle_timeout.bind(this)}, this.ajax_defaults)
        });
    },

    get_friends: function( friends ) {
        this.errors.facebook = false;
        for( i = 0 ; i < friends.length ; i++ ) {
            this.my_friends.push( friends[i].facebook.id );
        }
        this.get_rsvps();
    },

    show_fb_error: function( all ) {
        jQuery('#attending-module').hide();
        jQuery('#no-rsvps').hide();
        jQuery('#no-friend-rsvps').hide();
        if( tmfb.uid() && !all ) {
            $('e_tab').removeClassName('selected');
            $('f_tab').addClassName('selected');
            jQuery('#no-friend-facebook').show();
            jQuery('#everyone_table').hide();
            jQuery('#everyone_content').hide();
            jQuery('#friends_content').show();
        }
        else {
            $('f_tab').removeClassName('selected');
            $('e_tab').addClassName('selected');
            jQuery('#no-facebook').show();
            jQuery('#everyone_table').show();
            jQuery('#everyone_content').show();
        }
        jQuery('#rsvp_module').show();
    },

    show_everyone: function() {
        $('f_tab').removeClassName('selected');
        $('e_tab').addClassName('selected');
        jQuery('#friends_content').hide();
        if( this.errors.facebook ) {
            if( this.rsvps.everyone.length < 1 ) {
                jQuery('#no-facebook').show();
            }
            jQuery('#everyone_table').show();
            jQuery('#everyone_content').show();
            tmfb.start_get_user( tmfb.uid(), function(user){
                if( user ) {
                    if( tmfb.is_connected() ) {
                        tmfb.start_get_friends( this.get_friends.bind(this) );
                    }
                    else {
                        this.get_rsvps();
                    }
                }
            }.bind(this));
        }
        else if( this.rsvps.everyone.length > 0 ) {        
            jQuery('#no-facebook').hide();
            jQuery('#no-rsvps').hide();
            jQuery('#no-facebook').hide();
            jQuery('#everyone_table').show();
            jQuery('#everyone_content').show();
        }
        else {
            jQuery('#no-facebook').hide();
            jQuery('#everyone_table').hide();
            jQuery('#everyone_content').show();
            jQuery('#no-facebook').hide();
            jQuery('#no-rsvps').show();
        }
        return false;
    },

    show_friends: function() {
        if( !tmfb.is_connected() ) {
            if( this.errors.facebook ) {
                this.show_fb_error();
            }
            var is_logged = tmfb.is_logged_in();
            tmfb.login(this._update_display_after_login.bind(this, is_logged),'user_likes,user_friends');
            if( typeof(event) !== 'undefined' && typeof( event.stopImmediatePropagation ) === 'function' ) {
                event.stopImmediatePropagation();
            }
        }
        else {
            $('e_tab').removeClassName('selected');
            $('f_tab').addClassName('selected');
            if( this.rsvps.friends.length > 0 ) {
                jQuery('#no-friend-facebook').hide();
                jQuery('#no-friend-rsvps').hide();
            }
            else {
                jQuery('#no-friend-facebook').hide();
                jQuery('#no-friend-rsvps').show();
            }
            jQuery('#everyone_content').hide();
            jQuery('#friends_content').show();
        }
    },

    add_rsvp: function( s, id ) {
        s = s || this.rsvp_status;
        id = id || this.rsvp_eid;
        if( (!tmfb.perms.rsvp_event || !tmfb.is_connected()) ) {
            if( this._perm_attempt ) {
                this._perm_attempt = false;
                return;
            }
            this.rsvp_status = s;
            this.rsvp_eid = id;
            var is_logged = tmfb.is_logged_in();
            tmfb.login(function(success) {
                if( success ) {
                    this._perm_attempt = true;
                    this._update_display_after_login(is_logged, success);
                    this.add_rsvp();
                }
            }.bind(this), 'rsvp_event,user_likes,user_friends');
            if( typeof(event) !== 'undefined' && typeof( event.stopImmediatePropagation ) === 'function' ) {
                event.stopImmediatePropagation();
            }
        }
        else if( s && rsvp_events.length > 1 && !id ) {
            this._build_rsvp_event_list();
            lbRSVP = new Popup( 'rsvp_event_select_lightbox', {
                lightbox: { opacity: 0.6 },
                close_id:  ['close_lightbox','close_lb_button'],
                zIndex: 1002
            });
            lbRSVP.show({
                anchor_id: document.body,
                popup_align: {
                  x: "center",
                  y: "center"
                }
            });
            jQuery('#rsvp_event_select').focus();
            this.rsvp_status = s;
        }
        else if( (s && id) || (s && !id && rsvp_events.length == 1) ) {
            this.rsvp_status = s;
            this.rsvp_eid = id || rsvp_events[0].id;
            var sess = tmfb.session() ? tmfb.session() : 'null';
            jQuery.post(
                this.backend + '/save',
                { eid : this.rsvp_eid, fb_uid : tmfb.uid(), rsvp_status : this.rsvp_status, page_type : this.page_type, session : sess },
                function( data, textStatus, jqXHR ) {
                    if( data.error && data.error.session ) {
                        this._handle_session_error( data.error.session );
                    }
                    if( data.saved ) {
                        this._set_rsvp( data.rsvp );
                    }
                    else {
                        this._no_save();
                    }
                }.bind(this),
                'json'
            );
        }
    },

    more_attending: function( friends ) {
        var to_pop = friends ? 'rsvp_more_attending_friends_lightbox' : 'rsvp_more_attending_people_lightbox';
        var to_close = friends ? ['close_lightbox_more_friends','close_lb_more_friends_button'] : ['close_lightbox_more_people','close_lb_more_people_button'];
        lbMore = new Popup( to_pop, {
            lightbox: { opacity: 0.6 },
            close_id:  to_close,
            zIndex: 1002
        });
        lbMore.show({
            anchor_id: document.body,
            popup_align: {
              x: "center",
              y: "center"
            }
        });
        jQuery('#friends_all_list').scrollTop(0);
        jQuery('#everyone_all_list').scrollTop(0);
    },

    invite: function( event_id, is_logged ) {
        if( !tmfb.is_connected() ) {
            var is_logged = tmfb.is_logged_in();
            tmfb.login(function(success) {
               if( success ){ 
                    this.invite( event_id, is_logged ); 
                    tmfb.start_get_friends( this.get_friends.bind(this) ); 
                    this.get_rsvps();
                }
            }.bind(this), 'user_likes,user_friends');
        }
        else {
            if( event_id ) {
                var event = jQuery.grep( rsvp_events, function(n){ return n.id == event_id; } )[0];                
                var omn_link = event.url.match(/\?/) ? '&' : '?' + 'SREF=' + calcCampaign({SREF:'FBKInvite' + this.omn_post}) + "_" + event_id;
                var event_url = event.url + omn_link;
                var event_name = "Are you going to see <EVENT> at <VENUE> on <REGIONAL_DATE>".replace('<EVENT>', event.name).replace('<VENUE>', event.venue.name);
                var date_disp;
                if( event.date ) {
                    date_disp = "<MONTH ABRV> <DATE>".replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day);
                } else {
                    date_disp = event.display_date;
                }
                event_name = event_name.replace('<REGIONAL_DATE>', date_disp);
                var return_url;
    
                if( this.display_style == 'confirmation' ) {
                    return_url = self.location.href;
                }
                if( this.display_style == 'artist' ) {
                    return_url = event.artist_url;
                }
    
                tmfb.send_invite_dialog({
                    msg_text: event_name,
                    msg_link: event_url,
                    return_url: return_url,
                    invite_type: "Event",
                    action_text: event.name,
                    picture:"http://s1.ticketm.net/tm/en-ca/dbimages/168207a.jpg"
                });
            }
            else {
                var data = rsvp_artist;
                var omn_link = data.artist_url.match(/\?/) ? '&' : '?' + 'SREF=' + calcCampaign({SREF:'FBKInvite' + this.omn_post});
                var artist_url = data.artist_url + omn_link;
                var artist_name = "Come check out <ARTIST> on Ticketmaster Canada!".replace('<ARTIST>', data.artist_name);
                var return_url;
    
                if( this.display_style == 'confirmation' ) {
                    return_url = self.location.href;
                }
                if( this.display_style == 'artist' ) {
                    return_url = data.artist_url;
                }
    
                tmfb.send_invite_dialog({
                    msg_text: artist_name,
                    msg_link: artist_url,
                    return_url: return_url,
                    invite_type: "Ticketmaster Canada",
                    action_text: "Ask your friends to connect to Ticketmaster Canada",
                    picture:"http://s1.ticketm.net/tm/en-ca/dbimages/168207a.jpg"
                });
            }

            if( event_id ) {
                omniTracking.navigation_link( this.omn_pre + '_Click_fb_RSVP_invite', false );
            }
            this._omnitrack();
            if( is_logged && tmfb.is_connected() ) {
                this._connectrack();
            }
        }
    },

    has_rsvp: function() {
        if( this.rsvps.me.length > 0 ) {
            return true;
        }
        return false;
    },

    _set_rsvp: function( rsvp ) {
        if( typeof(lbRSVP) != 'undefined' ) {
            lbRSVP.hide();
        }
        var new_data = this.rsvps.everyone.concat( this.rsvps.friends, this.rsvps.me );
            new_data = new_data.reject( function(d){ return (d.event_id == rsvp.event_id && d.fb_uid == rsvp.fb_uid) } );
        if( rsvp.status_type_id != 3 ) {
            this.rsvp_eid = rsvp.event_id;
            if( rsvp.status_type_id == 1 ) {
                if( !this._omn_done ) {
                    omniTracking.navigation_link( this.omn_pre + '_Click_fb_RSVP_attend', false );
                }
                this._rsvp_wall_post( rsvp.event_id, 1 );
            }
            if(rsvp.status_type_id == 2 ) {
                if( !this._omn_done ) {
                    omniTracking.navigation_link( this.omn_pre + '_Click_fb_RSVP_maybe', false );
                }
                this._rsvp_wall_post( rsvp.event_id, 2 );
            }
            new_data.push( rsvp );
        }
        else {
            omniTracking.navigation_link( this.omn_pre + '_Click_fb_RSVP_cancel', false );
            this.omniture_rsvp();
            var div_id = rsvp.event_id + ':' + tmfb.uid();
            $(div_id).remove();
        }
        this._clear_rsvp_data();
        this._partition_rsvps( new_data );
    },

    _no_save: function() {
        if( typeof(lbRSVP) != 'undefined' ) {
            lbRSVP.hide();
        }
        this._clear_rsvp_data();
    },

    login_user: function() {
        tmfb.login(this._update_display_after_login.bind(this),'user_likes,user_friends');
    },

    _update_display_after_login: function( logged_in, success ) {
        if( !success || !tmfb.is_connected() ) return;
        if( success && logged_in && tmfb.is_connected() ) {
            this._connectrack();
        }
        this._omnitrack();
        tmfb.start_get_friends( this.get_friends.bind(this) );
    },

    _build_display: function() {
        if( this.display_style == 'artist' && !this.errors.facebook ) {
            if( rsvp_events.length > 0 ) {
                this._build_rsvp_event_list();
            }
            this._build_user_info();
            this._build_user();
            jQuery('#attending-module').show();
        }
        if( this.display_style == 'confirmation' && !this.errors.facebook ) {
            this._build_user_info();
            this._build_user();
            jQuery('#attending-module').show();
        }
        this._build_friends();
        this._build_everyone();
        this.end = new Date().getTime();
        if( ((this.end - this.start) / 1000 < 5) && this.first ) {
            this.first = false;
            jQuery('#rsvp_module').show();
            jQuery('#rsvp_module').trigger('rsvpmodule:loaded');
        }
    },

    _build_user_info: function() {
        var txt;
        if( tmfb.is_connected() ) {
            var user = tmfb.user().facebook;
            if( this.display_style == 'artist' ) {
                txt = this.rsvps.me.length > 0 ? "<USER>, are you going to see another FIFA Women’s World Cup Canada 2015 event?" : "<USER>, are you going to see FIFA Women’s World Cup Canada 2015?";
            }
            if( this.display_style == 'confirmation' ) {
                var event = rsvp_events[0];
                txt = "<USER>, tell your friends you're going to <EVENT> on <REGIONAL_DATE>!";
                var date_disp;
                if( event.date ) {
                    date_disp = "<MONTH ABRV> <DATE>, <YEAR>".replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day).replace('<YEAR>',event.date.year);
                } else {
                    date_disp = event.display_date;
                }
                txt = txt.replace('<EVENT>', event.name).replace('<USER>', user.first_name).replace('<REGIONAL_DATE>', date_disp);
            }
            txt = txt.replace('<USER>', user.first_name);
            jQuery('#rsvp-fb-profile').empty().append('<a href="http://www.facebook.com/' + user.id + '" target="_new"><img src="' + user.picture.data.url + '" /></a>');
        }
        else {
            jQuery('#rsvp-fb-profile').empty().append('<a href="" onclick="RSVPModule.login_user(); return false;"><img src="http://s1.ticketm.net/tm/en-ca/img/sys/facebook/generic_50x50.gif" alt="Anonymous" /></a>');
            if( this.display_style == 'artist' ) {
                txt = "Are you going to see FIFA Women’s World Cup Canada 2015?";
            }
            if( this.display_style == 'confirmation' ) {
                var event = rsvp_events[0];
                var date_disp;
                txt = "Tell your friends you're going to see <EVENT> on <REGIONAL_DATE>!";
                if( event.date ) {
                    date_disp = '<MONTH ABRV> <DATE>, <YEAR>';
                    date_disp = date_disp.replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day).replace('<YEAR>',event.date.year);
                } else {
                    date_disp = event.display_date;
                }
                txt = txt.replace('<EVENT>', event.name).replace('<REGIONAL_DATE>', date_disp);
            }
        }
        jQuery('#user-all-events').remove();
        jQuery('#user-question-only-event').hide();
        jQuery('#user-question').show();
        jQuery('#rsvp-question-cont').show();
        jQuery('#rsvp-question').empty().append(txt);
    },

    _build_user: function() {
        if( rsvp_events.length < 1 ) {
            jQuery('#rsvp-question-cont').empty().append("FIFA Women’s World Cup Canada 2015 has no events scheduled.");
        }
        else {
            jQuery('#my_rsvps').empty();
            if( this.rsvps.me.length == 1 && rsvp_events.length == 1 ) {
                var d = this.rsvps.me[0];
                var status;
                if( d.status_type_id == 1 ) {
                    status = "You are attending <EVENT> on <REGIONAL_DATE>";
                }
                if( d.status_type_id == 2 ) {
                    status = "You may be attending <EVENT> on <REGIONAL_DATE>";
                }
                var event = jQuery.grep( rsvp_events, function(n){ return n.id == d.event_id; } )[0];
                if( typeof(event) === 'undefined' ) {
                    return;
                }

                var date_disp;
                if( event.date ) {
                    date_disp = "<MONTH ABRV> <DATE>, <YEAR>".replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day).replace('<YEAR>',event.date.year);
                } else {
                    date_disp = event.display_date;
                }
                             
                 var to_add = '<div class="rsvp-response" id="' + d.event_id + ':' + d.fb_uid + '">';
                    to_add += '<a href="" class="rsvp-cancel" onclick="RSVPModule.add_rsvp(3,\'' + d.event_id + '\');return false;">Cancel RSVP</a>';
                    to_add += status.replace('<EVENT>', event.name).replace('<REGIONAL_DATE>', date_disp);
                    to_add += '<ul class="option"><li><a href="" onclick="RSVPModule.invite(\'' + event.id + '\'); return false;" class="mail-icon"><b>Send Event Invitation</b></a></li></ul></div>';
                jQuery('#user-question').hide();
                jQuery('#user-question-only-event').empty().append(to_add).show();
            }
            var event_dd_size = jQuery('#rsvp_event_select').children().length;
            if( this.rsvps.me.length == ( rsvp_events.length < event_dd_size ? rsvp_events.length : event_dd_size ) && rsvp_events.length > 1 && this.rsvps.me.length > 1 ) {
                jQuery('#rsvp-question-cont').hide();
                jQuery('#user-question').append('<div class="rsvp-response" id="user-all-events">' + "You are going to all the FIFA Women’s World Cup Canada 2015 events!" + '</div>');
            }
            if( this.rsvps.me.length >= 1 && rsvp_events.length > 1 ) {
                jQuery('#my_rsvps').append('<div class="hrline"></div>');
                for( i = 0 ; i < this.rsvps.me.length ; i++ ) {
                    var d = this.rsvps.me[i];
                    var status;
                    if( d.status_type_id == 1 ) {
                        status = "You are attending <EVENT> on <REGIONAL_DATE>";
                    }
                    if( d.status_type_id == 2 ) {
                        status = "You may be attending <EVENT> on <REGIONAL_DATE>";
                    }
                    var event = jQuery.grep( rsvp_events, function(n){ return n.id == d.event_id; } )[0];
                    if( typeof(event) === 'undefined' ) {
                        continue;
                    }
                    var date_disp;
                    if( event.date ) {
                        date_disp = "<MONTH ABRV> <DATE>, <YEAR>".replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day).replace('<YEAR>',event.date.year);
                    } else {
                        date_disp = event.display_date;
                    }

                     var to_add = '<div class="rsvp-response" id="' + d.event_id + ':' + d.fb_uid + '">';
                        to_add += '<a href="" class="rsvp-cancel" onclick="RSVPModule.add_rsvp(3,\'' + d.event_id + '\');return false;">Cancel RSVP</a>';
                        to_add += status.replace('<EVENT>', event.name).replace('<REGIONAL_DATE>', date_disp) + '<br />';
                        to_add += '<a href="" onclick="RSVPModule.invite(\'' + event.id + '\'); return false;">Send Event Invitation</a></div>';
                    jQuery('#my_rsvps').append(to_add);
                }
            }
        }
    },

    _build_friends: function() {
        jQuery('#f_tbody').empty();
        jQuery('#rsvp_friends_list').empty();
        if( this.rsvps.friends.length > 0 ) {
            var friends_all_collection = '';
            var has_more = false;
            if( this.display_style == 'confirmation' && jQuery('#rsvp_friends_list').length < 1 ) {
                jQuery('#friends_content').append('<ul class="attend-list" id="rsvp_friends_list"></ul>');
            }
            if( this.display_style == 'confirmation' && this.rsvps.friends.length > 5 && jQuery('#rsvp_friends_all_list').length < 1 ) {
                this._build_confirm_all_event('#friends_all_event');
            }
            jQuery('#more_attending_friends_tbody').empty();
            for( i = 0 ; i < this.rsvps.friends.length ; i++ ) {
                var d = this.rsvps.friends[i];
                var status;
                if( d.status_type_id == 1 ) {
                    status = "is attending <EVENT> at <VENUE> on <REGIONAL_DATE>";
                }
                if( d.status_type_id == 2 ) {
                    status = "may be attending <EVENT> at <VENUE> on <REGIONAL_DATE>";
                }
                var user = tmfb.fobs[d.fb_uid].facebook;
                var user_link = 'http://www.facebook.com/' + user.id;
                var event = jQuery.grep( rsvp_events, function(n){ return n.id == d.event_id; } )[0];
                if( typeof(event) === 'undefined' ) {
                    continue;
                }
		var date_disp;
                if( event.date ) {
                    date_disp = "<MONTH ABRV> <DATE>".replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day);
                } else {
                    date_disp = event.display_date;
                }

                var det_new = event.redirect ? ' target="_new"' : '';
                var omn_delimiter = event.url.match(/\?/) ? '&' : '?';
                var event_link = '<a href="' + event.url + omn_delimiter + 'SREF=P_' + this.omn_module + '_main"' + det_new + '>' + event.name;
                if( this.display_style == 'artist' ) {
                    var to_add = '<tr><td class="fb-image-col"><a target="_new" href="' + user_link + '">';
                        to_add += '<img src="' + user.picture.data.url + '" alt="' + user.first_name + '" /></a></td>';
                        to_add += '<td class="fb-details-col"><a href="' + user_link + '" target="_new">' + user.first_name + '</a> ';
                        to_add += status.replace('<EVENT>', event_link).replace('<VENUE>', event.venue.name + '</a>').replace('<REGIONAL_DATE>', date_disp) + ' ';
                        to_add += '<div class="post-time">' + this._date_diff( d.rsvp_timestamp ) +  '</div></td></tr>';
                    if( i < 5 ) {
                        jQuery('#f_tbody').append(to_add);
                    }
                    if( this.rsvps.friends.length > 5 ) {
                        jQuery('#more_attending_friends_tbody').append(to_add);
                        has_more = true;
                    }
                }
                if( this.display_style == 'confirmation' ) {
                    var status;
                    if( d.status_type_id == 1 ) {
                        status = "Attending";
                    }
                    if( d.status_type_id == 2 ) {
                        status = "Maybe";
                    }
                    var user_name = d.fb_uid == tmfb.uid() ? 'You' : user.first_name;
                    var to_add_conf = '<li><a target="_new" href="' + user_link + '">';
                        to_add_conf += '<img src="' + user.picture.data.url + '" alt="' + user_name + '" /></a>';
                        to_add_conf += '<a href="' + user_link + '" target="_new" class="name">' + user_name + '</a> ';
                        to_add_conf += '<div class="status">' + status + '</div></li>';
                    if( i < 6 ) {
                        jQuery('#rsvp_friends_list').append(to_add_conf);
                    }
                    if( this.rsvps.friends.length > 6 ) {
                        if( i % 6 == 0 ) {
                            if( i > 0 ) {
                                friends_all_collection += '</ul>';
                            }
                            friends_all_collection += '<ul class="attend-list">';
                        }
                        friends_all_collection += to_add_conf;
                        if( i == this.rsvps.friends.length - 1 ) {
                            friends_all_collection += '</ul>';
                        }
                        has_more = true;
                    }
                }
            }
            if( this.display_style == 'confirmation' && friends_all_collection.length > 0 ) {
                jQuery('#friends_all_list').empty().append(friends_all_collection);
            }
            if( has_more && jQuery('#friends_content > .more').length < 1 ) {
                jQuery('#friends_content').append('<a href="" onclick="RSVPModule.more_attending(true); return false;" class="more">More Friends Attending &raquo;</a>');
            }
            if( !has_more && jQuery('#friends_content > .more').length > 0 ) {
                jQuery('#friends_content > .more').remove();
            }
            this.show_friends();
        }
        else {
            jQuery('#no-friend-facebook').hide();
            jQuery('#no-friend-rsvps').show();
        }
    },

    _build_everyone: function() {
        jQuery('#e_tbody').empty();
        jQuery('#rsvp_everyone_list').empty();
        if( this.rsvps.everyone.length > 0 ) {
            var everyone_all_collection = '';
            var has_more = false;
            if( this.display_style == 'confirmation' && jQuery('#rsvp_everyone_list').length < 1 ) {
                jQuery('#everyone_content').append('<ul class="attend-list" id="rsvp_everyone_list"></ul>');
            }
            if( this.display_style == 'confirmation' && ( this.rsvps.everyone.length > 6 || this.total_rsvps > 6 ) && jQuery('#rsvp_everyone_all_list').length < 1 ) {
                this._build_confirm_all_event('#everyone_all_event');
            }
            jQuery('#more_attending_people_tbody').empty();
            for( i = 0 ; i < this.rsvps.everyone.length ; i++ ) {
                var d = this.rsvps.everyone[i];
                var status;
                if( d.status_type_id == 1 ) {
                    status = "is attending <EVENT> at <VENUE> on <REGIONAL_DATE>";
                }
                if( d.status_type_id == 2 ) {
                    status = "may be attending <EVENT> at <VENUE> on <REGIONAL_DATE>";
                }
                var user;
                if( typeof(tmfb) != 'undefined' && tmfb.fobs[d.fb_uid] ) {
                    user = tmfb.fobs[d.fb_uid].facebook;
                }
                else if( this.users ) {
                    user = jQuery.grep( this.users, function(n){ return n.id == d.fb_uid; } )[0];
                }
                if( typeof(user) === 'undefined' || user.unknown ) {
                    if( this.display_style != 'confirmation' ) {
                        continue;
                    }
                    else {
                        user = {
                            "first_name" : "Jaspal",
                            "id" : 0,
                            "picture" : {
                                "data" : {
                                    "url" : "http://s1.ticketm.net/tm/en-ca/img/sys/facebook/generic_50x50.gif"
                                }
                            }
                        };
                    }
                }
                var user_link = user.id == 0 ? 'javascript: void(0);' : 'http://www.facebook.com/' + user.id;
                var event = jQuery.grep( rsvp_events, function(n){ return n.id == d.event_id; } )[0];
                if( typeof(event) === 'undefined' ) {
                    continue;
                }
                var date_disp;
                if( event.date ) {
                    date_disp = "<MONTH ABRV> <DATE>".replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day);
                } else {
                    date_disp = event.display_date;
                }

                var det_new = event.redirect ? ' target="_new"' : '';
                var omn_delimiter = event.url.match(/\?/) ? '&' : '?';
                var event_link = '<a href="' + event.url + omn_delimiter + 'SREF=P_' + this.omn_module + '_main"' + det_new + '>' + event.name;
                if( this.display_style == 'artist' ) {
                    var to_add = '<tr><td class="fb-image-col"><a target="_new" href="' + user_link + '">';
                        to_add += '<img src="' + user.picture.data.url + '" alt="' + user.first_name + '" /></a></td>';
                        to_add += '<td class="fb-details-col"><a href="' + user_link + '" target="_new">' + user.first_name + '</a> ';
                        to_add += status.replace('<EVENT>', event_link).replace('<VENUE>', event.venue.name + '</a>').replace('<REGIONAL_DATE>', date_disp) + ' ';
                        to_add += '<div class="post-time">' + this._date_diff( d.rsvp_timestamp ) +  '</div></td></tr>';
                    if( i < 5 ) {
                        jQuery('#e_tbody').append(to_add);
                    }
                    if( this.rsvps.everyone.length > 5 || this.total_rsvps > 5 ) {
                        jQuery('#more_attending_people_tbody').append(to_add);
                        has_more = true;
                    }
                }
                if( this.display_style == 'confirmation' ) {
                    var status;
                    var p_target = user.id == 0 ? '' : ' target="_new"';
                    if( d.status_type_id == 1 ) {
                        status = "Attending";
                    }
                    if( d.status_type_id == 2 ) {
                        status = "Maybe";
                    }
                    var user_name = user.id == tmfb.uid() ? 'You' : user.first_name;
                    var to_add_conf = '<li><a' + p_target + ' href="' + user_link + '">';
                        to_add_conf += '<img src="' + user.picture.data.url + '" alt="' + user_name + '" /></a>';
                        to_add_conf += '<a' + p_target + ' href="' + user_link + '" class="name">' + user_name + '</a> ';
                        to_add_conf += '<div class="status">' + status + '</div></li>';
                    if( i < 6 ) {
                        jQuery('#rsvp_everyone_list').append(to_add_conf);
                    }
                    if( this.rsvps.everyone.length > 6 || this.total_rsvps > 6 ) {
                        if( i % 6 == 0 ) {
                            if( i > 0 ) {
                                everyone_all_collection += '</ul>';
                            }
                            everyone_all_collection += '<ul class="attend-list">';
                        }
                        everyone_all_collection += to_add_conf;
                        if( i == this.rsvps.everyone.length - 1 ) {
                            everyone_all_collection += '</ul>';
                        }
                        has_more = true;
                    }
                }
            }
            if( this.display_style == 'confirmation' && everyone_all_collection.length > 0 ) {
                jQuery('#everyone_all_list').empty().append(everyone_all_collection);
            }
            if( has_more && this.rsvps.everyone.length < this.total_rsvps ) {
                var fmt_total = this._format_thousands( this.total_rsvps );
                var txt = 'Displaying <DISPLAY_COUNT> out of <TOTAL_COUNT> total RSVPs'.replace('<TOTAL_COUNT>',fmt_total).replace('<DISPLAY_COUNT>',this.rsvps.everyone.length);
            	if( this.display_style == 'confirmation' ) {
	            	jQuery('#everyone_all_list').prepend('<div class="results-tally">' + txt + '</div>');
            	}
            	else {
            		jQuery('.results-tally').empty().append(txt);
            		jQuery('.results-tally').show();
            	}
            }
            if( has_more && jQuery('#everyone_content > .more').length < 1 ) {
                jQuery('#everyone_content').append('<a href="" onclick="RSVPModule.more_attending(); return false;" class="more">More People Attending<span class="hideContent"></span> &raquo;</a>');
            }
            if( !has_more && jQuery('#everyone_content > .more').length > 0 ) {
                jQuery('#everyone_content > .more').remove();
            }
            this.show_everyone();
        }
        else {
            jQuery('#no-facebook').hide();
            jQuery('#no-rsvps').show();
        }
    },

    _build_confirm_all_event: function( to_append ) {
        var event = rsvp_events[0];
        var event_url = event.url;
        var omn_delimiter = event_url.match(/\?/) ? '&' : '?';
            event_url += omn_delimiter + 'SREF=P_' + this.omn_module + '_main"';
        var event_add = '<div class="event-module"><div class="event-image"><a title="' + event.name + '" href="' + event_url + '" target="_new">';
            event_add += '<img alt="' + event.name + '" src="' + event.image + '" /></a></div>';
            event_add += '<div class="event-content"><a href="' + event_url + '" id="artist_link" class="event-name" target="_new">' + event.name + '</a><br />';
            event_add += '<a href="' + event.venue.url + '" id="artist_venue_name_link" class="venue-name-link" target="_new">' + event.venue.name + '</a><br />';
            event_add += event.venue.citystate + '<br />';
            event_add += event.display_date + '</div></div>';
            jQuery( to_append ).empty().append(event_add);
    },

    _build_rsvp_event_list: function() {
        if( tmfb.is_connected() ) {
            if( rsvp_events.length > 1 ) {
                jQuery('#rsvp_event_select').empty();
                var user = tmfb.user().facebook;
                var sort_list = rsvp_events.sortBy(function(s){return s.sort_date});
                for( i = 0 ; i < sort_list.length ; i++ ) {
                    var has_match = (i > 0 && sort_list[i].date_comp == sort_list[i-1].date_comp) || (i < sort_list.length-1 && sort_list[i].date_comp == sort_list[i+1].date_comp);
                    if( sort_list[i].date_end && has_match ) {
                        continue;
                    }
                    var opt_txt = [];
                    opt_txt.push( sort_list[i].date.month + ' ' + sort_list[i].date.day + ', ' + sort_list[i].date.year );
                    if( has_match ) {
                        opt_txt.push( sort_list[i].time );
                    }
                    opt_txt.push( sort_list[i].venue.name + ', ' + sort_list[i].venue.citystate );
                    jQuery('#rsvp_event_select').append('<option value="' + sort_list[i].id + '">' + opt_txt.join(' ') + '</option>');
                }
                jQuery('#select-profile-picture').empty().append('<a href="http://www.facebook.com/' + user.id + '" target="_new"><img src="' + user.picture.data.url + '" /></a>');
            }
        }
    },

    _rsvp_wall_post: function( event_id, status ) {
        var event;
        var my_status;
        if( !this._before_done && this._before_wall_list !== undefined && this._before_wall_list.length > 0 ) {
            this.temp.status = status;
            this.temp.event_id = event_id;
            this._apply_before_wall_dialog();
            return;
        }
        if( event_id && status ) {
            event = jQuery.grep( rsvp_events, function(n){ return n.id == event_id; } )[0];
            my_status = status;
        }
        else {
            var event_id = this.temp.event_id;
            event = jQuery.grep( rsvp_events, function(n){ return n.id ==  event_id; } )[0];
            my_status = this.temp.status;
            this.temp.status = 0;
            this.temp.event_id = '';
        }
        var e_date;
        if( event.date ) {
            e_date = event.date.day_name + ', ' +  event.date.month + ' ' + event.date.day;
        } else {
            e_date = event.display_date;
        }
        var omn_delimiter = event.url.match(/\?/) ? '&' : '?';
        
        if(  my_status == 2 ) {
            tmfb.publish_to_feed_dialog({name:event.name,link:event.url+omn_delimiter+'SREF=' + calcCampaign({SREF:'FBKShare' + this.omn_post}) + '_' + event_id,picture:event.image,actions:[{'name':'Buy Tickets','link':event.url + omn_delimiter + 'SREF=' + calcCampaign({SREF:'FBKShareBuy' + this.omn_post}) + '_' + event_id}]},{'Date':e_date,'Venue':event.venue.name,'Location':event.venue.citystate},this._post_rsvp_dialog_maybe.bind(this));
        }
        if(  my_status == 1 ) {
            tmfb.publish_to_feed_dialog({name:event.name,link:event.url+omn_delimiter+'SREF=' + calcCampaign({SREF:'FBKShare' + this.omn_post}) + '_' + event_id,picture:event.image,actions:[{'name':'Buy Tickets','link':event.url + omn_delimiter + 'SREF=' + calcCampaign({SREF:'FBKShareBuy' + this.omn_post}) + '_' + event_id}]},{'Date':e_date,'Venue':event.venue.name,'Location':event.venue.citystate},this._post_rsvp_dialog_attend.bind(this));
        }
    },

    omniture_rsvp: function( done ) {
        this._omn_done = done ? true : false;
    },

    before_wall_dialog: function ( callback ) {
        this._before_wall_list.push(callback);
    },

    _apply_before_wall_dialog: function () {
        for( var i = 0; i < this._before_wall_list.length; i++ ) {
            this._before_done = true;
            this._before_wall_list[i]( function(){ this._rsvp_wall_post() }.bind(this) );
        }
    },

    after_wall_dialog: function ( callback ) {
        this._after_wall_list.push(callback);
    },

    _apply_after_wall_dialog: function ( response ) {
        for( var i = 0; i < this._after_wall_list.length; i++ ) {
            (this._after_wall_list[i])( response );
        }
    },

    _post_rsvp_dialog_attend: function( response ) {
        if( response && response.post_id ) {
            var track_val = this.omn_pre + '_Click_fb_WallPost_attend';
            omniTracking.navigation_link( track_val, false );
        }
        this._apply_after_wall_dialog( response );
    },

    _post_rsvp_dialog_maybe: function( response ) {
        if( response && response.post_id ) {
            var track_val = this.omn_pre + '_Click_fb_WallPost_maybe';
            omniTracking.navigation_link( track_val, false );
        }
        this._apply_after_wall_dialog( response );
    },

    _omnitrack: function() {
        if( tmfb.is_logged_in() ) { 
            var tmp = tmfb.is_connected() ? 'Connected' : 'NotConnected';
            tmp += '_Identified';
        }
        else {
            var tmp = 'NotConnected_NotIdentified';
        }
        tm_omn.manageVars('clearVars');
        tm_omn.linkTrackVars = 'prop25,eVar43';
        tm_omn.prop25 = tmp;
        tm_omn.eVar43 = tmp;
        tm_omn.tl(true,'o','FB Log-in Status Check');
    },

    _connectrack: function() {
        tm_omn.linkTrackVars = 'events';
        tm_omn.linkTrackEvents = 'event47';
        tm_omn.events = 'event47';
        tm_omn.tl(true,'o','Facebook Connected');
    },

    _partition_rsvps: function( rsvps ) {
        this.rsvps['me'] = [];
        this.rsvps['friends'] = [];
        this.rsvps['everyone'] = [];
        if( typeof( rsvps ) != 'undefined' ) {
            var dupe_check = {};
            for( i = 0 ; i < rsvps.length ; i++ ) {
                if( rsvps[i].status_type_id == 3 ) {
                    continue;
                }
                var event = jQuery.grep( rsvp_events, function(n){ return n.id == rsvps[i].event_id; } )[0];
                if( typeof(event) === 'undefined' ) {
                    continue;
                }
                if( dupe_check[ rsvps[i].fb_uid + rsvps[i].event_id ] ) {
                    continue;
                }
                else {
                    dupe_check[ rsvps[i].fb_uid + rsvps[i].event_id ] = true;
                }
                if( rsvps[i].fb_uid === tmfb.uid() ) {
                    this.rsvps['me'].push(rsvps[i]);
                    this.rsvps['friends'].push(rsvps[i]);
                    this.rsvps['everyone'].push(rsvps[i]);
                }
                else if( jQuery.inArray(rsvps[i].fb_uid, this.my_friends) != -1 ) {
                    this.rsvps['friends'].push(rsvps[i]);
                    this.rsvps['everyone'].push(rsvps[i]);
                }
                else {
                    this.rsvps['everyone'].push(rsvps[i]);
                }
            }
        }
        this.rsvps.friends.sort( this._sort_time_desc );
        this.rsvps.everyone.sort( this._sort_time_desc );
        this.rsvps.me.sort( this._sort_time_desc );
        this._build_display();
    },

    _handle_session_error: function( error_data ) {
        if( typeof(lbRSVP) != 'undefined' ) {
            lbRSVP.hide();
        }
        this._clear_rsvp_data();
        this.get_rsvps();
        alert('FB User session is missing, not saving RSVP data');
    },

    _handle_timeout: function() {
        this.errors.facebook = true;
        this.show_fb_error();
    },

    _clear_rsvp_data: function() {
        this.rsvp_status = 0;
        this.rsvp_eid = '';
    },

    _format_thousands: function( num ) {
        num += '';
        var rgx = /(\d+)(\d{3})/;
        while( rgx.test(num) ) {
            num = num.replace(rgx, '$1' + ',' + '$2');
        }
        return num
    },

    _sort_time_desc: function( a, b ) {
        var a_time = a.rsvp_timestamp;
        var b_time = b.rsvp_timestamp;
        if( a_time < b_time) {return 1;}
        if( a_time > b_time) {return -1;}
        return 0;
    },

    _date_diff: function( time ) {
        var now = new Date();
        var time_int = parseInt(time);
        var y = now.diff( time_int, 'year' );
        var m = now.diff( time_int, 'month' );
        var w = now.diff( time_int, 'week' );
        var d = now.diff( time_int, 'day' );
        var h = now.diff( time_int, 'hour' );
        var min = now.diff( time_int, 'minute' );
        var s = now.diff( time_int, 'second' );

        if( d > 1 ) {
            if( d >= 60  ) {
                return '<NUMBER> months ago'.replace('<NUMBER>', m);
            }
            if( d >=30 && d < 60 ) {
                return '1 month ago';
            }
            if( d >= 14 && d < 30 ) {
                return '<NUMBER> weeks ago'.replace('<NUMBER>', w);
            }
            if( d >= 7 && d < 14 ) {
                return '1 week ago';
            }
            if( d >= 2 && d < 7 ) {
                return '<NUMBER> days ago'.replace('<NUMBER>', d);
            }
        }
        else if( h >= 1 ) {
            if( h >= 24 && h < 48 ) {
                return '1 day ago';
            }
            if( h >= 2 && h < 24 ) {
                return '<NUMBER> hours ago'.replace('<NUMBER>', h);
            }
            if( h >= 1 && h < 3 ) {
                return '1 hour ago';
            }
        }
        else {
            if( min >= 2 && min < 60 ) {
                return '<NUMBER> minutes ago'.replace('<NUMBER>', min);
            }
            if( min >= 1 && min < 3 ) {
                return '1 minute ago';
            }
            else {
                return 'a moment ago';
            }
        }
    }
});

SectionRSVPModule = Class.create( RSVPModule, {
    get_rsvps: function() {
        var to_get = {};
            to_get[this.to_get.param] = this.to_get.val;
            to_get['session'] = tmfb.session() ? tmfb.session() : 'null';
        jQuery.getJSON(
            this.backend,
            to_get,
            function( data, textStatus, jqXHR ) {
                this._partition_rsvps( data );
            }.bind(this)
        );
    },

    _build_display: function() {
        this._build_everyone();
        this._build_friends();
        jQuery('#rsvp_module').show();
        jQuery('#rsvp_module').trigger('rsvpmodule:loaded');
    },

    _build_everyone: function() {
        if( this.rsvps.everyone.length > 0 ) {
            jQuery('#e_tbody').empty();
            jQuery('#rsvp_everyone_list').empty();
            jQuery('#more_attending_people_tbody').empty();
            var more_link = this.rsvps.everyone[0].artist_id ? "More Popular Artists" : "More Popular Events";
            for( i = 0 ; i < this.rsvps.everyone.length ; i++ ) {
                var d = this.rsvps.everyone[i];
                var to_add;
                if( d.artist_id ) {
                    var a_img = d.artist_image ? d.artist_image : '/tmimages/' + this.generic_images[ d.artist_major ];
                    var omn_delimiter = d.artist_seo_url.match(/\?/) ? '&' : '?';
                    var artist_link = d.artist_seo_url + omn_delimiter + 'SREF=P_' + this.omn_module + '_main';
                    to_add = '<tr><td class="image-col"><a href="http://www.ticketmaster.ca' + artist_link + '">';
                    to_add += '<img src="http://s1.ticketm.net/tm/en-ca/' + a_img + '" alt="' + d.artist_name.replace(/"/g, '&quot;') + '" /></a></td>';
                    to_add += '<td class="details-col"><a href="http://www.ticketmaster.ca' + artist_link + '">' + d.artist_name + '</a></td>';
                    to_add += '<td class="count-col"><div class="count">' + d.rsvp_total + '</div>RSVPs</td></tr>';
                }
                else {
		    var date_disp;
                    var event_time = this.rsvps.date[ d.event.artist_id + d.event.date_comp ] > 1 ? ' ' + d.event.date.time : '';
                    if( d.event.date ) {
                        date_disp = "<MONTH ABRV> <DATE>, <YEAR>".replace('<MONTH ABRV>',d.event.date.month).replace('<DATE>',d.event.date.day).replace('<YEAR>',d.event.date.year) + event_time;
                    } else {
                        date_disp = d.event.display_date;
		    }

                    var event_link = 'http://www.ticketmaster.ca';
                    var event_image = d.event.image ? d.event.image : '/tmimages/' + this.generic_images[ d.event.major ];
                    var det_new = d.event.system_url ? ' target="_new"' : '';
                    if( d.event.system_url ) {
                        var pr_postpend = "&eventid=" + d.event.id + "&artistid=" + d.event.artist_id + "&artistname=" + (d.event.artist_name != d.event.name ? d.event.name : d.event.artist_name);
                            pr_postpend += "&crosssite=TM_CA:" + d.event.artist_id + ":" + d.event.venue.id;
                        event_link += '/partner_redirect?v=' + encodeURIComponent( d.event.system_url ) + pr_postpend;
                    }
                    else {
                        event_link += '/event/' + d.event.id;
                    }
                    var omn_delimiter = event_link.match(/\?/) ? '&' : '?';
                    event_link += omn_delimiter + 'SREF=P_' + this.omn_module + '_main"';
                    to_add = '<tr><td class="image-col"><a href="' + event_link + '"' + det_new + '>';
                    to_add += '<img src="http://s1.ticketm.net/tm/en-ca/' + event_image + '" alt="' + d.event.name.replace(/"/g, '&quot;') + '" /></a></td>';
                    to_add += '<td class="details-col"><a href="' + event_link + '"' + det_new + '>' + d.event.name + '</a><br />' + d.event.venue.name + '<br />';
                    to_add += date_disp + '</td>';
                    to_add += '<td class="count-col"><div class="count">' + d.rsvp_total + '</div>RSVPs</td></tr>';
                }
                if( i < 5 ) {
                    jQuery('#e_tbody').append(to_add);
                }
                if( this.rsvps.everyone.length > 5 ) {
                    jQuery('#more_attending_people_tbody').append(to_add);
                }
            }
            if( this.rsvps.everyone.length > 5 && jQuery('#everyone_content > .more').length < 1 ) {
                jQuery('#everyone_content').append('<a href="" onclick="SectionRSVPModule.more_attending(); return false;" class="more">' + more_link + '<span class="hideContent"></span>  &raquo;</a>');
            }
            jQuery('#no-facebook').hide();
            jQuery('#everyone_table').show();
        }
        else {
            jQuery('#no-facebook').hide();
            jQuery('#no-rsvps').show();
        }
        jQuery('#rsvp_module').show();
    },

    _build_friends: function() {
        if( this.rsvps.friends.length > 0 ) {
            jQuery('#f_tbody').empty();
            jQuery('#rsvp_friends_list').empty();
            jQuery('#more_attending_friends_tbody').empty();
            var more_link = "More Friends' Activity".replace("'", "\'");
            for( i = 0 ; i < this.rsvps.friends.length ; i++ ) {
                var d = this.rsvps.friends[i];
                var to_add;
                var status;
                if( d.status_type_id == 1 ) {
                    status = "is attending <EVENT> at <VENUE> on <REGIONAL_DATE>";
                }
                if( d.status_type_id == 2 ) {
                    status = "may be attending <EVENT> at <VENUE> on <REGIONAL_DATE>";
                }
                var event = d.event;
                var user = tmfb.fobs[d.fb_uid].facebook;
                var user_link = 'http://www.facebook.com/' + user.id;
                var event_url = 'http://www.ticketmaster.ca';
                var date_disp;
                if( event.date ) {
                    date_disp = "<MONTH ABRV> <DATE>".replace('<MONTH ABRV>',event.date.month).replace('<DATE>',event.date.day);
                } else {
                    date_disp = event.display_date;
                }

                var det_new = event.system_url ? ' target="_new"' : '';
                if( event.system_url ) {
                    var artist_id = event.artist_url.split('/').last();
                    var pr_postpend = "&eventid=" + event.id + "&artistid=" + artist_id + "&artistname=" + event.artist_name;
                        pr_postpend += "&crosssite=TM_CA:" + artist_id + ":" + event.venue.id;
                    event_url += '/partner_redirect?v=' + encodeURIComponent( event.system_url ) + pr_postpend;
                }
                else {
                    event_url += '/' + event.url;
                }
                var omn_delimiter = event_url.match(/\?/) ? '&' : '?';
                    event_url += omn_delimiter + 'SREF=P_' + this.omn_module + '_main"';
                var event_link = '<a href="' + event_url + det_new + '>' + event.name;
                var to_add = '<tr><td class="fb-image-col"><a target="_new" href="' + user_link + '">';
                    to_add += '<img src="' + user.picture.data.url + '" alt="' + user.first_name + '" /></a></td>';
                    to_add += '<td class="fb-details-col"><a href="' + user_link + '" target="_new">' + user.first_name + '</a> ';
                    to_add += status.replace('<EVENT>', event_link).replace('<VENUE>', event.venue.name + '</a>').replace('<REGIONAL_DATE>', date_disp) + ' ';
                    to_add += '<div class="post-time">' + this._date_diff( d.rsvp_timestamp ) +  '</div></td></tr>';
                if( i < 5 ) {
                    jQuery('#f_tbody').append(to_add);
                }
                if( this.rsvps.friends.length > 5 ) {
                    jQuery('#more_attending_friends_tbody').append(to_add);
                }
            }
            if( this.rsvps.friends.length > 5 && jQuery('#friends_content > .more').length < 1 ) {
                jQuery('#friends_content').append('<a href="" onclick="SectionRSVPModule.more_attending(true); return false;" class="more">' + more_link + ' &raquo;</a>');
            }
            this.show_friends();
        }
        else {
            jQuery('#no-friend-facebook').hide();
            jQuery('#no-friend-rsvps').show();
        }
    },

    invite: function( is_logged ) {
        if( !tmfb.is_connected() ) {
            var is_logged = tmfb.is_logged_in();
            tmfb.login(function(success) {
               if( success ) this.invite( is_logged );
            }.bind(this), 'user_likes,user_friends');
        }
        else {
            var domain_link = 'http://www.ticketmaster.ca';
            var omn_link = domain_link.match(/\?/) ? '&' : '?' + 'SREF=' + calcCampaign({SREF:'FBKInvite' + this.omn_post});
                domain_link = domain_link + omn_link;
            var domain_name = "Come check out Ticketmaster Canada!";
            var return_url = self.location.href;

            tmfb.send_invite_dialog({
                msg_text: domain_name,
                msg_link: domain_link,
                return_url: return_url,
                invite_type: "Ticketmaster Canada",
                action_text: "Ask your friends to connect to Ticketmaster Canada",
                picture:"http://s1.ticketm.net/tm/en-ca/dbimages/168207a.jpg"
            });
    
            omniTracking.navigation_link( this.omn_pre + '_Click_fb_RSVP_invite', false );
            this._omnitrack();
            if( is_logged && tmfb.is_connected() ) {
                this._connectrack();
            }
        }
    },

    _sort_rsvp_total: function( a,b ) {
        var a_total = parseInt(a.rsvp_total);
        var b_total = parseInt(b.rsvp_total);
        if( a_total < b_total) {return 1;}
        if( a_total > b_total) {return -1;}
        return 0;
    },

    _partition_rsvps: function( section_data ) {
        this.rsvps['me'] = [];
        this.rsvps['friends'] = [];
        this.rsvps['everyone'] = [];
        this.rsvps['date'] = {};
        if( typeof( section_data.rsvps ) != 'undefined' ) {
            for( i = 0 ; i < section_data.rsvps.length ; i++ ) {
                this.rsvps['everyone'].push(section_data.rsvps[i]);
                if( section_data.rsvps[i].event ) {
                    var date_key = section_data.rsvps[i].event.artist_id + section_data.rsvps[i].event.date_comp;
                    this.rsvps['date'][ date_key ] = typeof(this.rsvps['date'][ date_key ]) === 'undefined' ? 1 : this.rsvps['date'][ date_key ]+1;
                }
            }
        }
        if( typeof( section_data.friends ) != 'undefined' ) {
            for( i = 0 ; i < section_data.friends.length ; i++ ) {
                if( section_data.friends[i].status_type_id == 3 ) {
                    continue;
                }
                if( jQuery.inArray(section_data.friends[i].fb_uid, this.my_friends) != -1 ) {
                    this.rsvps['friends'].push(section_data.friends[i]);
                }
                if( section_data.friends[i].fb_uid == tmfb.uid() ) {
                    this.rsvps['friends'].push(section_data.friends[i]);
                }
            }
        }
        this.rsvps.friends.sort( this._sort_time_desc );
        this.rsvps.everyone.sort( this._sort_rsvp_total );
        this._build_display();
    }
});


var MultiActDisplay = Class.create({
   initialize: function(){
      this.page_name = arguments[0] || 'search';
      this.search_name_id = arguments[1] || '';
      this.omniture_index = arguments[2]; // omniture_index is currently implemented for ADP list_view and Search pages only;
   },
   createPlaceHolder: function(td_class, ma_el, el_class){
       this.td_class = td_class || 'event';
       this.ma_el = ma_el || 'div';
       this.el_class = el_class || 'txt11';
       return '<' + this.ma_el + ' class="'+ this.el_class +'"></' + this.ma_el + '>';
   },
   lookupArtistIdx: function(d){
       var idx = -1;
       if(this.search_name_id.length <= 0 || d.AttractionId.length <= 0 ||d.AttractionName.length <= 0) return idx;
       idx = d.AttractionId.indexOf(this.search_name_id);
       if(idx == -1) {
          var pattern = new RegExp('^' + this.search_name_id , 'i');
          jQuery.each(d.AttractionName, function(i, value) {
               if(pattern.test(value)){ 
                  idx = i;
                  return;}
             });
       }
       return idx;
   },
   generateEventDetail: function(d, typeKey){
       var ma = jQuery(this.td_class + ' ' + this.ma_el +'.'+ this.el_class +':last');
       if (ma == null || ma.length <= 0) return;         if (!d) { ma.remove(); return;}
       var reqIdx = this.lookupArtistIdx(d);
       typeKey += ':' + d.EventId;
       this.computeMax2Line(ma, d, typeKey, (reqIdx == -1) ? undefined: reqIdx);
   },
   computeMax2Line: function(ma, d, moreParam, reqIdx){
       moreParam = moreParam || '';
       var max_height = parseInt(ma.css('line-height').replace('px', '')) * 2 + 5;
       var ma_arr = [];
       var clickFunction;
       var max_size = 10;
       if(d.AttractionName === undefined){
            d.AttractionName = "";
       }
            
       var has_more = (d.AttractionName.length > max_size);
       var name_arr = jQuery.map(d.AttractionName.slice(0, max_size), function(n, i) {
          if (n.length <= 0 || (d.ActOverride && d.EventName == n)) {
            return [];
          } else {
	          if(reqIdx !== undefined && reqIdx == i ) {
              ma_arr.push(n);
            } else {
              clickFunction = "track_multiAct_prop40('" + moreParam.split(':')[0] + "'," + this.omniture_index + ");";
              ma_arr.push(createMultiActLink({ desc: n, link: d.AttractionSEOLink[i], omni_auto_track: false, clkfunc: clickFunction}));
            }
            return n;
          }
       }.bind(this));
      
       if(name_arr.length == 0) {
           ma.remove(); 
           return false;
       }
    
       if (reqIdx == undefined) reqIdx = 0;
       else if (reqIdx >= max_size) {
          ma_arr.push(d.AttractionName[reqIdx]);
          reqIdx = ma_arr.length - 1;
       }
       else if(reqIdx != 0) { 
          reqIdx = name_arr.indexOf(d.AttractionName[reqIdx]);
          if(reqIdx < 0) reqIdx = 0; 
       }

       clickFunction = "displayMultiActDetail('" + moreParam + "', " + this.omniture_index + ");";
       var more_link = createMultiActLink({ desc: "more...", clkfunc: clickFunction, scode: this.page_name + '_more_acts'});

       var num = ma_arr.length + 1;
       do{
         num--;
         has_more = has_more || (num < ma_arr.length);
         var name = (reqIdx >= num) ? ma_arr.slice(0,num).concat(ma_arr[reqIdx]).join(', ') : ma_arr.slice(0, num).join(', ');         ma.html("Details: " + name + ((has_more) ? ', ' + more_link: ""));
       } while(ma.height() > max_height && num > 0);

       if(ma.height() <=  max_height){  
         ma_arr = jQuery.map((reqIdx >= num) ? ma_arr.slice(0,num).concat(ma_arr[reqIdx]) : ma_arr.slice(0,num), function(n, i) {
                   return  n.replace(/=mas_code/g, '=' + this.page_name + '_act_' + (i+1) + '_name');
         }.bind(this));
 
         ma.html("Details: "  + ma_arr.join(", ") + ((has_more) ? ', ' +  more_link: ""));
       } 
       else { //ignore when the name still doesn't fit
         ma.html("Details: "  + more_link);
       } 
  }  
});

function track_multiAct_prop40 (type, absolute_index) {
    var omniture_type;
    switch (type) {
        case 'local':
            omniture_type = 'Local';
            break;
        case 'national':
            omniture_type = 'National';
            break;
        case 'domain':
            omniture_type = 'International';
            break;
        default:
            omniture_type = 'Unrecognized';
            break;
    }
    var prop40_value,
        temp_prop14;


    prop40_value = 'Details_ADP_' + omniture_type + '_' + absolute_index;
    tm_omn.prop40 = 'TM_CA: ' + prop40_value;
    tm_omn.eVar17 = tm_omn.prop21 = tm_omni_temp.get('omnAID');
    tm_omn.linkTrackVars = 'prop21,prop40,eVar17';
    tm_omn.linkTrackEvents = '';
    /* prop14 workaround to get rid of event27 in search tracking click calls */
    temp_prop14 = tm_omn.prop14;
    tm_omn.prop14 = undefined;
    tm_omn.tl(true, 'o', 'artist_events_list_details_click');
    tm_omn.prop14 = temp_prop14;

};

function createMultiActLink(args){
    var desc = typeof(args.desc) !== 'undefined' ? args.desc : "Details";
    var link = typeof(args.link) !== 'undefined' ? args.link : '';
    var clkfunc = typeof(args.clkfunc) !== 'undefined' ? args.clkfunc : '';
    var scode = typeof(args.scode) !== 'undefined' ? args.scode : '';
    var omni_auto_track = typeof(args.omni_auto_track) !== 'undefined' ? args.omni_auto_track : true; // true by default;

    link = ((link != '') ? ('http://www.ticketmaster.ca' + link + '?tm_link=mas_code') : 'javascript:;');
    if (clkfunc != '') {
      if (omni_auto_track) {
        clkfunc = 'onclick="omniTracking.navigation_link(\'' + scode + '\');' + clkfunc + '"';
      } else {
        clkfunc = 'onclick="' + clkfunc + '"';
      }
    }
    return '<a ' +  'href="' + link + '" ' + clkfunc + '>' + desc  + '</a>';
} 

function isMultiActEvent(d){
  if(d == null) return false;
  var genre_suppressions = [10002,10003,10004,10005,10006,10012];
  if (d.MajorGenreId && genre_suppressions.indexOf(d.MajorGenreId[0]) != -1) return false;
  return (d.ActOverride || d.AttractionName.length > 1);
}

/**
* omniture_index is currently implemented for ADP list_view and Search pages only;
*/
function displayMultiActDetail(param, omniture_index){
    if(multiActDetailLightBox == null) return false;
    if(param == 'undefined') return false;
    param  = param.split(':');
    
    var data = null;
    data = search_data.get(param[0]);
    if(data == null) return false;

    data = data.docs;
    if(data == null) return false;

    data =  data.findAll( function(n){ return n.EventId == param[1]});
    if(data == null || data.length < 1) return false;

    return multiActDetailLightBox.populateArtists(data[0], param[0], omniture_index);
}

var MultiActLightBox = Class.create({
   initialize: function(){
      this.popup = new Popup( 'multi_act_detail', {
         lightbox: { opacity: 0.6 },
         close_id: ['multi_act_detail_close', 'multi_act_detail_close_sec'],
         zIndex: 151
      });
   },
   show: function(){
      this.popup.show({
         anchor_id: document.body,
         popup_align: {
            x: "center",
            y: "center"
         }
      });
   },
   /**
   * omniture_index is currently implemented for ADP list_view and Search pages only;
   */
   populateArtists: function(d, type, omniture_index) {
    try{
       var ul = jQuery('#multi_act_detail ul');
       if (ul == null || ul.length <= 0) return false;
      
       ul.children('li').remove();

       var lb = jQuery('#multi_act_label');
       if (lb && lb.length > 0) lb.html(d.EventName);

       var cnt = 0;
       var aid =  global.get('aid');   
       var ma_arr = jQuery.map(d.AttractionName, function(n, i){
           if(n.length <= 0 || (d.ActOverride && d.EventName == n)) return [];
           else {
              cnt++;

                if (d.AttractionId[i] == aid) {
                  return '<li>' + n + '</li>';
                } else {
                  var clickFunction;
                  clickFunction = "track_multiAct_prop40('" + type + "', " + omniture_index + ");";
                  var li =  createMultiActLink({ desc: n, link: d.AttractionSEOLink[i], omni_auto_track: false, clkfunc: clickFunction });
                  return '<li>' + li.replace(/=mas_code/g, '=multi_act_' + cnt + '_name') + '</li>';
                }

           }
       }.bind(this));
    
       ul.html(ma_arr.join(''));
       this.show();
       return true;

    } catch (ex) {
	    return false;
    }
   }
});



    var EventList = Class.create({
        initialize: function() {
            this.pages = arguments[0];
        },
        drawEvents: function() {
            var jsonLdArr = [];
            $w('national domain').each( function(d){
                if($('hdr_' + d)) $('hdr_' + d).hide();
                if($('th_' + d)) $('th_' + d).hide();
                if($('tbl_' + d)) $('tbl_' + d).hide();
                if($('spc_' + d)) $('spc_' + d).hide();
                if($('no_local_msg')) $('no_local_msg').hide();
                $('tbl_' + d).childElements().reject(function(e){ return e.id == 'row_' + d }).invoke('remove');
            });
            if( this.pages.stack.length ) {
                $('artist_list').show();
                // we have multiple pages, build the current one
                var current = this.pages.stack[ global.get('pages').current ];
                current.each( function(p,idx){
                    var tmp = p.split(':');
                    var data = search_data.get( tmp[0] ).docs[tmp[1]];
                    if( data ) {
                        var jsonLdPL =  this.buildEvents( data, tmp[0], idx );
                        jsonLdArr.push({"d": data, "purchaseLink" : jsonLdPL});
                    }
                    else {
                        new LightBox('modal','loading_lb').showContent();
                        var set = global.get('set') + 1;
                        getData({ aid : global.get('aid'), set : set });
                        global.set('set', set);
                        throw $break;
                    }
                }.bind(this) );
                this.buildCounts( current );
                jQuery(document.body).trigger("searchresultsdisplay", [{"status": "success"}]);
            }
            else if( search_data.get('total') == 0 ) {
                $('artist_list').hide();
                $('no_tickets').show();
                if($('show_soundspike_itinerary')) $('show_soundspike_itinerary').show();
                $('loading').hide();
                jQuery(document.body).trigger("searchresultsdisplay", [{"status": "no_results"}]);
            }
            else {
                $('artist_list').show();
                //no pages, just build 'em all
                var index = 0;
                $w('national domain').each( function(s){
                    search_data.get( s ).docs.each( function(d,idx){
                        var jsonLdPL = this.buildEvents( d, s, index );
                            jsonLdArr.push({"d": d, "purchaseLink" : jsonLdPL});
                        index++;
                    }.bind(this));
                    if( global.get('pages').types.include( s ) ) {
                        $('count_' + s).update( '(' + search_data.get(s).docs.length + ')' );
                    }
                }.bind(this));
                jQuery(document.body).trigger("searchresultsdisplay", [{"status": "success"}]);
            }
            noLocal();
            
            jQuery('#artist_list').queryAvailability({pageType : 'artist', containerElem : 'td'});
            
            jQuery(document.body).trigger("SEOpopulateJsonLD", [{"jsonLdArr": jsonLdArr}]); // event is used for SEO, tpl/js/json_ld.js, ECOMSTL-1748
            
        },
        buildCounts: function( current ) {
            var min = current.first().split(':');
            var max = current.last().split(':');
            min[1] = parseInt( min[1] ) + 1;
            max[1] = parseInt( max[1] ) + 1;
            if( min[0] == max[0] ) {
                $('count_' + min[0]).update( '(' + min[1] + ' - ' + max[1] + ' of ' + search_data.get( min[0] ).numFound + ')' );
            }
            else {
                var tmp_h = $H();
                var splitted,
                    val_array,
                    key,
                    val,
                    i;
                for (i = 0 ; i < current.length ; i++) {
                    splitted = current[i].split(':');
                    key = splitted[0];
                    val = splitted[1];
                    val_array = tmp_h.get(key);
                    if ( !val_array ) {
                        val_array = new Array();
                        tmp_h.set( key, val_array );
                    }
                    val_array.push( val.toString() );
                }
                tmp_h.keys().each( function(k){
                    val_array = tmp_h.get(k);
                    var d_length = search_data.get( k ).numFound;
                    if( val_array.length == d_length ) {
                        $('count_' + k).update( '(' + d_length + ')' );
                    }
                    else {
                        var min = parseInt( val_array.first() ) + 1;
                        var max = parseInt( val_array.last() ) + 1;
                        $('count_' + k).update( '(' + min + ' - ' + max + ' of ' + d_length + ')' );
                    }
                });
            }
        },
        buildEvents: function( d, type, idx ) {
            var r = new Element('tr');
            var mad = null;
            var jsonLdPL = "";
            var search_pages = global.get('pages');
            var absolute_index = idx + 1;
            if (search_pages) {
                absolute_index += search_pages.page_max * (search_pages.current - 1); // adding paginated counts
            } else {
                absolute_index = undefined;
            }
            $w('date venue act info').each( function(c) {
                var td = new Element('td');
                var span = new Element('span');
                var xtra = (type == 'local' && c != 'date')? '-hot' : '';
                var dataBlock = "divdateBlock-" + idx;
                var actDataBlock = "divActBlock-" + idx;
                var venueDataBlock = "divVenueBlock-" + idx;
                switch( c ) {
                    case 'date':

                        td.setAttribute('id',dataBlock);
                        td.setAttribute('scope','row');
                        td.addClassName('dateBlock');
                        var date = '';
                        if(d.TBA || d.PostProcessedData.Onsales.event_date.date_range || d.MDT) {                                date += '<img src="http://s1.ticketm.net/tm/en-ca/img/sys/1000/attraction/tba_date.gif" alt="Info" title="Info">';                        }
                        else {
                            date += '<div class="month"><span class="dots">&nbsp;</span> <abbr title="' + d.LocalEventMonthYear.replace(/\s\d*/g,'') +'">' + d.LocalEventShortMonth + ' </abbr> <span class="dots">&nbsp;</span></div><div class="date">' + d.LocalEventDay + '</div><div class="day"><abbr title="' + d.LocalEventWeekdayString +'">' + d.LocalEventShortWeekday  + '</abbr></div>';
                        }
                        td.innerHTML = date;
                        td.writeAttribute({ 'nowrap':'nowrap' });
                     break;
                    
                    
                    case 'venue':
                                                            
                        var is_cancelled = '';
                        var is_date_message = '';
                        if( d.TBA ) {
                            is_date_message += "Date TBA";
                        } else if( d.MDT ) {
                            is_date_message += "Multiple Dates and Times";
                        } else if( d.PostProcessedData.Onsales.event_date.date_range ) {
                            var tmp = d.PostProcessedData.Onsales.event_date.date_range;
                            if( tmp.start != tmp.end ) {
                                is_date_message += tmp.start.split('<br>')[0] + ' - ' + tmp.end.split('<br>')[0];
                            } else {
                                is_date_message += tmp.start;
                            }
                        }
                        if( d.Canceled ) {
                            is_cancelled = '<span class="errorMessage">Canceled</span><br/>';
                        }
                                            var venue_loc = states.mapToAbbrTag(d.VenueCityState, 'en-ca' );
                    
                        var is_date_message_display = is_date_message ? is_date_message : (Object.isUndefined(d.LocalEventDateDisplay.split('<br>')[1]) || !Object.isUndefined(d.EventType) && d.EventType == 1 ) ? '' : d.LocalEventDateDisplay.split('<br>')[1];
                        td.setAttribute('id', venueDataBlock);
                        td.innerHTML = '<div class="padH10">' + is_cancelled + '<a href="http://www.ticketmaster.ca' + d.VenueSEOLink + '" class="event">' + d.VenueName + ' </a>' + venue_loc + '<br>' + is_date_message_display + '</div>';
                        td.addClassName('venue');
                        
                    
                    break;
          
                    case 'act':
                    
                    
                        span.innerHTML = d.EventName;
                        td.addClassName('eventName');
                        span.addClassName('eventName');
                        var multi_act = '';
                            if(isMultiActEvent(d)) {
                                if(!mad) mad = new MultiActDisplay("artist", "875503", absolute_index);
                                multi_act = mad.createPlaceHolder('td.eventName', 'span');
                            }
                        td.appendChild(span);
                        td.setAttribute('id', actDataBlock);
                            td.innerHTML += '<br>' +  multi_act;
                        
                        break;
                                                            
                    default:
                        var link = purchaseLink({ event : { event_id : d.EventId, event_seo_link : d.EventSEOName, system_url : d.PostProcessedData.system_url, system_url_unencoded : d.SystemURL, link_text : d.PostProcessedData.PollingLinkText, link_status : d.PostProcessedData.PollingLinkStatus, event_source: d.EventSource }, artist_id : d.AttractionId.first(), major_id : d.MajorGenreId, minor_id : d.MinorGenreId, link_class : 'highlight', purchase_domain: d.PurchaseDomain, page_type : 'artist', onsale : d.PostProcessedData.Onsales, venue_id : d.VenueId, PR : {event_id : d.EventId, artist_id : d.AttractionId.first(), artist_name : d.EventName }, 'aria': {describedby:[dataBlock, actDataBlock, venueDataBlock].join(' ')} });
                        td.innerHTML = link;
                        td.addClassName('findTix');
                        jsonLdPL = link;
                }

                r.appendChild( td );
            });
            $('tbl_' + type).appendChild( r );
            ADP_eventItem_surfaceWithOmniture(d, type, idx);
            $('loading').hide();
            
            var plEventId = d.EventId;
            var tID = jQuery('#pl_' + plEventId);
            if((jQuery(tID).length > 0 && (d.OnsaleOn && typeof d.OnsaleOn === 'string')) && !( d.TBA || d.Canceled )){
                jQuery(tID).data({'availability': d, 'brandToken': ''});
            }
             
            if($('hdr_' + type)) $('hdr_' + type).show();
            if($('th_' + type)) $('th_' + type).show();
            if($('tbl_' + type)) $('tbl_' + type).show();
            if($('spc_' + type)) $('spc_' + type).show();
            if (mad) mad.generateEventDetail(d, type);
        return jsonLdPL;
        }
    });

    var ADP_eventItem_surfaceWithOmniture = function (data, type, index) {
        var search_pages = global.get('pages');
        var absolute_index = index + 1;
        if (search_pages) {
            absolute_index += search_pages.page_max * (search_pages.current - 1); // adding paginated counts
        } else {
            absolute_index = undefined;
        }
        var omniture_type;
        switch (type) {
            case 'local':
                omniture_type = 'Local';
                break;
            case 'national':
                omniture_type = 'National';
                break;
            case 'domain':
                omniture_type = 'International';
                break;
            default:
                omniture_type = 'Unrecognized';
                break;
        }

        /* surface venue */
        var venue_link = jQuery('#divVenueBlock-' + index + ' .event');
        if (venue_link.length) {
            var venue_clickListener = function (event) {
                var prop40_value = 'Venue_Name_ADP_' + omniture_type + '_' + absolute_index;
                tm_omn.prop40 = 'TM_CA: ' + prop40_value;
                tm_omn.eVar17 = tm_omn.prop21 = tm_omni_temp.get('omnAID');
                tm_omn.linkTrackVars = 'prop21,prop40,eVar17';
                tm_omn.linkTrackEvents = '';
                /* prop14 workaround to get rid of event27 in search tracking click calls */
                var temp_prop14 = tm_omn.prop14;
                tm_omn.prop14 = undefined;
                tm_omn.tl(true, 'o', 'artist_events_list_venue_click');
                tm_omn.prop14 = temp_prop14;
            };
            venue_link.bind('click', venue_clickListener);
        }

        /* surface CTA */
        var CTA_link = jQuery('#pl_' + data.EventId);
        if (CTA_link.length) {
            var CTA_clickListener = function (event) {
                var is_moreinfo = !!( +jQuery(event.currentTarget).attr('data-ismoreinfo') );
                var prop40_value = (is_moreinfo ? 'More_Info_ADP_' : 'Find_Tickets_ADP_') + omniture_type + '_' + absolute_index;
                tm_omn.prop40 = 'TM_CA: ' + prop40_value;
                tm_omn.eVar17 = tm_omn.prop21 = tm_omni_temp.get('omnAID');
                tm_omn.linkTrackVars = 'prop21,prop40,eVar17';
                tm_omn.linkTrackEvents = '';
                /* prop14 workaround to get rid of event27 in search tracking click calls */
                var temp_prop14 = tm_omn.prop14;
                tm_omn.prop14 = undefined;
                tm_omn.tl(true, 'o', 'artist_events_list_CTA_click');
                tm_omn.prop14 = temp_prop14;
            };
            CTA_link.bind('click', CTA_clickListener);
        }

        /* preventing cross-links: clearing references */
        data = null;
        search_pages = null;
        venue_link = null;
        CTA_link = null;

    };

    var SearchPages = Class.create({
        initialize: function() {
            this.current = 1;
            this.prev = 0;
            this.next = 2;
            this.stack = $A();
            this.types = $A();
            this.total_docs = search_data.get('total');
            this.total_real_docs = search_data.get('total_docs');
            this.page_max = global.get('page_max');
            this.total_pages = Math.ceil( this.total_docs / this.page_max );

            if( this.total_pages > 1 ) {
                $w('national domain').each( function(d){
                    if( search_data.get(d).docs.length ) {
                        this.types.push( d );
                    }
                    for( i = 0 ; i < search_data.get(d).numFound ; i++ ) {
                        this.stack.push( d + ':' + i );
                    }
                }.bind(this));
                this.stack = this.stack.eachSlice( this.page_max );
                this.stack.splice(0,0,undefined);
                this.drawPageNav();
            }
            else {
                $w('national domain').each( function(d){
                    if( search_data.get(d).docs.length ) {
                        this.types.push( d );
                    }
                }.bind(this));
                $('pages_count').update(' <strong>Results ' +  '1-' + this.total_docs + ' of ' + this.total_docs + '</strong>' );
            }
        },

        drawPageNav: function() {
            var output = '';                var prevB = '<a href="#artist_table_focus" id="prevPage" onclick="prevPage();"><img src="http://s1.ticketm.net/tm/en-ca/img/sys/1000/attraction/prev.gif" border="0" alt="previous page" /></a>&nbsp;&nbsp;';
                var nextB = '&nbsp;&nbsp;<a href="#artist_table_focus" id="nextPage" onclick="nextPage();"><img src="http://s1.ticketm.net/tm/en-ca/img/sys/1000/attraction/next.gif" border="0" alt="next page" /></a>';
            output += '<strong>Results: ';
            if( this.prev > 0 ) {
                output += prevB;
            }
            output += ((this.current - 1) * this.page_max + 1) + ' - ';
            if( this.current != this.total_pages ) {
                output += (this.page_max * this.current);
            }
            else {
                output += this.total_docs;
            }
            output += ' of ' + this.total_docs + '</strong>';
            if( this.next <= this.total_pages ) {
                output += nextB;
            }
            $('pages_count').update( output );
        },

        nextPage: function() {
            if( this.next <= this.total_pages ) {
                this.prev = this.current;
                this.current = this.next;
                this.next++;
                omniTracking.navigation_link( 'Artist_Pagination', false )
                return true;
            }
            else {
                return false;
            }
        },
        prevPage: function() {
            if( this.prev > 0 ) {
                this.prev--;
                this.current--;
                this.next--;
                omniTracking.navigation_link( 'Artist_Pagination', false )
                return true;
            }
            else {
                return false;
            }
        },
        xPage: function( pos ) {
            omniTracking.navigation_link( 'Artist_Pagination', false );
            this.current = pos;
            this.prev = pos - 1;
            this.next = pos + 1;
            return true;
        }
    });

    var LightBox = Class.create({
        initialize: function() {
            this.background_div = arguments[0];
            this.content_div = arguments[1];
            this.viewport = document.viewport.getDimensions();
            this.content_div_size = $(this.content_div).getDimensions();
            this.scroll_x = isNaN( parseInt(window.scrollX) ) ? parseInt(document.documentElement.scrollLeft) : parseInt(window.scrollX);
            this.scroll_y = isNaN( parseInt(window.scrollY) ) ? parseInt(document.documentElement.scrollTop) : parseInt(window.scrollY);
            this.page_dimensions = $('body').getDimensions();
            this.content_top = ( ( (this.viewport.height - this.content_div_size.height) / 2 ) ) + this.scroll_y;
            this.content_left = ( (this.viewport.width - this.content_div_size.width) / 2 ) + this.scroll_x;
            
            if( this.content_div_size.height >= this.viewport.height ) {
                this.content_top = 15;
            }
            
            if( this.content_div_size.width >= this.viewport.width ) {
                this.content_left = 15;
            }
        },
        showContent: function() {
            var m_left = $(this.content_div).getStyle('margin-left') ? $(this.content_div).getStyle('margin-left') : 0;
            var p_left = $(this.content_div).getStyle('padding-left') ? $(this.content_div).getStyle('padding-left') : 0;
            var m_top = $(this.content_div).getStyle('margin-top') ? $(this.content_div).getStyle('margin-top') : 0;
            var p_top = $(this.content_div).getStyle('padding-top') ? $(this.content_div).getStyle('padding-top') : 0;
            this.padding_left = parseInt( m_left ) + parseInt( p_left );
            this.padding_top = parseInt( m_top ) + parseInt( p_top );
            
            this.content_top = this.content_top - this.padding_top;
            this.content_left = this.content_left - this.padding_left;

            $(this.background_div).setStyle({ height: this.page_dimensions.height + 'px', width: this.page_dimensions.width + 'px'});
            $(this.content_div).setStyle({ top : this.content_top + 'px', left: this.content_left + 'px' });
            $(this.background_div,this.content_div).invoke('show');
        },
        hideContent: function() {
            $(this.background_div,this.content_div).invoke('hide');
        },
        reCenter: function() {
            var content_div_size = $( this.content_div ).getDimensions();
            var viewport = document.viewport.getDimensions();
            var content_top = ( (viewport.height - content_div_size.height) / 2 ) + this.scroll_y;
            var content_left = ( (viewport.width - content_div_size.width) / 2 ) + this.scroll_x;
                this.content_top = content_top;
                this.content_left = content_left;
        }
    });

    function nextPage() {
        if( global.get('pages').nextPage() ) {
            TM.MetricsCollection.timings.facade('startTimer', {
                    'name': 'searchResultsPagination_next',
                   'mtype': 'web.page.cs_function_execution.timer.millis'
            });
            
            new EventList( global.get('pages') ).drawEvents();
            global.get('pages').drawPageNav();
            
            TM.MetricsCollection.timings.facade('endTimer', {
                    'name': 'searchResultsPagination_next'
            });
        }
    }
    function prevPage() {
        if( global.get('pages').prevPage() ) {
            TM.MetricsCollection.timings.facade('startTimer', {
                    'name': 'searchResultsPagination_prev',
                   'mtype': 'web.page.cs_function_execution.timer.millis'
            });
            
            new EventList( global.get('pages') ).drawEvents();
            global.get('pages').drawPageNav();
            
            TM.MetricsCollection.timings.facade('endTimer', {
                'name': 'searchResultsPagination_prev'
            });
        }
    }
    function xPage( p ) {
        if( global.get('pages').xPage(p) ) {
            TM.MetricsCollection.timings.facade('startTimer', {
                        'name': 'searchResultsPagination_xpage',
                        'mtype': 'web.page.cs_function_execution.timer.millis'
            });
            
            new EventList( global.get('pages') ).drawEvents();
            global.get('pages').drawPageNav();
            
            TM.MetricsCollection.timings.facade('endTimer', {
                        'name': 'searchResultsPagination_xpage'
            });
        }
    }
    function formatDate( dateVal ) {
        var tmp = dateVal.split('/');
        return tmp[2] + '-' + tmp[0] + '-' + tmp[1];
    }
    function noLocal() {
        if( false && global.get('pages').current == 1 ) {
            if( !global.get('pages').types.include('local') ) {
                $('hdr_local').show();
                $('no_local_msg').show();
                $('count_local').update( '(0)' );
            }
        }
    }
    var sport = $H({ 8 : 1, 11 : 1, 7 : 1, 10 : 1, 9 : 1 });
    var catname = $H({ 27 : 1, 25 : 1, 203 : 1, 33 : 1, 204 : 1, 28 : 1, 206 : 1, 205 : 1, 30 : 1, 31 : 1 });
    var date_string_format = '%m/%d/%Y';


var check_resalePartnerURL;
(function () {
    var resale_disclaimer_config = { partners: {"TICKETEXCHANGE":{"hosts":["ticketexchange.com","www.ticketexchange.com","ticketexchangebyticketmaster.com","www.ticketexchangebyticketmaster.com","nflticketexchange.com","www.nflticketexchange.com"]},"TICKETSNOW":{"hosts":["ticketsnow.com","www.ticketsnow.com"]}} };
    check_resalePartnerURL = function (url) {
        if ( !resale_disclaimer_config.partners || !url || typeof url !== 'string' ) {
            return false;
        }
        var result = __GLOBALS.util.parseURI(url);
        if (!result || !result.host) {
            return false;
        }
        var result_host_lowercase = result.host.replace(/\s*$/, '').toLowerCase();
        var i,
            key,
            values;
        for (key in resale_disclaimer_config.partners) {
            values = resale_disclaimer_config.partners[key].hosts;
            if (!values) {
                continue;
            }
            for (i = 0 ; i < values.length ; i++) {
                if (values[i].toLowerCase() === result_host_lowercase) {
                    return true;
                }
            }
        }
        return false;
    };
})();

function genProps_purchaseLink (dObj) {
    var just_href,
        just_onclick,
        just_target;

    var current_domain = 'ca';

    var brand_id = dObj.brand_id || '';
    var artist_id = dObj.artist_id || '';
    var venue_id = dObj.venue_id || '';
    var minor_cat_id = dObj.minor_id || '';
    var major_cat_id = dObj.major_id || '';
    var p_did = dObj.promo_did ? '&did=' + dObj.promo_did : '';

    var brand_link = '';
    var tm_link = '';

    var i;

    

    if (!dObj.link_name) {
        if (dObj.page_type == 'microsite') {
            var micro_ac_link = '';
            var ms_page_name = '';
            
            if (dObj.pagename) {
                ms_page_name = dObj.pagename;
            } else {
                ms_page_name = 'artist';
            }
            
            tm_link = '&tm_link=ms__event_'+ ms_page_name + micro_ac_link;
        }

        if (dObj.page_type == 'amex') {
            if (dObj.event.event_type == 'ES') {
                tm_link = '&tm_link=amex_PrefSeating_Event';
            } else {
                tm_link = '&tm_link=amex_Presale_Event';
            }
        } else if (dObj.page_type != 'microsite') {
            if (dObj.onsale.onsale_status == 1) {
                if (dObj.tm_link) {
                    tm_link = "&tm_link=" + dObj.tm_link.find_tickets;
                }
            } else if ( dObj.onsale.onsale_status == 2 || dObj.onsale.onsale_status == 3 ) {
                if (dObj.tm_link) {
                    tm_link = "&tm_link=" + dObj.tm_link.more_info;
                }
            }
        }
    }

    if (brand_id && brand_id == 'uk_solt') {
        just_href = 'http://www2.ticketmaster.co.uk/cgi/asp_events/byid_redirect.asp?event_id=' + dObj.event.event_id + '&brand=uk_solt' + tm_link;
        just_onclick = '';
        just_target = '';    } else if (dObj.event.event_source == 'jetson') {
        just_href = 'http://www1.ticketmaster.com/event/' + dObj.event.event_id;
        just_onclick = '';
        just_target = '';    } else if (dObj.event.system_url) {
        var valid_partner = false;
        var q_params = tm_link;
        if (dObj.purchase_domain) {
            if (brand_link || p_did) {
                q_params += '&' + brand_link + p_did;
            }
            valid_partner = true;
        } else {
            var url = dObj.event.system_url_unencoded.toLowerCase();
            if (url) {
                var queue;
                if (current_domain == 'au') {
                    queue = ['ticketing.ticketmaster.com.au'];
                } else if (current_domain == 'us') {
                    queue = ['ticketweb'];
                } else {
                    queue = tm_omni_temp.get(current_domain + '_h');
                }
                if (queue) {
                    for (i = 0 ; i < queue.length ; i++) {
                        if (url.indexOf(queue[i]) !== -1) {
                            valid_partner = true;
                            break;
                        }
                    }
                }
            }
        }

        var pr_postpend = '';
        if (dObj.PR) {
            pr_postpend = "&eventid=" + dObj.PR.event_id + "&artistid=" + dObj.PR.artist_id + "&artistname=" + dObj.PR.artist_name;
        }            var pl_list,
                pl_item,
                crosssite_var,
                query_params;
            pl_list = ['wt.mc_id', 'CAMEFROM', 'ac_link', 'merchclick'];
            query_params = __GLOBALS.util.parseAndDecodeURIQuery( location.search.substr(1) );
            for (i = 0 ; i < pl_list.length ; i++) {
                pl_item = pl_list[i];
                if (dObj.page_type != 'microsite' || pl_item != 'ac_link') {
                    crosssite_var = query_params[pl_item] ? query_params[pl_item] : GetCookie(pl_item);
                    if (crosssite_var) {
                        pr_postpend += "&" + (pl_item == 'wt.mc_id' ? 'cid' : pl_item) + "=" + crosssite_var;
                    }
                }
            }
        if (valid_partner) {
            pr_postpend += "&crosssite=TM_CA:" + artist_id + ":" + venue_id;
        }
        just_href = 'http://www.ticketmaster.ca/partner_redirect?v=' + encodeURIComponent( dObj.event.system_url ) + q_params + pr_postpend;
        just_onclick = 'window.open(this.href, this.target); return false;';
        just_target = '_blank';
    } else if (dObj.venue_artist) {
        just_href = 'http://www.ticketmaster.ca/venueartist/' + dObj.venue_artist.url + '?artistid=' + artist_id + '&minorcatid=' + minor_cat_id + brand_link + '&date=' + dObj.venue_artist.date + tm_link;
        just_onclick = '';
        just_target = '';
    } else {
        just_href = 'http://www.ticketmaster.ca/' + dObj.event.event_seo_link + '/event/' + dObj.event.event_id + '?artistid=' + artist_id + '&majorcatid=' + major_cat_id + '&minorcatid=' + minor_cat_id + brand_link + p_did + tm_link;
        just_onclick = '';
        just_target = '';
    }

    if (dObj.link_utm_postfix) {
        just_href += dObj.link_utm_postfix + '&has_utm=1';
    }

    return { href:just_href ,onclick:just_onclick, target:just_target };
};

function purchaseLink( dObj ) {
    var linkProps = genProps_purchaseLink(dObj);
    var link_href = linkProps.href ? ' href="' + __GLOBALS.util.htmlEscape(linkProps.href) + '"' : '';
    var link_target = linkProps.target ? ' target="' + linkProps.target + '"' : '';
    var link_onclick = linkProps.onclick ? ' onclick="' + linkProps.onclick + '"' : '';

    var i;
    var the_link = '';
    var link_name = dObj.link_name;
    var action_is_more_info = false;
    var link_class = dObj.link_class || '';
    var link_suffix = "";
    var link_subhead = [];
    var use_sub = false;
    var event_text = '';
    var margin_class = '';
    var margin_applied = false;

    var brand_id = dObj.brand_id || '';
    var onsales;

    var rich_snippets_itemprop = dObj.itemprop || '';
    var ariatxt = dObj.aria && dObj.aria.describedby ? ' aria-describedby="' +dObj.aria.describedby+ '" ' : '';

    

    var org_hash = {
        'other' : {
             org_id : 14,
            hop_txt : 'on Partner Site'
        },
    12 : {
             org_id : 11,
            hop_txt : 'on Live Nation'
        },
    1 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    2 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    3 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    4 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    5 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    6 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    7 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    8 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    9 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    10 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        },
    11 : {
             org_id : 12,
            hop_txt : 'on Ticketmaster'
        }
    
    };

    if ( !link_name ) {
        if (dObj.calendar) {
            if (dObj.calendar.mtd_tba) {
                link_suffix = '&nbsp;»';
                link_class = 'highlight';
            } else {
                link_suffix = "&nbsp;»";
                link_class = '';
            }
        }
        if (dObj.page_type == 'artist' || dObj.page_type == 'amex' || dObj.page_type == 'member') {
            link_suffix = '&nbsp;»';
        }
        if (dObj.page_type == 'microsite') {
            link_suffix = '&nbsp;»';
        }
        if (dObj.page_type == 'browse') {
            link_class = 'more';
        } else if ( link_class == '' ) {
            link_class = 'findTickets';
        }

        if (dObj.page_type == 'member') {
            link_suffix = '&nbsp;»';
        }
            link_suffix = '';                    var tu_findTickets = "See Tickets";
        if (dObj.page_type == 'amex') {
            if (dObj.event.event_type == 'ES') {
                link_name = tu_findTickets + link_suffix;
                action_is_more_info = false;
            } else {
                onsales = dObj.onsale.presales[0];
                if (dObj.onsale.presale_status == '2') {
                    link_name = "More Info" + link_suffix;
                    action_is_more_info = true;
                    link_subhead.push('presale begins:<br />' + onsales.interval.start);
                } else if (dObj.onsale.presale_status == '1') {
                    link_name = tu_findTickets + link_suffix;
                    action_is_more_info = false;
                    link_subhead.push('presale ends:<br />' + onsales.interval.end);
                }
            }
        } else if (dObj.page_type == 'microsite') {
            if (dObj.onsale.onsale_status == 1) {
                link_name = tu_findTickets + link_suffix;
                action_is_more_info = false;
                onsales = dObj.onsale.onsales[0];
                if (onsales && onsales.onsale_type == "2") {
                    if (dObj.mask_presale_status == 'PRESALE_FUTURE') {
                        if (dObj.mask_presale_on) {
                            link_name = "More Info" + link_suffix;
                            action_is_more_info = true;
                            link_subhead.push('presale begins:<br />' + dObj.mask_presale_on);
                        }
                    } else {
                        if (dObj.mask_presale_off) {
                            link_subhead.push('presale ends:<br />' + dObj.mask_presale_off);
                        }
                    }
                }
            } else if (dObj.onsale.onsale_status == 2) {
                link_name = "More Info" + link_suffix;
                action_is_more_info = true;
                onsales = dObj.onsale.onsales[0];
                if (onsales && onsales.onsale_type == "2") {
                    if (dObj.mask_presale_on) {
                        link_subhead.push('presale begins:<br />' + dObj.mask_presale_on);
                    }
                }
                if ( !onsales || onsales.suppress ) {
                    link_subhead.push('currently not on sale');
                }
            } else if (dObj.onsale.onsale_status == 3) {
                link_name = "More Info" + link_suffix;
                action_is_more_info = true;
                link_subhead.push('currently not on sale');
            }
        } else {
            if (dObj.onsale.onsale_status == 1) {
                link_name = tu_findTickets + link_suffix;
                action_is_more_info = false;
                
                if (dObj.purchase_domain == '12' && dObj.page_type == 'member') {
                    event_text = '<strong></strong>';
                }
                
            } else if (dObj.onsale.onsale_status == 2) {
                link_name = "More Info" + link_suffix;
                action_is_more_info = true;
                use_sub = true;
            } else if (dObj.onsale.onsale_status == 3) {
                link_name = "More Info" + link_suffix;
                action_is_more_info = true;
                link_subhead.push('currently not on sale');
            }
        }
    }
    if (typeof dObj.action_is_more_info !== 'undefined') {
        action_is_more_info = dObj.action_is_more_info;
    }

    
        
        link_class += " button button-tertiary flat";
        margin_class = "mgTop5";
        
    

    if (brand_id && brand_id == 'uk_solt') {
        the_link = '<a' + link_href + link_target + link_onclick + ' class="'+ link_class + '" id="pl_' + dObj.event.event_id + '"' + rich_snippets_itemprop + ariatxt + ' data-ismoreinfo="' + (action_is_more_info ? 1 : 0) + '">' + link_name + '</a>';
    } else if (dObj.event.system_url) {
        var disp_hop_text = '';
        var is_resalePartner = check_resalePartnerURL( dObj.event.system_url_unencoded );
        if( dObj.purchase_domain ) {
            if (is_resalePartner) {
                
                disp_hop_text = '<div class="' + margin_class + '"><span class="inline_block" style="max-width:100px;">Resale Tickets on Partner Site</span></div>';
                
            } else {
                disp_hop_text = '<div class="' + margin_class + '">' + org_hash[ dObj.purchase_domain ].hop_txt + '</div>';
            }
            margin_applied = true;
        } else {
            if (is_resalePartner) {
                
                disp_hop_text = '<div class="' + margin_class + '"><span class="inline_block" style="max-width:100px;">Resale Tickets on Partner Site</span></div>';
                
            } else {
                if (dObj.event.link_status == '1') {
                    disp_hop_text = '<div class="' + margin_class + '">' + dObj.event.link_text + '</div>';
                } else {
                    disp_hop_text = '<div class="' + margin_class + '">' + org_hash[ 'other' ].hop_txt + '</div>';
                }
            }
            margin_applied = true;
            if ( dObj.event.link_status == '2' ) {
                disp_hop_text = '';
                margin_applied = false;
            }

            if( dObj.event.system_url_unencoded ) {
                tm_omni_temp.set('au_h',['ticketing.ticketmaster.com.au']);
                tm_omni_temp.set('us_h',['ticketweb']);
            }
        }
        the_link = '<a' + link_href + link_target + link_onclick + ' id="pl_' + dObj.event.event_id + '" data-availability="' + dObj.event.event_id + '" class="' + link_class + '"' + rich_snippets_itemprop + ariatxt + ' data-ismoreinfo="' + (action_is_more_info ? 1 : 0) + '">' + link_name + '</a>' + disp_hop_text;
    }
    else if( dObj.venue_artist ) {
        the_link = '<a' + link_href + link_target + link_onclick + ' id="pl_' + dObj.event.event_id + '" data-availability="' + dObj.event.event_id + '" class="' + link_class + '"' + rich_snippets_itemprop + ariatxt + ' data-ismoreinfo="' + (action_is_more_info ? 1 : 0) + '">' + link_name + '</a>';
    } else {
        the_link = '<a' + link_href + link_target + link_onclick + ' id="pl_' + dObj.event.event_id + '" data-availability="' + dObj.event.event_id + '" class="' + link_class + '"' + rich_snippets_itemprop + ariatxt + ' data-ismoreinfo="' + (action_is_more_info ? 1 : 0) + '">' + link_name + '</a>';
        if (event_text != '') {
            the_link += '<div class="' + margin_class + '">' + event_text + '</div>';
            margin_applied = true;
        }
    }

    if (use_sub) {
        onsales = dObj.onsale.onsales[0];
        if (onsales && !onsales.suppress) {
            var tmp = '';
            if (onsales.onsale_type == "2") {
                if (dObj.page_type == 'member') {
                    tmp += '<strong><span class="hiLite">presale begins </span></strong>';
                } else {
                    tmp += "presale begins:";
                }
            } else if (onsales.onsale_type == "1") {
                if (dObj.page_type == 'member') {
                    tmp += '<strong><span class="hiLite">on sale </span></strong>';
                } else {
                    tmp += "on sale:";
                }
            }
            
            tmp += addAbbrToDOW(onsales.interval.start);
            link_subhead.push(tmp);
        } else {
            link_subhead.push('currently not on sale');
        }
    }

    for (i = 0 ; i < link_subhead.length ; i++) {
        if (i == 0 && !margin_applied) {
            the_link += '<div class="' + margin_class + '">' + link_subhead[i] + '</div>';
            margin_applied = true;
        } else {
            the_link += '<div>' + link_subhead[i] + '</div>';
        }
    }
    return the_link;
}
function addAbbrToDOW(date){
    var weekDays = $H({'Mon':'Monday',
                       'Tue':'Tuesday',
                       'Wed':'Wednesday',
                       'Thu':'Thursday',
                       'Fri':'Friday',
                       'Sat':'Saturday',
                       'Sun':'Sunday'});

            var seperator = ',';    
    var date_time = date.split(seperator);
    var dow = date_time.splice(0,1);
    date_time = date_time.join(seperator);

    var dow_long = weekDays.get(dow);
    if ( dow_long ) {
        return "<abbr title=" + dow_long + ">" + dow + "</abbr>" + seperator + date_time;
    }
    return date;
}


function buildSellButton(data){

    var btn = '';
    var button_state = data.Button_state || "hidden";
    var link_type = data.Flow_link ? data.Flow_link : "";
    
    var details = {
                    hidden: {href: {}, btnClass: "sell-button-hidden"}, 
                    disable: {href: {}, btnClass: "button-disabled button-secondary"}, 
                    enable: {href: {TM_flow: "http://resale.ticketmaster.com", TMR_flow: "http://anotherresale.ticketmaster.com"}, btnClass: "button-secondary"}
                    };

        btn = jQuery('<a>', {
                                    text: data.calendar_view ? 'Sell' :'Sell Tickets',
                                    href: link_type ? details[button_state].href[link_type] : "#",
                                    click: function(evt){
                                            if(button_state !== "enable"){
                                                evt.preventDefault();
                                            }
                                    },
                                    'class': details[button_state].btnClass,
                                    title: data.hover_text ? data.hover_text : ""                                   
                                });
        
    
    return btn
    
}



window.onload = function() {
    if (TM.Ads && typeof TM.Ads.iframeAssets != "undefined" && TM.Ads.iframeAssets.length > 0){
       jQuery.each(TM.Ads.iframeAssets, function(i,k){
           if( jQuery( k.name ).length > 0 && k.src ){
              if ((this.name) == "#edp_leaderboard"){
                  this.src = appendTransID(this.src, true);
              }
              ( function(o){
                   setTimeout( function() { 
                       jQuery( o.name ).attr("src", o.src ) 
                   } , 200 );
               }(k) )
           }
       })
    }
}






 

	.nomargin{
		margin: 0;
	}


                               .nomargin{
                                       margin: 0;
                               }
             
            var omn_homepage_link = function(property) {
		    var prop = 'TM_CA:' + property.toString();
                var custTrackHomepageLink = new omniCustomClick({
                        prop14 : prop,
                        eVar14 : prop
                    },
                    clickLink = prop,
                    newPage = true
                );
                custTrackHomepageLink.handleClick();
            };
        

Our Network

Live Nation
House of Blues
TicketWebAdmission Eventjoy
NFL Ticket Exchange
NBATickets.com
NHL Ticket Exchange 


Friends & Partners

Opens in a new window



We're Here to Help

Your Account
Transfer or Sell Tickets
Print Tickets
FAQs
Refunds and Exchanges
Get Help
Retail Outlets
Custom Tickets
Gift Cards
Accessibility


 Download our Apps


Download on the AppStore
Get it on Google play
Available at Amazon

  

 







 
By continuing past this page, you agree to our terms of use.
        
 


Who We Are
Blog
Privacy Policy
Work With Us
Across the Globe
Site Map
© 1999-2016 Ticketmaster. All rights reserved. 





jQuery(document).ready(function($) {

  var caretPos = $("#site-nav li:first-child").width() - 15;
     $("#site-nav .top-caret").css("left", caretPos);

     var MenuSiteNavNFB = function(opts)
     {
         var sn = Class.create(MenuSiteNavNFB.prototype);
         sn.options = {
             navContainer  : $('#site-header'),
             menuContainer : opts,
             parentMenu    : $(opts).find('[data-navmenu-parent]'),
             button        : $(opts).find('[data-navmenu-button]'),
             timer         : {subref : {}, ref : {}, num : 400, xnum : 1000},
             timeExtension : { location : true }
         };
         sn.keyPresses = {
             toggleKeyCodes : [39, 27, 37],
             selectKeyCodes : [38, 40]
         };
         var nC = sn.options.navContainer, mC = sn.options.menuContainer, tmr = sn.options.timer;
         /* create the handlers & class */
         sn.eventsSetup = function(){
           
             sn.options.button.bind('click', function(e) {
               e.stopPropagation();
               clearTimeout(tmr.ref);
                $(this).addClass('on').attr('aria-expanded', true);
                ('.dd-list',sn.options.parentMenu).not(':visible').toggle();
                sn.options.parentMenu.find(".dd-list:visible").toggle();
                sn.options.parentMenu.find('ul li:first > a').addClass('on').focus();
                if(!member_name){
                    sn.options.parentMenu.find('.padded-action a').focus();
                }
                sn.options.parentMenu.find('input[type=text]').focus();                
              });
              
              
              sn.options.button.bind('focus', function(e) {
                e.stopPropagation();
                clearTimeout(tmr.ref);
                sn.hideParentMenu();
              });
           
             sn.options.button.bind('focusin mouseenter',function(e) {
                 e.stopPropagation();
                 clearTimeout(tmr.ref);
                 tmr.ref = setTimeout(function(){
                      ('.dd-list',sn.options.parentMenu).not(':visible').toggle()
                      sn.options.parentMenu.find(".dd-list:visible").toggle();
                 }, tmr.num);
             $(mC).bind('mouseleave',function(event){
                     event.stopPropagation();
                     sn.hideParentMenu();
                 }).mouseenter(function(){
                     clearTimeout(tmr.ref);
                 })
             $(nC).find('a,button,input').not($(mC).find('*'))
                 .bind('focusin mouseenter',function(event){
                     sn.hideParentMenu(100);
                 });
                 sn.subMenuPrep();
             })
         };

         /* hide main dropdown & any sub/menus & class */
         sn.hideParentMenu = function(options,e){
             clearTimeout(tmr.ref);
             var options = options || false;
             var uniqueNum = options ? options : (sn.options.timeExtension[$(mC).attr('data-navmenu-control')] ? tmr.xnum : tmr.num);
             tmr.ref = setTimeout(function(){
                 sn.options.button.removeClass('on').attr('aria-expanded', false);
                 if(sn.options.parentMenu.attr("id")=="cat-options"){
                     $("#cat-options .dd-listener>a.on").removeClass("on");
                 }
                 $(mC).find('.dd-list:visible').toggle();
             }, uniqueNum);
         };

         /* bind any sub|child menus & class */
         sn.subMenuPrep = function(){
             subMenus = sn.options.parentMenu.find("ul").eq(0).children() || {};
            // Remove any current event handlers
            $(".dd-listener").find("a,input").unbind('keydown');
            $(subMenus).unbind();

            // Event for escape key
             $(".dd-listener").find("a,input").bind('keydown', function(e){
                if(e.which === 27) {
                  sn.hideParentMenu();
                  $(this).parents(".dd-listener").find(".nav-theme").focus();
                  return false;
                }
              });
             
             $.each(subMenus, function(){
                 // remove focus event. Tabing should not auto open submenu
                 $(this).bind('mouseover',function(event){
                     clearTimeout(tmr.ref);
                     event.stopPropagation();
                     sn.options.button.addClass('on');
                     if($(this).closest(".dd-list").attr("id") == "cat-options") {
                        $(".dd-listener >a.on").removeClass("on");
                        $(this).find(">a").addClass("on");
                     }
                     if(!$.isEmptyObject(tmr.subref)){
                         $.each(tmr.subref, function (idx, val) { 
                             clearTimeout(val); });
                     }
                     var that = this;
                     tmr.subref.one = setTimeout(function(){ 
                         subMenus.find(".dd-list:visible").not($(that).find('div.dd-list')).toggle();
                         $(that).find('.dd-list:hidden').toggle() 
                      }, tmr.num);
                });

                // Keyboard controls
                $(this).bind('keydown', function(event) {
                  var keyCode = event.which;
                  // Open / Close menu
                  if(sn.keyPresses.toggleKeyCodes.indexOf(keyCode) != -1) {
                    event.preventDefault();
                    sn.toggleMenu(event, keyCode);
                  }
                  // Traverse menu
                  if(sn.keyPresses.selectKeyCodes.indexOf(keyCode) != -1) {
                    event.preventDefault();
                    sn.selectMenu($(event.target), keyCode);
                  }
                });
             });
         };
          // Control menu position with up / down arrow keys
          // Also determines if it needs to jump to other sub-cols navs
          sn.selectMenu = function($target, keyCode) {
            var $catListItems = $target.closest('ul').find('>li');
            var $element = $target.parent();
            var $isSubCol;
            $catListItems.find('>a')
              .attr('tabindex', -1)
              .removeClass('on');
            if(keyCode == 38) {
              if(!$element.is(':first-child')) {
                $element = $target.parent().prev();
              } else {
                $isSubCol = $target.closest('.sub-col').prev();
                $element = sn.selectSubMenu($element, $isSubCol);
                $element = $element.last();
              }
            }
            if(keyCode == 40) {
              if(!$element.is(':last-child')) {
                $element = $target.parent().next();
              } else {
                $isSubCol = $target.closest('.sub-col').next();
                $element = sn.selectSubMenu($element, $isSubCol);
                $element = $element.first();
              }
            }
            $element.find('>a')
              .attr('tabindex', 0)
              .addClass('on')
              .focus();
          }
          // Jump into next sub-col nav if available
          sn.selectSubMenu = function($element, $subCol) {
            if($subCol.find('ul').length) {
              $element = $subCol.find('ul li');  
            }
            return $element;
          }
          // Open / Close based on right / left arrow keys
          sn.toggleMenu = function(event, keyCode){
            var $element = $(event.target).parent();
            var $listItem = $(event.currentTarget);
            var $sublist = $element.find('.dd-list');
            if(keyCode == 39) {
              $sublist.attr({'aria-expanded': true}).show();
              $element.find('ul[role="menu"]:first li:first a').focus();
            }
            if(keyCode == 27 || keyCode == 37) {
              $(event.currentTarget).find('.dd-list').attr({'aria-expanded': false}).hide();
              $(event.target).removeClass('on');
              $listItem.find('a:first-child').focus();  
            }
          } 

         sn.init = function(){
             $.extend(sn.options, opts);
             sn.eventsSetup();
         };

         sn.init();
         return sn;
     };

     var activateMenusDisplay = $(document).find("[data-navmenu-control]").toArray().map(MenuSiteNavNFB);
})


var menu_data = $H();
var NavMenu = Class.create({
    initialize: function() {
        this.genres = {
            "10001" : {
                "root_name" : "All Music",
                "Alternative Rock" : "60",                    
                "Cabaret" : "764",                    
                "Classical" : "203",                    
                "Comedy" : "51",                    
                "Country and Folk" : "2",                    
                "Dance/Electronic" : "201",                    
                "Festivals" : "766",                    
                "Hard Rock/Metal" : "200",                    
                "Jazz and Blues" : "4",                    
                "Latin" : "40",                    
                "Miscellaneous" : "107",                    
                "New Age and Spiritual" : "50",                    
                "R&B/Urban Soul" : "202",                    
                "Rap and Hip-Hop" : "3",                    
                "Rock and Pop" : "1",                    
                "World Music" : "5",                    
                "More Concerts" : "52"                    
            },        
            "10004" : {
                "root_name" : "All Sports",
                "Baseball" : "10",                    
                "Basketball" : "7",                    
                "Boxing" : "33",                    
                "Bull Riding" : "61",                    
                "Competitions" : "206",                    
                "Curling" : "34",                    
                "Field Sports" : "205",                    
                "Football" : "8",                    
                "Golf" : "30",                    
                "Handball" : "765",                    
                "Hockey" : "9",                    
                "Lacrosse" : "35",                    
                "Mixed Martial Arts" : "830",                    
                "Motorsports" : "25",                    
                "Rodeo" : "28",                    
                "Skating" : "36",                    
                "Soccer" : "11",                    
                "Tennis" : "31",                    
                "Volleyball" : "204",                    
                "Wrestling" : "27",                    
                "More Sports" : "102"                    
            },        
            "10002" : {
                "root_name" : "All Arts",
                "Broadway" : "16",                    
                "Off-Broadway" : "17",                    
                "Ballet and Dance" : "12",                    
                "Classical" : "203",                    
                "Comedy" : "51",                    
                "Museums and Exhibits" : "14",                    
                "Musicals" : "207",                    
                "Opera" : "13",                    
                "Plays" : "32",                    
                "More Arts and Theatre" : "53"                    
            },        
            "10003" : {
                "root_name" : "All Family",
                "Children&#39;s Music and Theatre" : "23",                    
                "Circus" : "29",                    
                "Fairs and Festivals" : "54",                    
                "Family Attractions" : "19",                    
                "Ice Shows" : "22",                    
                "Magic Shows" : "209",                    
                "More Family" : "55"                    
            },        
            "10005" : {
                "root_name" : "All Miscellaneous",
                "Audio Tours" : "240",                    
                "Camping" : "211",                    
                "Casino" : "57",                    
                "Concession Vouchers" : "239",                    
                "Cruise and Sightseeing" : "106",                    
                "Dinner Package" : "238",                    
                "Donations" : "109",                    
                "Expo/Convention" : "105",                    
                "Gift Certificates" : "56",                    
                "Hotel Reservations" : "210",                    
                "Lecture/Seminar" : "104",                    
                "Merchandise" : "108",                    
                "Merchandise Vouchers" : "242",                    
                "Movies" : "59",                    
                "Parking" : "103",                    
                "Restaurants" : "58",                    
                "More Miscellaneous" : "0"                    
            }        
        };
        this.popular_events;
        this.popular_genres = {
            "10001" : {
                "popular" : {},
                "track" : "music",
                "section" : "concerts",
                "browse" : "music",
                "menu" : "music_menu",
                "textunit" : "Music"
            },
            "10002" : {
                "popular" : {},
                "track" : "arts",
                "section" : "arts-theatre",
                "browse" : "arts",
                "menu" : "arts_menu",
                "textunit" : "Arts & Theatre"
            },
            "10003" : {
                "popular" : {},
                "track" : "family",
                "section" : "family",
                "browse" : "family",
                "menu" : "family_menu",
                "textunit" : "Family"
            },
            "10004" : {
                "popular" : {},
                "track" : "sports",
                "section" : "sports",
                "browse" : "sports",
                "menu" : "sports_menu",
                "textunit" : "Sports"
            },
            "10005" : {
                "popular" : {},
                "track" : "specials",
                "section" : "miscellaneous",
                "browse" : "miscellaneous",
                "menu" : "especiales_menu",
                "textunit" : ""
            },
            "10012" : {
                "popular" : {},
                "track" : "specials",
                "section" : "toros",
                "browse" : "toros",
                "menu" : "toros_menu",
                "textunit" : "toros"
            }
        };
        this._get_data();
    },
    _get_data: function() {
        var dma_id;
            dma_id = 99999;
        getMenu('/json/search/genremenu', menu_data, 'popular_genres', { dma_id : dma_id, lang: 'en-ca' });
        getMenu('/json/menu', menu_data, 'popular_events', { domain_id: '2', brand: '' });
        new PeriodicalExecuter(
            function(pe) {
                if( menu_data.get('popular_genres') && menu_data.get('popular_events') ) {
                    pe.stop();
                    var genre_data = menu_data.get('popular_genres');
                    $H(this.popular_genres).values().each( function(g) {
                        var hist_list = g.browse.capitalize() + 'BrowseGenre';
                        if( genre_data[ hist_list ] ) {
                            g.popular = genre_data[ hist_list ].reject( function(n){ return Object.isNumber(n) });
                        }
                        else {
                            g.popular = null;
                        }
                    }.bind(this) );
                    this.popular_events = menu_data.get('popular_events');
                    this._build_menu();
                }
                else if( menu_data.get('popular_events') ) {
                    pe.stop();
                    this.popular_events = menu_data.get('popular_events');
                    this._build_menu();
                }
                else if( menu_data.get('popular_genres') ) {
                    pe.stop();
                    var genre_data = menu_data.get('popular_genres');
                    $H(this.popular_genres).values().each( function(g) {
                        var hist_list = g.browse.capitalize() + 'BrowseGenre';
                        if( genre_data[ hist_list ] ) {
                            g.popular = genre_data[ hist_list ].reject( function(n){ return Object.isNumber(n) });
                        }
                        else {
                            g.popular = null;
                        }
                    }.bind(this) );
                    this._build_menu();
                }
            }.bind(this), 1
        );
    },
     _build_menu: function () {
        $H(this.popular_genres).keys().each(
            function(cat) {
                var t_div, c_div, idRef = this.popular_genres[cat].track;
                if ( (this.popular_events && this.popular_events[cat] && Object.keys(this.popular_events[cat].links).length) || (this.popular_genres[cat].popular && this.popular_genres[cat].popular.length) ) {
                    var size = 0;
                    var add_class;
                    if( this.popular_events && this.popular_events[cat] && $H(this.popular_events[cat]).size() > 0 ) {
                        size += 1;
                    }
                    if( this.popular_genres[cat].popular && this.popular_genres[cat].popular.length ) {
                        size += 1;
                    }
                    var d_div = new Element('div', { 
                      'class': 'dd-list',
                      id: 'subNav_' + this.popular_genres[cat].menu                            ,'data-navmenu-parent': '1'                    });
                    if( this.popular_genres[cat].popular && this.popular_genres[cat].popular.length ) {
                        t_div = new Element('div' , { 'class': 'sub-col' } );
                        var cat_hdr_txt = 'Top Categories';
                        var cat_hdr = new Element('b', {'class':'heading'}).update( cat_hdr_txt );
                        t_div.appendChild( cat_hdr );
                        var g_ul = new Element('ul', {'role' : 'menu'});
                        this.popular_genres[cat].popular.each(
                            function(d, idx) {
                                idx += 1;
                                var cat_view = Object.isUndefined(this.genres[cat][d]) ? cat : this.genres[cat][d];
                                var li = new Element('li', {'role' : 'presentation'});
                                
                                if (typeof browseLinks == 'undefined') {
                                    var link = new Element('a', {
                                      href:'http://www.ticketmaster.ca/browse?category=' + cat_view + '&root=' + cat + '&rdc_select=n186&dma=&type=selected&tm_link=tm_' + idRef + '_header_l' + idx,
                                      'role' : 'menuitem',
                                      'tabindex' : '-1'
                                      });
                                } else {
                                    var link = new Element('a', {href: 'http://www.ticketmaster.ca' + browseLinks.composeUrl({
                                        categoryName: d,
                                        category: cat_view,
                                        root: cat,
                                        dma: "",
                                        queryParams: {
                                            rdc_select: "n186",
                                            type: "selected",
                                            tm_link: "tm_" + idRef + "_header_l" + idx
                                        }
                                      })
                                    });
                                    jQuery(link).attr({
                                      'role' : 'menuitem',
                                      'tabindex' : '-1'
                                    });
                                }

                                li.update(link);
                                link.update( d );
                                g_ul.appendChild( li );
                            }.bind(this)
                        );
                        var li = new Element('li', {'role': 'presentation'});                            var see_more = new Element('a', {
                              href:'http://www.ticketmaster.ca/section/' + this.popular_genres[cat].section + '?tm_link=tm_' + idRef + '_header_lmore', 'class': 'see_all', 'role' : 'menuitem', 'tabindex': '-1'}).update("All " + this.popular_genres[cat].textunit);                        li.appendChild( see_more );
                        g_ul.appendChild( li );
                        t_div.appendChild( g_ul );
                    }
                    if( this.popular_events && this.popular_events[cat] && Object.keys(this.popular_events[cat].links).length ) {
                        c_div = new Element('div' , { 'class': 'sub-col' } );
                        var show_hdr_txt = cat == '10004' ? "Popular Events" : "Popular Shows";
                        var show_hdr = new Element('b', {'role':'heading'}).update( show_hdr_txt );
                        c_div.appendChild( show_hdr );
                        var e_ul = new Element('ul', {'role' : 'menu'});                            if (Object.keys(this.popular_events[cat].links).length > 5) {
                                var e_ul2 = new Element('ul', {'role' : 'menu'});
                            }                        Object.keys(this.popular_events[cat].links).sort(_sortNumber).each(
                            function(d, idx) {
                                idx += 1;
                                var link_value = this.popular_events[cat].links[d].link;
                                if( !link_value.toString().startsWith('http') ) {
                                    link_value = 'http://www.ticketmaster.ca' + link_value;
                                }
                                var tm_link_value = 'tm' + '_' + idRef + '_header_r' + idx;

                                if( link_value.include('?') ) {
                                    link_value += '&tm_link=' + tm_link_value;
                                }
                                else {
                                    link_value += '?tm_link=' + tm_link_value;
                                }
                                var li = new Element('li', {'role' : 'presentation'});
                                var link = new Element('a', {
                                  href: link_value,
                                  'role' : 'menuitem',
                                  'tabindex' : '-1'
                                });
                                link.update( this.popular_events[cat].links[d].link_text.toString().strip() );
                                li.update(link);                                    if (idx > 5) { e_ul2.appendChild( li ); }
                                    else { e_ul.appendChild( li ); }                            }.bind(this)
                        );
                        c_div.appendChild( e_ul );                            if(e_ul2){ c_div.appendChild( e_ul2 ); }                    }                        if (cat == '10001') { // music cat only
                            var promo = new Element('div', { 
                              'class': 'promo-col'
                            });
                           promo.update('<a href="http://onenation.livenation.com/?tm_link=tm_LN_Content_topnav&mch_link=tm_LN_Content_topnav&ref=tm"  onclick="omniTracking.navigation_link(\'tm_LN_Content_topnav\', false, \'http://onenation.livenation.com/\');" target="_blank"><img src="http://s1.ticketm.net/tm/en-ca/img/sys/alpha/discovery/header/picsnvids_100x67.png" alt="Pics &amp; Videos" /></a><b class="heading">Pics & Videos</b><p>Check out your favourite artist’s <a href="http://onenation.livenation.com/?tm_link=tm_LN_Content_topnav&mch_link=tm_LN_Content_topnav&ref=tm" onclick="omniTracking.navigation_link(\'tm_LN_Content_topnav\', false, \'http://onenation.livenation.com/\')" target="_blank">pics & vids</a>.</p>');
                        }                    
                    if( size > 0 && $( idRef ) ) {
                        if(t_div){ d_div.appendChild( t_div ); }
                        if(c_div){ d_div.appendChild( c_div ); }                            if(promo){ d_div.appendChild( promo ); }                            var caret = new Element('div', { 
                              'class': 'top-caret'
                            });
                            d_div.appendChild( caret );                        $( idRef ).appendChild( d_div );
                        if(jQuery("#" + idRef).find("ul").length === 1){
                           jQuery("#" + idRef + " div:first" ).addClass('one-col');
                        };
                    }
                }
            }.bind(this)
        );
    }});
function makeNav() {
    new NavMenu();
}

function _sortNumber(a,b) {
     return a - b;
}

document.observe("dom:loaded",makeNav);


var browseLinks = (function() {
    var _self = {
        defaultLinkType: 'seo',
        excludedKeys: ['category', 'root', 'dma', 'dma_id'],
        sortKeys: false,
        sortKeysArr: ['category', 'root', 'dma', 'dma_id', 'area', 'rdc_select', 'rds_smonth', 'rdc_sday', 'rdc_syear', 'rdc_emonth', 'rdc_eday', 'rcd_eyear', 'telval', 'type']
    };
    _self.genres = {
        "10001" : {
            "root_name" : "Music",
            "cat_10001" : "All Music",
            "Music" : 10001,
            "All Music" : 10001,
                "Alternative Rock" : 60,
                "cat_60" : "Alternative Rock",            
                "Cabaret" : 764,
                "cat_764" : "Cabaret",            
                "Classical" : 203,
                "cat_203" : "Classical",            
                "Comedy" : 51,
                "cat_51" : "Comedy",            
                "Country and Folk" : 2,
                "cat_2" : "Country and Folk",            
                "Dance/Electronic" : 201,
                "cat_201" : "Dance/Electronic",            
                "Festivals" : 766,
                "cat_766" : "Festivals",            
                "Hard Rock/Metal" : 200,
                "cat_200" : "Hard Rock/Metal",            
                "Jazz and Blues" : 4,
                "cat_4" : "Jazz and Blues",            
                "Latin" : 40,
                "cat_40" : "Latin",            
                "Miscellaneous" : 107,
                "cat_107" : "Miscellaneous",            
                "New Age and Spiritual" : 50,
                "cat_50" : "New Age and Spiritual",            
                "R&B/Urban Soul" : 202,
                "cat_202" : "R&B/Urban Soul",            
                "Rap and Hip-Hop" : 3,
                "cat_3" : "Rap and Hip-Hop",            
                "Rock and Pop" : 1,
                "cat_1" : "Rock and Pop",            
                "World Music" : 5,
                "cat_5" : "World Music",            
                "More Concerts" : 52,
                "cat_52" : "More Concerts"            
        },    
        "10004" : {
            "root_name" : "Sports",
            "cat_10004" : "All Sports",
            "Sports" : 10004,
            "All Sports" : 10004,
                "Baseball" : 10,
                "cat_10" : "Baseball",            
                "Basketball" : 7,
                "cat_7" : "Basketball",            
                "Boxing" : 33,
                "cat_33" : "Boxing",            
                "Bull Riding" : 61,
                "cat_61" : "Bull Riding",            
                "Competitions" : 206,
                "cat_206" : "Competitions",            
                "Curling" : 34,
                "cat_34" : "Curling",            
                "Field Sports" : 205,
                "cat_205" : "Field Sports",            
                "Football" : 8,
                "cat_8" : "Football",            
                "Golf" : 30,
                "cat_30" : "Golf",            
                "Handball" : 765,
                "cat_765" : "Handball",            
                "Hockey" : 9,
                "cat_9" : "Hockey",            
                "Lacrosse" : 35,
                "cat_35" : "Lacrosse",            
                "Mixed Martial Arts" : 830,
                "cat_830" : "Mixed Martial Arts",            
                "Motorsports" : 25,
                "cat_25" : "Motorsports",            
                "Rodeo" : 28,
                "cat_28" : "Rodeo",            
                "Skating" : 36,
                "cat_36" : "Skating",            
                "Soccer" : 11,
                "cat_11" : "Soccer",            
                "Tennis" : 31,
                "cat_31" : "Tennis",            
                "Volleyball" : 204,
                "cat_204" : "Volleyball",            
                "Wrestling" : 27,
                "cat_27" : "Wrestling",            
                "More Sports" : 102,
                "cat_102" : "More Sports"            
        },    
        "10002" : {
            "root_name" : "Arts & Theatre",
            "cat_10002" : "All Arts",
            "Arts & Theatre" : 10002,
            "All Arts" : 10002,
                "Broadway" : 16,
                "cat_16" : "Broadway",            
                "Off-Broadway" : 17,
                "cat_17" : "Off-Broadway",            
                "Ballet and Dance" : 12,
                "cat_12" : "Ballet and Dance",            
                "Classical" : 203,
                "cat_203" : "Classical",            
                "Comedy" : 51,
                "cat_51" : "Comedy",            
                "Museums and Exhibits" : 14,
                "cat_14" : "Museums and Exhibits",            
                "Musicals" : 207,
                "cat_207" : "Musicals",            
                "Opera" : 13,
                "cat_13" : "Opera",            
                "Plays" : 32,
                "cat_32" : "Plays",            
                "More Arts and Theatre" : 53,
                "cat_53" : "More Arts and Theatre"            
        },    
        "10003" : {
            "root_name" : "Family",
            "cat_10003" : "All Family",
            "Family" : 10003,
            "All Family" : 10003,
                "Children's Music and Theatre" : 23,
                "cat_23" : "Children's Music and Theatre",            
                "Circus" : 29,
                "cat_29" : "Circus",            
                "Fairs and Festivals" : 54,
                "cat_54" : "Fairs and Festivals",            
                "Family Attractions" : 19,
                "cat_19" : "Family Attractions",            
                "Ice Shows" : 22,
                "cat_22" : "Ice Shows",            
                "Magic Shows" : 209,
                "cat_209" : "Magic Shows",            
                "More Family" : 55,
                "cat_55" : "More Family"            
        },    
        "10005" : {
            "root_name" : "Miscellaneous",
            "cat_10005" : "All Miscellaneous",
            "Miscellaneous" : 10005,
            "All Miscellaneous" : 10005,
                "Audio Tours" : 240,
                "cat_240" : "Audio Tours",            
                "Camping" : 211,
                "cat_211" : "Camping",            
                "Casino" : 57,
                "cat_57" : "Casino",            
                "Concession Vouchers" : 239,
                "cat_239" : "Concession Vouchers",            
                "Cruise and Sightseeing" : 106,
                "cat_106" : "Cruise and Sightseeing",            
                "Dinner Package" : 238,
                "cat_238" : "Dinner Package",            
                "Donations" : 109,
                "cat_109" : "Donations",            
                "Expo/Convention" : 105,
                "cat_105" : "Expo/Convention",            
                "Gift Certificates" : 56,
                "cat_56" : "Gift Certificates",            
                "Hotel Reservations" : 210,
                "cat_210" : "Hotel Reservations",            
                "Lecture/Seminar" : 104,
                "cat_104" : "Lecture/Seminar",            
                "Merchandise" : 108,
                "cat_108" : "Merchandise",            
                "Merchandise Vouchers" : 242,
                "cat_242" : "Merchandise Vouchers",            
                "Movies" : 59,
                "cat_59" : "Movies",            
                "Parking" : 103,
                "cat_103" : "Parking",            
                "Restaurants" : 58,
                "cat_58" : "Restaurants",            
                "More Miscellaneous" : 0,
                "cat_0" : "More Miscellaneous"            
        }    
    };

    return {
        /**
         * @param int dma
         * @return string
         * @todo redevelop
         */
        getDmaZoneName: function (dma) {
            return "Canada";
        },

        /**
         * @param int root
         * @param int category
         * @return string
         */
        getCategoryIdByName: function (root, name) {
            if (typeof _self.genres[root] == 'undefined') {
                return 0;
            }

            return _self.genres[root][name] || 0;
        },

        /**
         * @param int root
         * @param int category
         * @return string
         */
        getCategoryName: function (root, category) {
            if (typeof _self.genres[root] == 'undefined') {
                return '';
            }

            return _self.genres[root]['cat_' + category] || '';
        },

        /**
         * @param int root
         * @return string
         */
        getRootName: function (root) {
            return _self.genres[root] ? _self.genres[root]['root_name'] : '';
        },

        /**
         * Return urlified string
         *
         * @param string str
         * @return string suffix
         */
        transformUrlString: function (str, suffix) {
            var result = str.toLowerCase().replace(/^\s+|\s+$/g, '').replace(/&+/g, '-and-').replace(/\W+/g, '-');

            return result.length ? result + suffix : '';
        },

        /**
         * Compose seo link
         *
         * @param object obj
         * @param string linkType
         *
         * @return string
         */
        composeUrl: function (obj, linkType) {
            var result = '/browse', query;
            
            linkType = linkType || _self.defaultLinkType;
            
            obj.root = obj.root || 0;
            obj.rootName = obj.rootName || this.getRootName(obj.root);
            
            obj.category = obj.category || (obj.categoryName ? this.getCategoryIdByName(obj.root, obj.categoryName) : obj.root);
            obj.categoryName = obj.categoryName || this.getCategoryName(obj.root, obj.category);
            
            obj.dma = obj.dma || 0;
            obj.dmaName = obj.dmaName || this.getDmaZoneName(obj.dma);

            obj.queryParams = obj.queryParams || this.getQueryParams();
            
            if (linkType == 'seo') {
                if (obj.category) {
                    result += '/' + this.transformUrlString(obj.categoryName, '-') + 'catid-' + obj.category;
                }

                if (obj.root) {
                    result += '/' + this.transformUrlString(obj.rootName, '-') + 'rid-' + obj.root;
                
                    if (obj.dma) {
                        result += '/' + this.transformUrlString(obj.dmaName, '-') + 'dma-' + obj.dma;
                    }
                }
            } else {
                if (obj.category) {
                    obj.queryParams['category'] = obj.category;
                }
                
                if (obj.root) {
                    obj.queryParams['root'] = obj.root;
                }

                if (obj.dma) {
                    obj.queryParams['dma'] = obj.dma;
                }
            }

            query = $H(this.sortParameters(this.paramFilter(obj.queryParams, obj.excludeKeys || []))).toQueryString();
            return result + (query.length ? '?' + query : '');
        },

        /**
         * Compose URL and redirect to browse page
         *
         * @param object obj
         * @param string linkType
         */
        updateLocation: function (obj, linkType) {
            document.location = this.composeUrl(obj, linkType);
            return false;
        },

        /**
         * Sort query parameters
         *
         * @param object obj
         * @param array keys
         *
         * @return object
         */
        sortParameters: function (obj, keys) {
            var resultObj = {}, i = 0, l = 0;
            keys = keys || _self.sortKeysArr;
            l = keys.length;

            if (!_self.sortKeys || !l) {
                return obj;
            }

            for (; i < l; i++) {
                if (obj.hasOwnProperty(keys[i])) {
                    resultObj[keys[i]] = obj[keys[i]];
                }
            }

            return resultObj;
        },

        /**
         * Return current location path
         * Work only with /browse page
         *
         * @return object
         */
        getPathParams: function () {
            var path = location.pathname, result = {}, tmp;

            if (!/^\/browse/.test(path)) {
                return result;
            }

            tmp = path.match(/\/[\w-]*rid-([0-9]+)/);
            if (tmp && tmp.length) {
                result['root'] = tmp[1];
            }

            tmp = path.match(/\/[\w-]*catid-([0-9]+)/);
            if (tmp && tmp.length) {
                result['category'] = tmp[1];
            }

            tmp = path.match(/\/[\w-]*dma-([0-9]+)/);
            if (tmp && tmp.length) {
                result['dma'] = tmp[1];
            }

            return result;
        },

        /**
         * Return current query parameters
         *
         * @return object
         */
        getQueryParams: function () {
            return location.search ? document.URL.toQueryParams() : {};
        },

        /**
         * Clear query parameters
         *
         * @param object obj
         * @param array excludeKeys
         *
         * @return object
         */
        paramFilter: function (obj, excludeKeys) {
            var i;

            if (!excludeKeys || !excludeKeys.length) {
                excludeKeys = _self.excludedKeys;
            }

            i = excludeKeys.length;
            while (i--) {
                if (obj.hasOwnProperty(excludeKeys[i])) {
                    delete obj[excludeKeys[i]];
                }
            }

            return obj;
        }
    };
})();

/**
 * Transform form data to query params
 *
 * @param HTMLFormElement form
 * @return null redirect
 */
function submitBrowseForm(form) {
    var formData = jQuery(form).serializeArray(), object = {queryParams: {}};

    // Something Goes Wrong
    if (!formData || !formData.length) {
        return false;
    }

    formData.each(function (i) {
        if (i.name == 'category' || i.name == 'root' || i.name == 'dma') {
            object[i.name] = i.value;
        } else {
            object['queryParams'][i.name] = i.value;
        }
    });

    return browseLinks.updateLocation(object);
}


 
var omni_recognized;
var cookie_id = GetCookie("MID");
if ( cookie_id == null || cookie_id.length == 0 ) {
    omni_recognized = "unrecognized";
}
else {
    omni_recognized = "recognized";
}

tm_omn.campaign = calcCampaign();
tm_omn.pageName = "TM_CA: Artist: On Sale: List"; /* Page Name */


tm_omn.products = tm_omni_temp.get('omnEID') != '' ? ';' + tm_omni_temp.get('omnEID') : '';
    
        
    


tm_omn.events="";
tm_omn.event74 = "";
tm_omn.event75 = "";
tm_omn.channel = "TM_CA: Artist"; /* Page Type */
tm_omn.server = "";  /*  Server */
tm_omn.pageType = ""; /*  Pages Not Found */
tm_omn.prop1 = "TM_CA: Artist: On Sale";  /* Sub Page Type  */
tm_omn.prop2 = "TM_CA: Artist: Sports";  /* Level 1 */
tm_omn.prop3 = "TM_CA: Artist: Sports: Soccer";  /* Level 2 */
tm_omn.prop4 = "";  /* Previous Page Name      */
tm_omn.prop5 = "";  /* Internal Search Term    */
tm_omn.prop6 = "";  /* Total # of Search Results Returned */
tm_omn.prop7 = "";  /* Search Refinements      */tm_omn.prop8 = "";  /* Ticket Insurance        */
tm_omn.prop9 = "national_" + omni_recognized;  /* Navigation State        */
tm_omn.prop10 = "";  /* Flash Version   */
tm_omn.prop11 = "";  /* Set Location Value      */  tm_omn.prop12 = tm_omni_temp.get('prop12') ? tm_omni_temp.get('prop12') : '';  /* Modules Available       */tm_omn.prop13 = GetCookie('MID') ? "Recognized" : "Unrecognized";  /* Logged in status        */
tm_omn.prop14 = new $H( location.search.toQueryParams() ).get('tm_link'); /* Navigation Link */
tm_omn.prop15 = "en-ca";  /* Language        */
tm_omn.prop16 = "TM_CA: Artist: 875503: FIFA Women’s World Cup Canada 2015";  /* Page Name - Detailed  */
tm_omn.prop17 = "TM_CA";  /* which domain  */ 

/* These props are for Google reCaptcha, Solve Captcha and for Resale listings*/tm_omn.prop18 = "";
tm_omn.prop19 = "";
tm_omn.prop21 = "";

tm_omn.prop27 = GetCookie("BID") ? GetCookie("BID") : "";
tm_omn.prop28 = GetCookie("SID") ? GetCookie("SID") : "";
tm_omn.prop33 = "D=g";
tm_omn.prop44 = "";
tm_omn.prop46 = "";
tm_omn.prop65 = "";
tm_omn.eVar2 = "";  /* Level 1 */
tm_omn.eVar3 = "";  /* Level 2 */   
tm_omn.eVar7 = ""; /* Internal Search Term    */
tm_omn.eVar8 = tm_omni_temp.get('omnMID');  /* Entry Market    */
tm_omn.eVar9 = tm_omn.prop9;
tm_omn.eVar10 = tm_omni_temp.get('omnMID');  /* Merchandising Market    */  tm_omn.eVar12 = "";  /* Modules Available       */tm_omn.eVar13 = "";  /* Module clicked  */
tm_omn.eVar14 = "";  /* Navigation Link */
tm_omn.eVar15 = calc15();  /* Merchandising Link      */
tm_omn.eVar16 = tm_omni_temp.get('omnVID');  /* Venue ID */
tm_omn.eVar17 = "875503";  /* Artist ID  */
tm_omn.eVar18 = "";  /* Day of Week     */
tm_omn.eVar19 = "";  /* Time of Day     */
tm_omn.eVar20 = "";  /* Payment Methods */
tm_omn.eVar21 = "none";  /* Brand   */
tm_omn.eVar22 = "en-ca";  /* Language */ 
tm_omn.eVar23 = "";  /* EDP Type        */
tm_omn.eVar24 = "";  /* Checkout Type   */
tm_omn.eVar25 = "";  /* Promotion ID    */
tm_omn.eVar26 = "";  /* Visit Number    */
tm_omn.eVar27 = "";  /* Visit Referral Domain   */
tm_omn.eVar28 = "";  /* Original Referral Domain        */
tm_omn.eVar29 = "";  /* Entry Page Name */
tm_omn.eVar31 = "";  /* Delivery Methods */       
tm_omn.eVar32 = "";  /* BV rating       */
tm_omn.eVar33 = "";  /* Ticket Type     */
tm_omn.eVar34 = "";  /* Inventory Request Type */ 
tm_omn.eVar35 = "";  /* NTF Distribution        */
tm_omn.eVar36 = "";  /* Resale Posting ID or Order ID (same as Purchase ID) */
tm_omn.eVar37 = GetCookie("MID") ? GetCookie("MID") : "";  /* CustomerID      */
tm_omn.eVar38 = "TM_CA";
tm_omn.eVar40 = "";
tm_omn.eVar43 = calc43();
if ( Discrete.id ) {
    tm_omn.eVar49 = Discrete.id;
}


tm_omn.eVar50 = GetCookie("MID_MD5") ? GetCookie("MID_MD5") : "";  /* CustomerID MD5     */
tm_omn.eVar52 = calc52();
tm_omn.eVar53 = tm_omn.prop27;
tm_omn.eVar54 = tm_omn.prop28;
tm_omn.eVar59 = "D=g";
tm_omn.pageType = "";
tm_omn.purchaseID  = "";  /* Purchase ID     */
tm_omn.state = "";  /* User Billing State */     
tm_omn.zip = "";  /* User Billing ZIP       */ 
tm_omn.currencyCode = "";  /* Currency Code */  

if(tm_omn.prop14){
   tm_omn.prop14 = "TM_CA: " + tm_omn.prop14;
   }
if(tm_omni_temp.get('recentViewCarousel')){
  if(tm_omn.prop12){
     tm_omn.prop12 = tm_omn.prop12 + "," + tm_omni_temp.get('recentViewCarousel');
   }else{
     tm_omn.prop12 = tm_omni_temp.get('recentViewCarousel');
    }
}
    // Optimizely SiteCatalyst Integration
    window.optimizely = window.optimizely || [];
    window.optimizely.push(['activateSiteCatalyst', {'sVariable': tm_omn}]);


function initshare(){
    new PeriodicalExecuter(function(pe) {
         if( $('at_hover') ) {
            var shareDivs = $$('div[onclick*=addthis_sendto]');
                shareDivs = shareDivs.uniq();
             shareDivs.each( function(d){
                var attr =  d.readAttribute('onclick');
                  if(!attr.include('more')){
                    d.observe('click',function(){
                       omniTracking.trackomni_favoriteshare(['events','eVar17'],['event12',tm_omni_temp.get('omnAID')],'Share Event',d);
                       attr;
                     });
                  }
               });
         pe.stop();
         }
     }, 1);

}
function wt_stringscrape(passedValue, entryOutcome ){
var stringedData;
 try{
    passedValue = passedValue.stripScripts().stripTags().escapeHTML();
    passedValue = passedValue.empty() ? "null" : passedValue;
    passedValue = unescape(passedValue);

    tm_omn.prop11 = passedValue;

            //if prop14 has value scode populates event. override it.
                tm_omn.prop14 = "";
            var changeLocationClick = new omniCustomClick({
                    linkTrackVars: 'prop11',
                     prop11: tm_omn.prop11
                  },
                 clickLink = 'Change Location',
                   newPage = false
                );
            changeLocationClick.handleClick(changeLocationClick)
    }catch(err){
          
    }
}

            function omniTrack( tag ) {
                tm_omni_temp.set('override_prop4', tm_omn.pageName);
                tm_omni_temp.set('pagetype','search') ;
                new PeriodicalExecuter(function(pe) {
                    if(tm_omni_temp.get('filterComplete') || tag.include('Pagination') || tag.include('other_matches')) {
                       if(tm_omni_temp.get('search_results_total') == tm_omni_temp.get('totalDocs_pageload')){
                             if(tag.include('_Pagination')){
                                 $w('pageName prop16').each( function(cl){
                                    tm_omn[cl] = tm_omn[cl].gsub(/: (Filter|Pagination)/,"") + ": Pagination";
                                 });
                              }else{
                                   if(tag.include('_filter')){
                                       $w('pageName prop16').each( function(cl){
                                           tm_omn[cl] = tm_omn[cl].gsub(/: (Filter|Pagination)/,'');
                                           tm_omn[cl] = tm_omn[cl] + ": Filter";
                                        });
                                   }else{
                                       $w('pageName prop16').each( function(cl){
                                           tm_omn[cl] = tm_omn[cl].gsub(/: (Filter|Pagination)/,'');
                                        });
                                   }
                              }
                        }else{
                             var filt_pag = "";
                             $w('pageName prop16').each( function(cl){
                                tm_omn[cl] = tm_omn[cl].gsub(/: (Filter|Pagination)/,"");
                                  if(tag.include('_Pagination')){
                                    filt_pag = ": Pagination";
                                  }
                                tm_omn[cl] = tm_omn[cl] + ": Filter" + filt_pag;
                             });
                        }                      
                             $w('prop14 prop7 eVar14').each( function(cs){
                                tm_omn[cs] = "TM_CA: " + tag;
                             });
                            tm_omn.prop5 = "";
                            tm_omn.eVar7 = "";
                            tm_omn.prop4 = tm_omni_temp.get('override_prop4');
                            tm_omn.t();
                            pe.stop();
                            tm_omni_temp.set('firstFilter', '1')
                            tm_omni_temp.unset('filterComplete');
                      }
                   }, .25);
                 }


function calcCampaign(queryParams) {
  if(typeof queryParams === 'object' && queryParams !== null) {
		var q_p = queryParams;
	} 
	else {
		var q_p = location.search.toQueryParams();
    }

    if( q_p.SREF || q_p.fb_ref ) {
        var campaignsDoNotCut = [
            "P_HomePageModule_main",
            "P_MusicPageModule_main",
            "P_FamilyPageModule_main",
            "P_ArtsPageModule_main",
            "P_SportsPageModule_main",
            "P_SpecialsPageModule_main",
            "P_ArtistPageModule_main",
            "P_PurchasePageModule_main",
            "P_EventPageModule_main",
            "P_VenuePageModule_main"
        ];
        var doNotCutCampaign = Boolean(q_p.SREF && campaignsDoNotCut.indexOf(q_p.SREF) != -1);
        if(!doNotCutCampaign) {
            for(key in q_p) {
                q_p[key] = q_p[key].split("_")[0];
            }
        }

        var map = {
            "FBShare"                 : "SLfbk-001",
            "FBShareBuy"              : "SLfbk-002",
            "FBLike"                  : "SLfbk-003",
            "FBLikeURL"               : "SLfbk-004",
            "FBUnknown"               : "SLfbk-005",
            "FBKSharePurchISMnfss"    : "SLfbk-013",
            "FBKShareBuyPurchISMnfss" : "SLfbk-014",
            "FBKSharePurchISMftss"    : "SLfbk-015",
            "FBKShareBuyPurchISMftss" : "SLfbk-016",
            "FBKSharePurchISMftns"    : "SLfbk-017",
            "FBKShareBuyPurchISMftns" : "SLfbk-018",
            "FBKSharePurchISMnfns"    : "SLfbk-019",
            "FBKShareBuyPurchISMnfns" : "SLfbk-020",
            "FBKShareEdpISMnfss"      : "SLfbk-021",
            "FBKShareBuyEdpISMnfss"   : "SLfbk-022",
            "FBKShareEdpISMftss"      : "SLfbk-023",
            "FBKShareBuyEdpISMftss"   : "SLfbk-024",
            "FBKShareEdpISMftns"      : "SLfbk-025",
            "FBKShareBuyEdpISMftns"   : "SLfbk-026",
            "FBKShareEdpISMnfns"      : "SLfbk-027",
            "FBKShareBuyEdpISMnfns"   : "SLfbk-028",
            "FBKShareEdpSTagISMss"    : "SLfbk-029",
            "FBKShareBuyEdpSTagISMss" : "SLfbk-030",
            "FBKShareEdpSTagISMns"    : "SLfbk-031",
            "FBKShareBuyEdpSTagISMns" : "SLfbk-032",
            "FBKShareEdpFTagISMss"    : "SLfbk-033",
            "FBKShareBuyEdpFTagISMss" : "SLfbk-034",
            "FBKShareEdpFTagISMns"    : "SLfbk-035",
            "FBKShareBuyEdpFTagISMns" : "SLfbk-036",
            "FBKInviteTagNotify"      : "SLfbk-037",
            "FBKInviteEDP"            : "SLfbk-038",
            "FBKInviteHome"           : "SLfbk-039",
            "FBKInviteMusic"          : "SLfbk-040",
            "FBKInviteSports"         : "SLfbk-041",
            "FBKInviteFamily"         : "SLfbk-042",
            "FBKInviteArts"           : "SLfbk-043",
            "FBKInviteMisc"           : "SLfbk-044",
            "FBKInviteArtist"         : "SLfbk-045",
            "FBKInviteConfirmation"   : "SLfbk-046",
            "FBKLikeArtist"           : "SLfbk-047",
            "FBKLikeEvent"            : "SLfbk-048",
            "FBKLikeVenue"            : "SLfbk-049",
            "FBKLikeURLArtist"        : "SLfbk-050",
            "FBKLikeURLVenue"         : "SLfbk-051",
            "FBKLikeURLEvent"         : "SLfbk-052",
            "FBKShareArtist"          : "SLfbk-053",
            "FBKShareBuyArtist"       : "SLfbk-054",
            "FBKShareConfirmation"    : "SLfbk-055",
            "FBKShareBuyConfirmation" : "SLfbk-056",
            "TWArtist"                : "SLfbk-060",
            "TWVenue"                 : "SLfbk-061",
            "TWEvent"                 : "SLfbk-062",
            "TWConfirmation"          : "SLfbk-063",
            "FBKShare"                : "SLfbk-007",
            "FBKShareBuy"             : "SLfbk-008",
            "FBKLike"                 : "SLfbk-009",
            "FBKLikeURL"              : "SLfbk-010",
            "FBKInvite"               : "SLfbk-005",
            "FBKLikeArtist"           : "SLfbk-047",
            "FBKLikeEvent"            : "SLfbk-048",
            "FBKLikeVenue"            : "SLfbk-049",
            "FBiFBShare"              : "SLfbk-011",
            "FBiFBShareBuy"           : "SLfbk-012",
            "FBKInviteEspeciales"     : "SLfbk-044",
            "TWArtistKeyword"         : "SLfbk-064",
            "TWVenueKeyword"          : "SLfbk-065",
            "TWEventKeyword"          : "SLfbk-066",
            "TWConfirmationKeyword"   : "SLfbk-067",
            "FBLikeArtistTMm"         : "SLfbk-068",
            "FBLikeURLArtistTMm"      : "SLfbk-069",
            "FBKLikeEventTMm"         : "SLfbk-070",
            "FBKLikeURLEventTMm"      : "SLfbk-071",
            "FBLikeArtist8BTMef"      : "SLfbk-072",
            "FBLikeURLArtist8BTMef"   : "SLfbk-073",
            "FBLikeArtist8BTMpe"      : "SLfbk-074",
            "FBLikeURLArtist8BTMpe"   : "SLfbk-075",
            "FBLikeArtist8BTM"        : "SLfbk-076",
            "FBLikeURLArtist8BTM"     : "SLfbk-077",
            "FBKLikeEvent8BTM"        : "SLfbk-078",
            "FBKLikeURLEvent8BTM"     : "SLfbk-079",
            "FBKLikeEvent8BTMef"      : "SLfbk-080",
            "FBKLikeURLEvent8BTMef"   : "SLfbk-081",
            "FBKShareRSVP8BTMef"      : "SLfbk-082",
            "FBKShareBuyRSVP8BTMef"   : "SLfbk-083",
            "FBKShareRSVP8BTMedp"     : "SLfbk-084",
            "FBKShareBuyRSVP8BTMedp"  : "SLfbk-085",
            "FBKShareRSVP8BTMedp2"    : "SLfbk-086",
            "FBKShareBuyRSVP8BTMedp2" : "SLfbk-087",
            "FBKShareRSVP8BTMcp"      : "SLfbk-088",
            "FBKShareBuyRSVP8BTMcp"   : "SLfbk-089",
            "FBKShareRSVP8BTMc"       : "SLfbk-090",
            "FBKShareBuyRSVP8BTMc"    : "SLfbk-091",
            "FBKShareWANT8BTMedp"     : "SLfbk-092",
            "FBKShareBuyWANT8BTMedp"  : "SLfbk-093",
            "FBKShareJUST8BTMc"       : "SLfbk-094",
            "FBKShareBuyJUST8BTMc"    : "SLfbk-095",
            "TWVenueArtist"           : "SLfbk-110",
            "FBKLikeVenueArtist"      : "SLfbk-109"
        };
        if( map[q_p.SREF] || map[q_p.fb_ref] ) {
            return map[q_p.SREF] || map[q_p.fb_ref];
        }
        else {
            return q_p.SREF || q_p.fb_ref;
        }
    }
}

function calc43() {
    var q_p = location.search.toQueryParams();
    if( q_p.SFBState ) {
        switch( q_p.SFBState ) {
            case "Connected" :
                return 'Connected';
            break;
            case "Not-Connected" :
                return 'Not Connected';
            break;
            case "Unknown" :
                return 'Unknown';
            break;
        }
    }
}

function calc52() {
    var c_v = GetCookie("GEO_OMN");
    if ( c_v == null || c_v.length == 0 ) {
        return 'Geotargeting Not Enabled';
    }
    else {
        switch( c_v ) {
          case "ba":
            return 'No Call Made Browse Area Cookie';
          case "ua":
            return 'No Call Made User Area Cookie';
          case "in":
            return 'In Area';
          case "out":
            return 'Out of Area';
          case "unk":
            return 'Unidentifiable';
          case "aol":
            return 'AOL';
          case "corp":
            return 'Corporation';
          case "anon":
            return 'Anonymous';
          case "sat":
            return 'Satellite';
          case "seo":
            return 'SEO Crawler';
          default:
            return 'Geotargeting No Data';
        }
    }
}

function calc15() {
    var q_p = location.search.toQueryParams();
    if( q_p.tm_link ) {
        return validateTmLink( $H( location.search.toQueryParams() ).get('tm_link') );
    }
    else if(q_p.mch_link){
        return retrieveMchLnk( $H( location.search.toQueryParams() ).get('mch_link') );
    }
    else if( q_p.SREF ) {
        var to_return = 'TM_CA: ' + 'FBConn_click_';
        var set_events = false;
        if( q_p.SREF.include("P_HomePageModule_main") ) {
            to_return += 'home1';
            set_events = true;
        }
        if( q_p.SREF.include("P_MusicPageModule_main") ) {
            to_return += 'music1';
            set_events = true;
        }
        if( q_p.SREF.include("P_FamilyPageModule_main") ) {
            to_return += 'family1';
            set_events = true;
        }
        if( q_p.SREF.include("P_ArtsPageModule_main") ) {
            to_return += 'arts1';
            set_events = true;
        }
        if( q_p.SREF.include("P_SportsPageModule_main") ) {
            to_return += 'sports1';
            set_events = true;
        }
        if( q_p.SREF.include("P_SpecialsPageModule_main") ) {
            to_return += 'specials1';
            set_events = true;
        }
        if( q_p.SREF.include("P_ArtistPageModule_main") ) {
            to_return += 'artist1';
            set_events = true;
        }
        if( q_p.SREF.include("P_PurchasePageModule_main") ) {
            to_return += 'purchase1';
            set_events = true;
        }
        if( q_p.SREF.include("P_EventPageModule_main") ) {
            to_return += 'event1';
            set_events = true;
        }
        if( q_p.SREF.include("P_VenuePageModule_main") ) {
            to_return += 'venue1';
            set_events = true;
        }
        if( set_events ) {
            tm_omn.linkTrackVars = 'events,eVar15';
            tm_omn.linkTrackEvents = 'event14';
            tm_omn.events = 'event14';
            return to_return;
        }
    }
}

function retrieveMchLnk(mchLinkVal){
          tm_omn.linkTrackVars = 'events,eVar15';
          tm_omn.linkTrackEvents = 'event14';
          tm_omn.events=tm_omn.apl(tm_omn.events,'event14',',',2);
          mchLinkVal = 'TM_CA: ' + mchLinkVal;
          return mchLinkVal;
          tm_omn.eVar15 = tm_omn.getValOnce(tm_omn.eVar15,'s_evar15',0);
}

function validateTmLink(val){
// added tm_artist_rc and tm_artist_rv as a fix for artist page recommendation bug
// this should either be remove or replace artist_rc and artist_rv after we confirm
// artist should have prefix or not
var arrLinkTest = [
                     /^(tm_)(home|homeA|music|sports|arts|family|specials|toros)_(ts|c|d|event|g|h|j|k|lv|n|artist)(\d+)$/i,
                     /^(artist_rc_)(\w+)$/i,
                     /^(artist_rv_)(\w+)$/i,
                     /^(tm_artist_rc_)(\w+)$/i,
                     /^(tm_artist_rv_)(\w+)$/i,
                     /^(edp_artist_)(\w+)$/i,
                     /^(mytm_recommend_image|mytm_recommend_name)(\d+)$/i,
                     /^(tm_)(home|homeA|music|sports|arts|family|specials|toros|artist|conf|mytm|search|browse|venue|conf|mycart)(_rc_)(findtix|image|name|moredates|rating|venue)\d+$/i,
                     /^(tm_)(home|homeA|music|sports|arts|family|specials|toros|artist|conf|mytm|search|browse|venue|conf|mycart)(_rv(\d|\d_viewed\d)?_?)((findtix|image|name|moredates|rating|venue|search|browse)(\d+)?)?$/i,
                     /^(\w*)(_rv_|_rc_|_recommend_)(rating|viewed)\d+/i,
                     /^(tm_)(home|browse|section|search|artist|venue|mytm)(_rv_)(\w*)/i,
                     /(_rv_)(image|name)\d+$/i,
                     /^(tm_)(home|homeA|music|sports|arts|family|specials|toros)(\w*)_(r|f)(\d+)$/i,
                     /^(mytm_favEvent_local\w*)|(mycart_favEvent_local\w*)|(mytm_favEvent_else_Name)$/i,
                     /^(tm_homeA_popular)(\d+)$/i,
                     /^(tm_\w*)(_b_1000)(\d+_\d+)$/i
                            ]

   for(i=0;i<arrLinkTest.length; i++){
       if(arrLinkTest[i].test(val)){
          tm_omn.linkTrackVars = 'events,eVar15';
          tm_omn.linkTrackEvents = 'event14';
          tm_omn.events=tm_omn.apl(tm_omn.events,'event14',',',2);
          val = 'TM_CA: ' + val;
          return val;
          tm_omn.eVar15 = 'TM_CA: ' + tm_omn.getValOnce(tm_omn.eVar15,'s_evar15',0);
          break;
        }
   }
}

function dcsMultiTrack(){
try{
  var dcs_to_omni = $A(arguments).last();
      omniTracking.navigation_link(dcs_to_omni, false);
   }catch(err){}
}




function sell_flow_confirmation() {}




function getExitPopOmnitureVars() {
     var suffix = " ScoreBig Pop Up";
     var tmn_omn=window.tmn_omn;
     return {
             "pageName": omn_domain_owner + suffix,
             "channel": omn_domain_owner + suffix,
             "prop1": omn_domain_owner + suffix,
             "prop2": omn_domain_owner + suffix,
             "prop3": omn_domain_owner + suffix,
             "prop4": tm_omn.prop4,
             "prop9": tm_omn.prop9,
             "prop10": tm_omn.prop10,
             "prop13": tm_omn.prop13,
             "prop15": tm_omn.prop15,
             "prop16": omn_domain_owner + suffix,
             "prop17": tm_omn.prop17,
             "prop18": tm_omn.prop18,
             "prop19": tm_omn.prop19,
             "prop20": tm_omn.prop20,
             "prop21": tm_omn.prop21,

             "eVar8": tm_omn.eVar8,
             "eVar9": tm_omn.eVar9,
             "eVar10": tm_omn.eVar10,
             "eVar16": tm_omn.eVar16,
             "eVar17": tm_omn.eVar17,
             "eVar18": tm_omn.eVar18,
             "eVar19": tm_omn.eVar19,
             "eVar22": tm_omn.eVar22,
             "eVar26": tm_omn.eVar26,
             "eVar39": tm_omn.eVar39
     };
}

All Tickets  > Sports Tickets  > Soccer  > FIFA Women’s World Cup Canada 2015  > 

jQuery(document).ready(function() {
  (function($){
    try{
        var s = $('#seo_bc_prodtitle');
               (function(){
            var mcatvalue = '11';
            seo_bcgenres = {"10004" : {"Baseball":"10","Basketball":"7","Boxing":"33","Bull Riding":"61","Competitions":"206","Curling":"34","Field Sports":"205","Football":"8","Golf":"30","Handball":"765","Hockey":"9","Lacrosse":"35","Mixed Martial Arts":"830","Motorsports":"25","Rodeo":"28","Skating":"36","Soccer":"11","Tennis":"31","Volleyball":"204","Wrestling":"27","More Sports":"102"}};
            var obj = !Object.isUndefined(seo_bcgenres['10004']) ? seo_bcgenres['10004'] : {};
            for (var name in obj) {
              if (obj.hasOwnProperty(name) && obj[name] === mcatvalue) {
                 if($('#seo_bc_minorcat')) $('#seo_bc_minorcat').text(name);
                break;
              }
            }
         })();
        
    $('#seo_ol').children().last().children().wrapInner('<span />').children().unwrap().parent().contents().last().remove();
    if($('#seoCityState').length && $.trim($('#seoCityState').find('abbr').text()).empty()){
        var locCityDisplay = $('#seoCityState').text();
        $('#seoCityState').text(locCityDisplay.replace(/\,\s*$/,''))
    }
    var max_txt_len = 130, max_prod_length = 52, max_prod_trim_length = 50, buffer_len = 3;
    var bc_count  = $('#seo_ol').text().length,sub_count = ($(s).is(":last-child")) ? $(s).text().length : $('#seo_bc_prodtitle_href').text().length;
    var titletxt = $(s).text();
        function _truncateString(n){
            titletxt = titletxt.substring(0,n) + "...";
                if($(s).is(":last-child")){
                    $(s).text(titletxt).wrapInner('<span />');
                }else{                 
                    $('#seo_bc_prodtitle_href').text(titletxt);
                }
        }
        if($(s).length){
                if(bc_count > max_txt_len){
                    var trimTxtby = sub_count - (bc_count - (max_txt_len - buffer_len))
                    _truncateString(trimTxtby);
                }else if(sub_count > max_prod_length){
                    _truncateString(max_prod_trim_length);
                }
        }        $('#body').attr({'itemscope' : 'itemscope' , 'itemtype' : 'http://schema.org/WebPage'});
        $('#seo_ol').removeClass("hideContent").prependTo($('#mainContent'));
        $('#footerTop').prepend('<div class="footer-breadcrumb-container" />');
        $('#seo_ol').clone(true).prop('id', "seo_ol_footer").prependTo('.footer-breadcrumb-container');
        $('#nocrumb').hide();
    }catch(err){
        $('#seo_ol').hide();
    }
  })(jQuery);
});


{
"@context": "http://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [{"@type": "ListItem",
      "position": 1,
      "item":
        {
            "@id": "http://www.ticketmaster.ca/section/sports?tm_link=seo_bc_majorcat",
            "name": "Sports&nbsp;Tickets"
        }}
,{"@type": "ListItem",
      "position": 2,
      "item":
        {
            "@id": "http://www.ticketmaster.cabrowse/soccer-catid-11/sports-rid-10004?tm_link=seo_bc_minorcat",
            "name": "Soccer"
        }}
,{"@type": "ListItem",
      "position": 3,
      "item":
        {
            "@id": "http://www.ticketmaster.ca?tm_link=seo_bc_name",
            "name": "FIFA Women’s World Cup Canada 2015"
        }}
]}



<!--
function gaEncodeURIKeyValue(key, value) {
    if (key == '__utmz') {
        var values = value.split(/\./);
        if (values.length) {
            var back = values.pop();
            var front = values.join('.');
            if (front.search(/^((\d+(\.\d+)*)|-)$/) != -1) {
                var back_values = back.split(/\|/);
                var checked_back = '';
                var back_kv;
                for (var i = 0; i < back_values.length; i++) {
                    back_kv = back_values[i].split('=');
                    if (back_kv[0].search(/^utmc(sr|cn|md|tr|ct)$/) != -1) {
                        if (checked_back.length) {
                            checked_back += '|';
                        }
                        var back_kv_value = encodeURIComponent( back_kv[1].replace( / /g, '%20' ) );
                        checked_back += back_kv[0] + '=' + back_kv_value;
                    }
                }
                return '__utmz=' + front + '.' + checked_back;
            }
            else {
                return '';
            }
        }
        else {
            return '';
        }
    }
    else {
        if (value.search(/^((\d+(\.\d+)*)|-)$/) != -1) {
            return encodeURIComponent(key) + '=' + value;
        }
        else {
            return '';
        }
    }
}

function extract_ga_tpqa() {    var tpqa_string = '';    return tpqa_string;
}

function create_iframe() {
    var iframe_attributes = {
        'width':                '1',
        'title':                'hidden frame',
        'scrolling':            'no',
        'height':               '1',
        'frameborder':          '0',
        'marginwidth':          '0',
        'marginheight':         '0',
        'hspace':               '0',
        'vspace':               '0',
        'bordercolor':          '#000000',
        'allowtransparency':    'true',
        'aria-hidden':          'true',
        'tabindex':             '-1',
        'src':                  ''
    };
    var asurl = "http://creatives.as4x.tmcs.net/html.ng/page.uniqueads=yes&page.multiads=yes&Params.styles=funnel_pixel&Params.lifetime=30&site=tmcanada&pagepos=990&adsize=1x1&brand=0&event_name=''&venue_name=''&eventid=&page=artist&majorcatid=10004&minorcatid=11&dmaid=99999&artistid=875503&pagename=artist&bgcolor=ffffff&artist1_name=fifa_women%25e2%2580%2599s_world_cup_canada_2015&cceclassid=0&lang=en-ca";
    var tpqa_params = extract_ga_tpqa();
    if (tpqa_params) {
        asurl += '&' + tpqa_params;
    }
    asurl += '&true_ref=' + escape(encodeURIComponent(document.referrer).replace(/\'/g, '%27'));
    if (asurl.length > 2082) {
        asurl = asurl.substring(0, 2069) + asurl.substring(2069, 2082).match( /([^%]*)(%.*)?/ )[1];
    }
    iframe_attributes.src = asurl;
    var iframe_e = new Element('iframe', iframe_attributes);
    Element.insert($('pixel_tracking_anchor'), {'after': iframe_e}); 
}

new OnWindowLoad(create_iframe);
-->


    //<![CDATA[
        var _comscore = _comscore || [];
        var comScoreKW = "";
        if(typeof _comscore !== "undefined") {
            if(comScoreKW && comScoreKW.length > 0) {
                 _comscore.push({ c1: "2", c2: "3005317", options: {url_append: "comscorekw=" + comScoreKW}});
            } else {
                 _comscore.push({ c1: "2", c2: "3005317"});
            }
        }
        new OnWindowLoad( function() {
            (function() {
                  var s = document.createElement("script"), 
                      el = document.getElementsByTagName("script")[0];
                      s.async = true;
                      s.src = (document.location.protocol == "https:" ? "https://sb" : "http://b") + ".scorecardresearch.com/beacon.js";
                      el.parentNode.insertBefore(s, el);
            })();
        }, { load_last: true } );
    //]]>
    


 
	
		 if(typeof _satellite !== "undefined" && typeof _satellite.pageBottom === "function"){
		 	 _satellite.pageBottom(); 
		 }
	  



(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K4QMLG');



